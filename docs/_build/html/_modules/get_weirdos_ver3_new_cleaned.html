<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>get_weirdos_ver3_new_cleaned &mdash; xyz 00.00.01 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d7bb8d4d"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            xyz
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xyz</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">get_weirdos_ver3_new_cleaned</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for get_weirdos_ver3_new_cleaned</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">from</span> <span class="nn">addict</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">chart_studio</span> <span class="kn">import</span> <span class="n">plotly</span>
<span class="kn">from</span> <span class="nn">adjustText</span> <span class="kn">import</span> <span class="n">adjust_text</span>

<span class="kn">import</span> <span class="nn">plotly.offline</span> <span class="k">as</span> <span class="nn">pyoff</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">mplcursors</span>
<span class="kn">import</span> <span class="nn">mpldatacursor</span>

<span class="c1"># pymatgen libraries</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.transformations.standard_transformations</span> <span class="kn">import</span> <span class="n">SupercellTransformation</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.structure_matcher</span> <span class="kn">import</span> <span class="n">StructureMatcher</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.cif</span> <span class="kn">import</span> <span class="n">CifWriter</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp.inputs</span> <span class="kn">import</span> <span class="n">Poscar</span>


<div class="viewcode-block" id="replace">
<a class="viewcode-back" href="../index.html#get_weirdos_ver3_new_cleaned.replace">[docs]</a>
<span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace a string with NaN if it cannot be converted to a float.</span>

<span class="sd">    Args:</span>
<span class="sd">        i (str): The input string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float or np.nan: The converted float or NaN.</span>

<span class="sd">    Source:</span>
<span class="sd">        https://stackoverflow.com/questions/57048617/how-do-i-replace-all-string-values-with-nan-dynamically</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>



<span class="k">class</span> <span class="nc">Operation</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">File</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">splitall</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Splitting path into its individual components of each sub-/folder.</span>

<span class="sd">            Args:</span>
<span class="sd">                path (str): The input path to be split.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list: A list containing the components of the path.</span>

<span class="sd">            Source: </span>
<span class="sd">                https://www.oreilly.com/library/view/python-cookbook/0596001673/ch04s16.html</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">allparts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span>  <span class="c1"># sentinel for absolute paths</span>
                    <span class="n">allparts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span> <span class="c1"># sentinel for relative paths</span>
                    <span class="n">allparts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">allparts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">allparts</span>


        <span class="k">def</span> <span class="nf">copy_rename_single_file</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Copy a file from the source directory to the destination directory with an optional filename prefix.</span>

<span class="sd">            Args:</span>
<span class="sd">                destination_directory (str): The directory where the file should be copied.</span>
<span class="sd">                source_directory (str): The directory from which the file should be copied.</span>
<span class="sd">                filename (str): The name of the file to be copied.</span>
<span class="sd">                prefix (str): An optional prefix to be added to the new filename.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Generate the new filename</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>
            
            <span class="c1"># Get the source file path and destination file path</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
            
            <span class="c1"># Copy the file to the destination directory with the new name</span>
            <span class="n">source_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>
            <span class="c1"># print(f&quot;File copied and renamed: {filename} -&gt; {new_filename}&quot;)</span>


        <span class="k">def</span> <span class="nf">copy_rename_files</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">savedir</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Copy and rename multiple files based on the contents of a DataFrame.</span>

<span class="sd">            Args:</span>
<span class="sd">                dataframe (pd.DataFrame): DataFrame containing file information.</span>
<span class="sd">                destination_directory (str): The directory where files should be copied.</span>
<span class="sd">                filename (str): The base name of the files.</span>
<span class="sd">                prefix (str): An optional prefix to be added to the new filenames.</span>
<span class="sd">                savedir (bool): If True, save the new file paths to the DataFrame.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">savedir</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">col_subdir_copiedrenamed_files</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;subdir_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_subdir_copiedrenamed_files</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="n">savedir</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="c1"># Generate the new filename</span>
                <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>


                <span class="c1"># Get the source file path and destination file path</span>
                <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
                
                <span class="c1"># Copy the file to the destination directory with the new name</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;subdir_new_system&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span> <span class="n">destination_path</span><span class="p">)</span>
                <span class="c1"># print(f&quot;File copied and renamed: {filename} -&gt; {new_filename}&quot;)</span>
            
                <span class="k">if</span> <span class="n">savedir</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">col_subdir_copiedrenamed_files</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination_path</span>
                <span class="k">elif</span> <span class="n">savedir</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">pass</span>


        <span class="c1"># def copy_rename_single_file_and_delete_elements(destination_directory, source_directory, filename, prefix, line_ranges, line_numbers_edit, new_contents):</span>
        <span class="c1">#     # Generate the new filename</span>
        <span class="c1">#     new_filename = f&quot;{filename}_{prefix}&quot;</span>
            
        <span class="c1">#     # Get the source file path and destination file path</span>
        <span class="c1">#     destination_path = os.path.join(destination_directory, new_filename)</span>
            
        <span class="c1">#     # Copy the file to the destination directory with the new name</span>
        <span class="c1">#     source_path = os.path.join(source_directory, filename)</span>
        <span class="c1">#     shutil.copy2(source_path, destination_path)</span>
        <span class="c1">#     print(f&quot;File copied and renamed: {filename} -&gt; {new_filename}&quot;)</span>

        <span class="c1">#     Operation.File.delete_elements(destination_path, line_ranges, line_numbers_edit, new_contents)</span>


        <span class="c1"># def copy_rename_files_and_delete_elements(file_loc, destination_directory, filename, index, prefix, line_ranges, line_numbers_edit, new_contents):</span>
        <span class="c1">#     # Generate the new filename</span>
        <span class="c1">#     new_filename = f&quot;{int(file_loc[&#39;geometry&#39;][index])}_{int(file_loc[&#39;path&#39;][index])}_{filename}_{prefix}&quot;</span>
            
        <span class="c1">#     # Get the source file path and destination file path</span>
        <span class="c1">#     destination_path = os.path.join(destination_directory, new_filename)</span>
            
        <span class="c1">#     # Copy the file to the destination directory with the new name</span>
        <span class="c1">#     shutil.copy2(file_loc[&#39;subdir_new_system&#39;][index], destination_path)</span>
        <span class="c1">#     print(f&quot;File copied and renamed: {filename} -&gt; {new_filename}&quot;)</span>

        <span class="c1">#     Operation.File.delete_elements(destination_path, line_ranges, line_numbers_edit, new_contents)</span>


        <span class="k">def</span> <span class="nf">delete_lines</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_ranges</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Delete specified lines from a file.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path (str): The path to the file to be modified.</span>
<span class="sd">                line_ranges (list): A list of tuples representing the ranges of lines to be deleted.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Read the file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

            <span class="n">lines_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line_range</span> <span class="ow">in</span> <span class="n">line_ranges</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">line_range</span>
                <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">lines_to_delete</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>

            <span class="n">modified_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines_to_delete</span><span class="p">]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">modified_lines</span><span class="p">)</span>

            <span class="c1"># print(f&quot;Lines deleted successfully in file: {file_path}&quot;)</span>


        <span class="k">def</span> <span class="nf">delete_elements</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_ranges</span><span class="p">,</span> <span class="n">line_numbers_edit</span><span class="p">,</span> <span class="n">new_contents</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Delete specified lines and edit others in a file.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path (str): The path to the file to be modified.</span>
<span class="sd">                line_ranges (list): A list of tuples representing the ranges of lines to be deleted.</span>
<span class="sd">                line_numbers_edit (list): A list of line numbers to be edited.</span>
<span class="sd">                new_contents (list): A list of new contents for the edited lines.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">delete_lines</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_ranges</span><span class="p">)</span>
            <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">edit_lines</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_numbers_edit</span><span class="p">,</span> <span class="n">new_contents</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">edit_lines</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_numbers</span><span class="p">,</span> <span class="n">new_contents</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Edit specified lines in a file.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_path (str): The path to the file to be modified.</span>
<span class="sd">                line_numbers (list): A list of line numbers to be edited.</span>
<span class="sd">                new_contents (list): A list of new contents for the edited lines.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Read the file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

            <span class="c1"># Modify the line content</span>
            <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">new_content</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">line_numbers</span><span class="p">,</span> <span class="n">new_contents</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">line_number</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">line_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_content</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

                <span class="c1"># Write the modified content back to the file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                    <span class="c1"># # print(f&quot;Line edited successfully.&quot;)</span>
            <span class="c1"># # else:</span>
            <span class="c1"># # #     print(f&quot;Invalid line number: {line_number}&quot;)</span>


        <span class="k">def</span> <span class="nf">check_folder_existance</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">empty_folder</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check if a folder exists, create it if not, and optionally empty it.</span>

<span class="sd">            Args:</span>
<span class="sd">                folder_name (str): The name of the folder to check or create.</span>
<span class="sd">                empty_folder (bool): If True, empty the folder if it already exists.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Check if the folder exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
                <span class="c1"># Create the folder if it doesn&#39;t exist</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>
                <span class="c1"># print(f&quot;Folder &#39;{folder_name}&#39; created.&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">empty_folder</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">empty_folder</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>
                    <span class="c1"># print(f&quot;Folder &#39;{folder_name}&#39; already exists. Emptying it.&quot;)</span>
                <span class="k">elif</span> <span class="n">empty_folder</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">pass</span>


        <span class="k">def</span> <span class="nf">empty_folder</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Empty the contents of a folder.</span>

<span class="sd">            Args:</span>
<span class="sd">                folder_name (str): The name of the folder to be emptied.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">files_inside_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files_inside_folder</span><span class="p">:</span>
                <span class="n">path_to_files</span> <span class="o">=</span> <span class="n">folder_name</span> <span class="o">+</span> <span class="n">i</span> 
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path_to_files</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">delete_files</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">,</span> <span class="n">file_name_w_format</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Delete files based in the specified folder.</span>

<span class="sd">            Args:</span>
<span class="sd">                dataframe (pd.DataFrame): A DataFrame containing information about files (&#39;geometry&#39; and &#39;path&#39;).</span>
<span class="sd">                folder_name (str): The directory where the files are located.</span>
<span class="sd">                file_name_w_format (str): The base name of the files with format information.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Raises:</span>
<span class="sd">                OSError: If an error occurs during file deletion, an exception is caught,</span>
<span class="sd">                        and an error message is printed.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">filename_to_delete</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name_w_format</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">filename_to_delete_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">filename_to_delete</span><span class="p">)</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Attempt to delete the file</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename_to_delete_path</span><span class="p">)</span>
                    <span class="c1"># print(f&quot;{filename_to_delete_path} has been deleted.&quot;)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Handle any errors that occur during file deletion</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting </span><span class="si">{</span><span class="n">filename_to_delete_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">class</span> <span class="nc">Distance</span><span class="p">:</span>
        <span class="c1"># def eucledian_distance(coor1, coor2):</span>
        <span class="c1">#     distance = math.sqrt(sum((x1 - x2)**2 for x1, x2 in zip(coor1, coor2)))</span>
        <span class="c1">#     return distance</span>


        <span class="k">def</span> <span class="nf">apply_pbc</span><span class="p">(</span><span class="n">distance_1D</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Apply Periodic Boundary Conditions to a given 1D distance.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - distance_1D (float): The value to apply the periodic boundary conditions to.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - distance_1D (float): The adjusted value after applying the periodic boundary conditions, ensuring it </span>
<span class="sd">                    remains within the normalized range [0, 0.5].</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance_1D</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance_1D</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">distance_1D</span>


        <span class="k">def</span> <span class="nf">mic_eucledian_distance</span><span class="p">(</span><span class="n">coor1</span><span class="p">,</span> <span class="n">coor2</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function computes the minimum image convention (MIC) Euclidean distance </span>
<span class="sd">            between two points (coor1 and coor2),considering periodic boundary conditions. </span>
<span class="sd">            It ensures that the distance measured is the shortest possible path </span>
<span class="sd">            between these points in a periodic system.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - coor1 (tuple): The (x, y, z) coordinates of the first point.</span>
<span class="sd">            - coor2 (tuple): The (x, y, z) coordinates of the second point.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - distance (float): The minimum image convention Euclidean distance between the two points.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">x_coor1</span><span class="p">,</span> <span class="n">y_coor1</span><span class="p">,</span> <span class="n">z_coor1</span> <span class="o">=</span> <span class="n">coor1</span>
            <span class="n">x_coor2</span><span class="p">,</span> <span class="n">y_coor2</span><span class="p">,</span> <span class="n">z_coor2</span> <span class="o">=</span> <span class="n">coor2</span>
            
            <span class="n">delta_x</span> <span class="o">=</span> <span class="n">x_coor1</span> <span class="o">-</span> <span class="n">x_coor2</span>
            <span class="n">delta_y</span> <span class="o">=</span> <span class="n">y_coor1</span> <span class="o">-</span> <span class="n">y_coor2</span>
            <span class="n">delta_z</span> <span class="o">=</span> <span class="n">z_coor1</span> <span class="o">-</span> <span class="n">z_coor2</span>

            <span class="n">distance</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([(</span><span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">apply_pbc</span><span class="p">(</span><span class="n">delta_x</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">apply_pbc</span><span class="p">(</span><span class="n">delta_y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">apply_pbc</span><span class="p">(</span><span class="n">delta_z</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">distance</span>


        <span class="k">def</span> <span class="nf">apply_pbc_cartesian</span><span class="p">(</span><span class="n">distance_1D</span><span class="p">,</span> <span class="n">length_1D</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Apply Periodic Boundary Conditions to a given 1D distance in a Cartesian system.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - distance_1D (float): The original distance along one axis (X, Y, or Z).</span>
<span class="sd">            - length (float): The length of the domain along the same axis.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - distance_1D (float): The adjusted distance considering PBC, ensuring it&#39;s the shortest possible</span>
<span class="sd">            within the given domain length.</span>

<span class="sd">            Notes:</span>
<span class="sd">            - Angle is ignored in the calculation</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance_1D</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">length_1D</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">length_1D</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance_1D</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">distance_1D</span>


        <span class="k">def</span> <span class="nf">mic_eucledian_distance_cartesian</span><span class="p">(</span><span class="n">coor1</span><span class="p">,</span> <span class="n">coor2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculates the minimum image convention (MIC) Euclidean distance between two points in 3D space</span>
<span class="sd">            with periodic boundary conditions in a Cartesian coordinate system, </span>
<span class="sd">            considering the box dimensions a, b, and c along the x, y, and z axes, respectively.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - coor1 (tuple): Coordinates (x, y, z) of the first point.</span>
<span class="sd">            - coor2 (tuple): Coordinates (x, y, z) of the second point.</span>
<span class="sd">            - a (float): Length of the simulation box along the x-axis.</span>
<span class="sd">            - b (float): Length of the simulation box along the y-axis.</span>
<span class="sd">            - c (float): Length of the simulation box along the z-axis.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - distance (float): The MIC Euclidean distance between the two points.</span>

<span class="sd">            Notes:</span>
<span class="sd">            - I&#39;m actually confused with this function</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">x_coor1</span><span class="p">,</span> <span class="n">y_coor1</span><span class="p">,</span> <span class="n">z_coor1</span> <span class="o">=</span> <span class="n">coor1</span>
            <span class="n">x_coor2</span><span class="p">,</span> <span class="n">y_coor2</span><span class="p">,</span> <span class="n">z_coor2</span> <span class="o">=</span> <span class="n">coor2</span>
            
            <span class="n">delta_x</span> <span class="o">=</span> <span class="n">x_coor1</span> <span class="o">-</span> <span class="n">x_coor2</span>
            <span class="n">delta_y</span> <span class="o">=</span> <span class="n">y_coor1</span> <span class="o">-</span> <span class="n">y_coor2</span>
            <span class="n">delta_z</span> <span class="o">=</span> <span class="n">z_coor1</span> <span class="o">-</span> <span class="n">z_coor2</span>

            <span class="n">distance</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([(</span><span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">apply_pbc_cartesian</span><span class="p">(</span><span class="n">delta_x</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">apply_pbc_cartesian</span><span class="p">(</span><span class="n">delta_y</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">apply_pbc_cartesian</span><span class="p">(</span><span class="n">delta_z</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">distance</span>


    <span class="k">class</span> <span class="nc">Dict</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">merge_dictionaries</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Merges two dictionaries into a single dictionary, combining the values of </span>
<span class="sd">            any duplicate keys into lists.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - dict1 (dict): The first input dictionary.</span>
<span class="sd">            - dict2 (dict): The second input dictionary.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - defaultdict(list): A dictionary where each key holds a list of values </span>
<span class="sd">            from both input dictionaries. If a key is present in both dict1 and dict2, </span>
<span class="sd">            both values will be in the list. Otherwise, the list will contain the </span>
<span class="sd">            single value from whichever dictionary the key originates from.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">merged_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">):</span> <span class="c1"># Extendable for more dictionaries</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">merged_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">merged_dict</span>


        <span class="k">def</span> <span class="nf">get_duplicate_values</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Identifies and returns a list of duplicate values in the given dictionary. If a value appears</span>
<span class="sd">            more than once across all values in the dictionary, it will be included in the return list.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - dictionary (dict): The dictionary whose values are to be checked for duplicates.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - list: A list of values that appear more than once in the dictionary.</span>

<span class="sd">            Note: </span>
<span class="sd">            This implementation is designed to work effectively with immutable value types (e.g.,</span>
<span class="sd">            integers, strings, tuples). For mutable types like lists, it treats the value as seen only once</span>
<span class="sd">            because lists cannot be used as dictionary keys or added to sets directly without conversion.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">seen_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">duplicate_values</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">seen_values</span><span class="p">:</span>
                    <span class="n">duplicate_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">seen_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">duplicate_values</span>
        

        <span class="k">class</span> <span class="nc">Mapping</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_duplicate_closest24_w_data</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Identifies and returns a list of duplicate values (closest24 with its data: coor)</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">duplicate_closest24</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">coorreference</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                        <span class="n">closest24</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;closest24&quot;</span><span class="p">]</span>
                        <span class="n">dist</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">closest24</span> <span class="ow">in</span> <span class="n">duplicate_closest24</span><span class="p">:</span>
                        <span class="n">duplicate_closest24</span><span class="p">[</span><span class="n">closest24</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;coorreference&quot;</span><span class="p">:</span> <span class="n">coorreference</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">duplicate_closest24</span><span class="p">[</span><span class="n">closest24</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;coorreference&quot;</span><span class="p">:</span> <span class="n">coorreference</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">}]</span>

                <span class="n">duplicate_closest24_w_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">closest24</span><span class="p">,</span> <span class="n">coorreferences_dists</span> <span class="ow">in</span> <span class="n">duplicate_closest24</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coorreferences_dists</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">duplicate_closest24_w_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Duplicate closest24: </span><span class="si">{</span><span class="n">closest24</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;coorreferences and dists&quot;</span><span class="p">:</span> <span class="n">coorreferences_dists</span><span class="p">}]</span>

                <span class="k">return</span> <span class="n">duplicate_closest24_w_data</span>


            <span class="k">def</span> <span class="nf">get_atom_mapping_el_w_dist_closestduplicate</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Identifies and returns closest mapped atom with its distance</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">filtered_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">coorreference</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                        <span class="n">closest24</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;closest24&quot;</span><span class="p">]</span>
                        <span class="n">dist</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span>
                        
                    <span class="k">if</span> <span class="n">closest24</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">closest24</span><span class="p">][</span><span class="s2">&quot;dist&quot;</span><span class="p">]:</span>
                            <span class="n">filtered_data</span><span class="p">[</span><span class="n">closest24</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coorreference&quot;</span><span class="p">:</span> <span class="n">coorreference</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">filtered_data</span><span class="p">[</span><span class="n">closest24</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coorreference&quot;</span><span class="p">:</span> <span class="n">coorreference</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">}</span>

                <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;coorreference&quot;</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;closest24&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="k">return</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span>


    <span class="k">class</span> <span class="nc">KMeans</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">kmeans_cluster_atoms</span><span class="p">(</span><span class="n">coor_atoms</span><span class="p">,</span> <span class="n">amount_clusters</span><span class="p">):</span>
            <span class="c1"># source: https://stackoverflow.com/questions/64987810/3d-plotting-of-a-dataset-that-uses-k-means</span>
            <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">amount_clusters</span><span class="p">)</span>                <span class="c1"># Number of clusters</span>
            <span class="n">kmeans</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">coor_atoms</span><span class="p">)</span>                          <span class="c1"># Fitting the input data</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">coor_atoms</span><span class="p">)</span>                      <span class="c1"># Getting the cluster labels</span>
            <span class="n">centroids</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>             <span class="c1"># Centroid values</span>
            <span class="c1"># print(&quot;Centroids are:&quot;, centroids)              # From sci-kit learn</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="c1"># ax = fig.gca(projection=&#39;3d&#39;)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

            <span class="c1"># x = np.array(labels==0)</span>
            <span class="c1"># y = np.array(labels==1)</span>
            <span class="c1"># z = np.array(labels==2)</span>


            <span class="c1"># ax.scatter(coor_atoms[x][:, 0], coor_atoms[x][:, 1], coor_atoms[x][:, 2], color=&#39;red&#39;)</span>
            <span class="c1"># ax.scatter(coor_atoms[y][:, 0], coor_atoms[y][:, 1], coor_atoms[y][:, 2], color=&#39;blue&#39;)</span>
            <span class="c1"># ax.scatter(coor_atoms[z][:, 0], coor_atoms[z][:, 1], coor_atoms[z][:, 2], color=&#39;green&#39;)</span>
            <span class="c1"># ax.scatter(centroids[:, 0], centroids[:, 1], centroids[:, 2],</span>
            <span class="c1">#             marker=&#39;x&#39;, s=169, linewidths=10,</span>
            <span class="c1">#             color=&#39;black&#39;, zorder=50)</span>
            <span class="c1"># # ax.scatter(centroids[:,0],centroids[:,1],centroids[:,2],c=&quot;black&quot;,s=150,label=&quot;Centers&quot;,alpha=1) # for dot marker</span>

            <span class="c1"># Define a colormap for different clusters</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">amount_clusters</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">cluster_label</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_clusters</span><span class="p">):</span>
                <span class="n">cluster_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">cluster_label</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">coor_atoms</span><span class="p">[</span><span class="n">cluster_mask</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">coor_atoms</span><span class="p">[</span><span class="n">cluster_mask</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">coor_atoms</span><span class="p">[</span><span class="n">cluster_mask</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">cluster_label</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="n">cluster_label</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">centroids</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">centroids</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">centroids</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">169</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Centroids&#39;</span>
            <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">labels</span>


        <span class="k">def</span> <span class="nf">create_POSCAR_atoms_centroids_appended</span><span class="p">(</span><span class="n">coor_atoms</span><span class="p">,</span> <span class="n">coor_centroids</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

            <span class="c1"># Define lattice constants (you might need to adjust these based on your actual system)</span>
            <span class="n">lattice_constants_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">lattice_constant</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">]</span>
            <span class="p">])</span>

            <span class="c1"># Define the header and comment lines for the POSCAR file</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;Generated POSCAR&quot;</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

            <span class="c1"># Define filename</span>
            <span class="n">filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="c1"># Write the POSCAR file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># Write the header and comment</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comment</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the lattice constants</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lattice_constants_matrix</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># K as mock element for centroids</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Li K</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the number of atoms for each element</span>
                <span class="c1"># f.write(&quot; &quot;.join(map(str, np.ones(len(coordinates), dtype=int))) + &quot;\n&quot;)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor_centroids</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Number of Li atoms</span>

                <span class="c1"># Write the selective dynamics tag (in this case, &#39;Direct&#39;)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Direct</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the atomic coordinates</span>
                <span class="k">for</span> <span class="n">coor_atom</span> <span class="ow">in</span> <span class="n">coor_atoms</span><span class="p">:</span>
                    <span class="c1"># f.write(&quot; &quot;.join(map(str, coord)) + &quot;\n&quot;)</span>
                    <span class="n">formatted_coor_atom</span> <span class="o">=</span> <span class="p">[</span><span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;.16f&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coor_atom</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_coor_atom</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">coor_centroid</span> <span class="ow">in</span> <span class="n">coor_centroids</span><span class="p">:</span>
                    <span class="n">formatted_coor_centroid</span> <span class="o">=</span> <span class="p">[</span><span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;.16f&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coor_centroid</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_coor_centroid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># print(&quot;POSCAR file created successfully.&quot;)</span>
    

    <span class="k">class</span> <span class="nc">Cartesian</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note: </span>
<span class="sd">        - to be checked!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># def get_fractional_to_cartesian_matrix(a, b, c, alpha, beta, gamma, angle_in_degrees=True):</span>
        <span class="k">def</span> <span class="nf">get_fractional_to_cartesian_matrix</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">,</span> <span class="n">angle_in_degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> 
            <span class="c1"># source: https://gist.github.com/Bismarrck/a68da01f19b39320f78a</span>
            <span class="n">col_latticeconstant_structure_dict</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;latticeconstant_structure_dict_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">col_fractional_to_cartesian_matrix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fractional_to_cartesian_matrix_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_fractional_to_cartesian_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">latticeconstant_structure_dict</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_latticeconstant_structure_dict</span><span class="p">]</span> 

                <span class="n">a</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span>

                <span class="n">alpha</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span>
                <span class="n">gamma</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">angle_in_degrees</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
                    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
                    <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>

                <span class="n">cosa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">sina</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">cosb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
                <span class="n">sinb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
                <span class="n">cosg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
                <span class="n">sing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
                <span class="n">volume</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">cosa</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">cosb</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">cosg</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cosa</span> <span class="o">*</span> <span class="n">cosb</span> <span class="o">*</span> <span class="n">cosg</span>
                <span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">cosg</span>
                <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">cosb</span>
                <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">sing</span>
                <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">cosa</span> <span class="o">-</span> <span class="n">cosb</span> <span class="o">*</span> <span class="n">cosg</span><span class="p">)</span> <span class="o">/</span> <span class="n">sing</span>
                <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">volume</span> <span class="o">/</span> <span class="n">sing</span>

                <span class="c1"># print(f&quot;type_a_alpha_r: {type(a), type(alpha), type(r)}&quot;)</span>
                <span class="c1"># print(f&quot;a_alpha_r: {a, alpha, r}&quot;)</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_fractional_to_cartesian_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>


        <span class="k">def</span> <span class="nf">get_fractional_to_cartesian_coor</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">):</span>
            <span class="n">col_fractional_to_cartesian_matrix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fractional_to_cartesian_matrix_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">col_coor_structure_dict_cartesian</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_structure_dict_cartesian_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_structure_dict_cartesian</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_origin_Li_init_cartesian</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_P_init_cartesian</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_S_init_cartesian</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_Cl_init_cartesian</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">coor_structure_dict_cartesian</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="n">var_filename</span> <span class="o">==</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">:</span>
                    <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

                <span class="n">new_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">)</span>

                <span class="n">r</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_fractional_to_cartesian_matrix</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">idx24</span><span class="p">,</span> <span class="n">coor24</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_structure</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Li&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_Li_init_cartesian</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> 
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_P_init_cartesian</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_S_init_cartesian</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>  
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Cl&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_Cl_init_cartesian</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> 
                
                <span class="n">coor_structure_dict_cartesian</span><span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_Li_init_cartesian</span>
                <span class="n">coor_structure_dict_cartesian</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_P_init_cartesian</span>
                <span class="n">coor_structure_dict_cartesian</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_S_init_cartesian</span>
                <span class="n">coor_structure_dict_cartesian</span><span class="p">[</span><span class="s2">&quot;Cl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_Cl_init_cartesian</span>
            
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_dict_cartesian</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_structure_dict_cartesian</span>


        <span class="k">def</span> <span class="nf">get_closest_neighbors_el_cartesian_coor</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">max_neighbors_radius</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">):</span>
            <span class="n">col_distance_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;distance_cartesian_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_closest_neighbors_w_dist_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;closest_neighbors_w_dist_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">col_coor_structure_dict_cartesian</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_structure_dict_cartesian_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_latticeconstant_structure_dict</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;latticeconstant_structure_dict_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_distance_el</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_closest_neighbors_w_dist_el</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

                <span class="n">distance_el</span> <span class="o">=</span> <span class="p">{}</span> 
                <span class="n">closest_neighbors_w_dist_el</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">coor_cartesion_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_dict_cartesian</span><span class="p">][</span><span class="n">el</span><span class="p">]</span>

                <span class="n">latticeconstant_structure_dict</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_latticeconstant_structure_dict</span><span class="p">]</span> 

                <span class="n">a</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">idx24_temp1</span><span class="p">,</span> <span class="n">coor24_temp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_cartesion_el</span><span class="p">):</span>        
                    <span class="n">closest_neighbors_w_dist_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">distance_array</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">for</span> <span class="n">idx24_temp2</span><span class="p">,</span> <span class="n">coor24_temp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_cartesion_el</span><span class="p">):</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance_cartesian</span><span class="p">(</span><span class="n">coor24_temp1</span><span class="p">,</span> <span class="n">coor24_temp2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_neighbors_radius</span><span class="p">:</span>
                            <span class="n">distance_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>

                            <span class="n">closest_neighbors_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;neighbor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coor24_temp2</span><span class="p">)</span>
                            <span class="n">closest_neighbors_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>

                            <span class="c1"># Get the list of neighbors for the current coordinate, or create one if it doesn&#39;t exist</span>
                            <span class="n">neighbors_list</span> <span class="o">=</span> <span class="n">closest_neighbors_w_dist_el</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coor24_temp1</span><span class="p">),</span> <span class="p">[])</span>
                            <span class="n">neighbors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest_neighbors_w_dist_dict</span><span class="p">)</span>

                            <span class="c1"># if tuple(coor24_temp1) in closest_neighbors_w_dist_el:</span>
                            <span class="c1">#     closest_neighbors_w_dist_el[tuple(coor24_temp1)].append(closest_neighbors_w_dist_dict)</span>
                            <span class="c1"># else:</span>
                            <span class="c1">#     closest_neighbors_w_dist_el[tuple(coor24_temp1)] = closest_neighbors_w_dist_dict</span>
                    
                    <span class="n">distance_array_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">distance_array</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coor24_temp1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">distance_el</span><span class="p">:</span>
                        <span class="n">distance_el</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coor24_temp1</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance_array_sorted</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">distance_el</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coor24_temp1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">distance_array_sorted</span>        

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_distance_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_closest_neighbors_w_dist_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest_neighbors_w_dist_el</span>


<span class="k">class</span> <span class="nc">Orientation</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_orientation</span><span class="p">(</span><span class="n">file_loc</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">path_perfect_poscar_24</span><span class="p">,</span> <span class="n">col_excel_toten</span><span class="p">,</span> <span class="n">orientation</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
            <span class="n">file_loc_ori_notdeleted</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">file_loc_mask_1</span> <span class="o">=</span> <span class="n">file_loc_ori_notdeleted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">file_loc_ori_notdeleted</span><span class="p">[</span><span class="s1">&#39;p_s_mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">file_loc_mask_1</span> <span class="o">=</span> <span class="n">file_loc_mask_1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="c1"># # file_loc_mask_0 = file_loc_ori_notdeleted.loc[file_loc_ori_notdeleted[&#39;p_s_mask&#39;].apply(lambda x: x != 1)]</span>
            <span class="c1"># # file_loc_mask_0 = file_loc_mask_0.reset_index()</span>
            
            <span class="c1"># file_loc_mask_1.to_csv(r&#39;test_save_contcar_directory.txt&#39;, header=None, index=None, sep=&#39; &#39;, mode=&#39;a&#39;)</span>

            <span class="c1"># # just refreshing folder</span>
            <span class="c1"># Operation.File.check_folder_existance(direc_restructure_destination)</span>

            <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_files</span><span class="p">(</span><span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savedir</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;verify_w_lib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;verify_w_linalg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;transformation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">structure_reference</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_perfect_poscar_24</span><span class="p">)</span>
            
            <span class="c1"># for all elements</span>
            <span class="n">var_lib</span> <span class="o">=</span> <span class="s2">&quot;trf_w_lib&quot;</span>
            <span class="n">Orientation</span><span class="o">.</span><span class="n">get_structure_with_library</span><span class="p">(</span><span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">structure_reference</span><span class="p">,</span> <span class="n">var_lib</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># for all elements</span>
            <span class="n">var_linalg</span> <span class="o">=</span> <span class="s2">&quot;trf_w_linalg&quot;</span>
            <span class="n">Orientation</span><span class="o">.</span><span class="n">get_structure_with_linalg</span><span class="p">(</span><span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">structure_reference</span><span class="p">,</span> <span class="n">var_linalg</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">var_linalg_n_lib</span> <span class="o">=</span> <span class="s2">&quot;trf_w_linalg_n_lib&quot;</span>
            <span class="n">Orientation</span><span class="o">.</span><span class="n">get_structure_with_linalg_combinded_with_library</span><span class="p">(</span><span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">structure_reference</span><span class="p">,</span> <span class="n">var_linalg_n_lib</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Now Processing with other folders that are with mask = 0 (not perfect system)</span>
            <span class="c1">#### copy the data of scaling and translation to the file_loc as initial data</span>
            <span class="n">file_loc</span><span class="p">[</span><span class="s1">&#39;scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_loc_important_cols</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;subdir_new_system&quot;</span><span class="p">,</span> <span class="s2">&quot;p_s_mask&quot;</span><span class="p">,</span> <span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="s2">&quot;translation&quot;</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">col_excel_toten</span><span class="p">]]</span>
            <span class="n">file_loc_mask_1_important_cols</span> <span class="o">=</span> <span class="n">file_loc_mask_1</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;subdir_new_system&quot;</span><span class="p">,</span> <span class="s2">&quot;p_s_mask&quot;</span><span class="p">,</span> <span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="s2">&quot;translation&quot;</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">col_excel_toten</span><span class="p">]]</span>

            <span class="n">idx_row</span> <span class="o">=</span> <span class="n">file_loc_mask_1</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># copy scaling, translation, mapping of the path 0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_row</span><span class="p">:</span>
                <span class="n">scaling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">file_loc_mask_1_important_cols</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">][</span><span class="n">file_loc_mask_1_important_cols</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">translation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">file_loc_mask_1_important_cols</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">][</span><span class="n">file_loc_mask_1_important_cols</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">file_loc_mask_1_important_cols</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">][</span><span class="n">file_loc_mask_1_important_cols</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">file_loc_important_cols</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaling</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">file_loc_important_cols</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;translation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">translation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">file_loc_important_cols</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">file_loc_important_cols</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;subdir_new_system&quot;</span><span class="p">,</span> <span class="s2">&quot;p_s_mask&quot;</span><span class="p">,</span> <span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="s2">&quot;translation&quot;</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="n">col_excel_toten</span><span class="p">]]</span>

            <span class="n">idx_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;p_s_mask&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx_mask</span><span class="p">)</span>

            <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>   <span class="c1"># hardcode for initial part</span>
            <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_mask</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">i1</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">i2</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># # print(&quot;i1 = &quot;+str(i1) + &quot;; i2 = &quot;+str(i2))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># # print(&quot;j = &quot;+str(j))</span>
                    <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>
                    <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>
                    <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_loc_ori_notdeleted</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">file_loc_mask_1</span> <span class="o">=</span> <span class="n">file_loc_ori_notdeleted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">file_loc_ori_notdeleted</span><span class="p">[</span><span class="s1">&#39;p_s_mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">file_loc_mask_1</span> <span class="o">=</span> <span class="n">file_loc_mask_1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="n">file_loc_important_cols</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">file_loc_important_cols</span>


    <span class="k">def</span> <span class="nf">get_structure_with_library</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">structure_reference</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates transformed structures from input data and saves them as CIF files,</span>
<span class="sd">        comparing each structure to a reference structure using StructureMatcher from pymatgen librabry.</span>
<span class="sd">        The comparison result for each structure is stored in the &#39;verify_w_lib&#39; column</span>
<span class="sd">        of the DataFrame.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        - dataframe (pandas.DataFrame): DataFrame containing necessary data columns.</span>
<span class="sd">        - destination_directory (str): Path to the directory where CIF files will be saved.</span>
<span class="sd">        - filename (str): Base filename for the CIF files.</span>
<span class="sd">        - structure_reference (pymatgen Structure): Reference structure to compare with.</span>
<span class="sd">        - var_name (str): Variable name for the CIF files.</span>
<span class="sd">        - prefix (str or None): Prefix to append to the filenames (optional).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - None: The function saves CIF files but does not return any value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">filename_to_transform_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_to_transform</span><span class="p">)</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename_to_transform_path</span><span class="p">)</span>
            
            <span class="c1"># StructureMatcher can accept different tolerances for judging equivalence</span>
            <span class="n">matcher</span> <span class="o">=</span> <span class="n">StructureMatcher</span><span class="p">(</span><span class="n">primitive_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># first, we can verify these lattices are equivalent</span>
            <span class="n">matcher_verify</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>  <span class="c1"># returns True</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;verify_w_lib&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">matcher_verify</span>
            <span class="c1"># # print(f&quot;verify_w_lib: {matcher_verify}&quot;)</span>
            <span class="k">if</span> <span class="n">matcher_verify</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matcher doesn&#39;t match.&quot;</span><span class="p">)</span>

            <span class="n">transformed_structure</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">get_s2_like_s1</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">include_ignored_species</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cif</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">transformed_structure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">)</span>
            <span class="n">cif</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>


    <span class="c1"># corrected or at least attempted to</span>
    <span class="k">def</span> <span class="nf">get_structure_with_linalg</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">structure_reference</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note:</span>
<span class="sd">        - will be checked later</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">filename_to_transform_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_to_transform</span><span class="p">)</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename_to_transform_path</span><span class="p">)</span>

            <span class="c1"># StructureMatcher can accept different tolerances for judging equivalence</span>
            <span class="n">matcher</span> <span class="o">=</span> <span class="n">StructureMatcher</span><span class="p">(</span><span class="n">primitive_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># don&#39;t work if it&#39;s True</span>
            <span class="c1"># first, we can verify these lattices are equivalent</span>
            <span class="n">matcher_verify</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>  <span class="c1"># returns True</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;verify_w_linalg&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">matcher_verify</span>
            <span class="k">if</span> <span class="n">matcher_verify</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matcher doesn&#39;t match.&quot;</span><span class="p">)</span>

            <span class="c1"># Transform desired structure into structure_reference</span>
                <span class="c1"># output of transformation:</span>
                    <span class="c1"># 3x3 matrix of supercell transformation;</span>
                    <span class="c1"># 1x3 vector of fractional translation;</span>
                    <span class="c1"># 1x4 mapping to transform struct2 to be similar to struct1</span>
            <span class="n">transformation</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">get_transformation</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">transformation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="c1"># if prefix == None:</span>
            <span class="c1">#     dataframe[&#39;trf_matrix&#39;][idx] = transformation[0]</span>
            <span class="c1"># else: </span>
            <span class="c1">#     dataframe[&#39;trf_matrix_P&#39;][idx] = transformation[0]</span>
            <span class="n">scaling</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">transformation</span>
            <span class="c1"># print(f&quot;scaling: {scaling}&quot;)</span>
            <span class="c1"># print(f&quot;scaling type: {type(scaling)}&quot;)</span>

            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaling</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;translation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">translation</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;transformation_P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformation</span>

            <span class="c1"># Apply scaling</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">scaling</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="c1"># scaled_coords = np.round(scaled_coords, decimals=16)</span>
            <span class="c1"># print(scaled_coords)</span>
            <span class="c1"># apply translation</span>
            <span class="n">translated_coords</span> <span class="o">=</span> <span class="n">scaled_coords</span> <span class="o">+</span> <span class="n">translation</span>
            <span class="c1"># apply mapping</span>
            <span class="n">mapped_coords</span> <span class="o">=</span> <span class="n">translated_coords</span><span class="p">[</span><span class="n">mapping</span><span class="p">]</span>
            <span class="c1"># # # long story short</span>
            <span class="c1"># # transformed_coords = np.dot(structure.frac_coords[mapping], scaling.T) + translation</span>

            <span class="c1"># Create a new structure with the transformed coordinates</span>
            <span class="n">transformed_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">structure</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">mapped_coords</span><span class="p">)</span>
            <span class="c1"># transformed_structure = Structure.from_sites(mapped_coords) # similar to above but different input</span>
            
            <span class="n">cif</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">transformed_structure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">)</span>
            <span class="n">cif</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>


    <span class="c1"># for sanity check</span>
    <span class="k">def</span> <span class="nf">get_structure_with_linalg_combinded_with_library</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">structure_reference</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note:</span>
<span class="sd">        - will be checked later</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">filename_to_transform_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_to_transform</span><span class="p">)</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename_to_transform_path</span><span class="p">)</span>

            <span class="c1"># StructureMatcher can accept different tolerances for judging equivalence</span>
            <span class="n">matcher</span> <span class="o">=</span> <span class="n">StructureMatcher</span><span class="p">(</span><span class="n">primitive_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># first, we can verify these lattices are equivalent</span>
            <span class="n">matcher_verify</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>  <span class="c1"># returns True</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;verify_w_linalg&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">matcher_verify</span>
            <span class="k">if</span> <span class="n">matcher_verify</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matcher doesn&#39;t match.&quot;</span><span class="p">)</span>

            <span class="c1"># Transform desired structure into structure_reference</span>
                <span class="c1"># output of transformation:</span>
                    <span class="c1"># 3x3 matrix of supercell transformation;</span>
                    <span class="c1"># 1x3 vector of fractional translation;</span>
                    <span class="c1"># 1x4 mapping to transform struct2 to be similar to struct1</span>
            <span class="n">transformation</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">get_transformation</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">transformation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            
            <span class="n">scaling</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">transformation</span>

            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;transformation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformation</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;transformation_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformation</span>

            <span class="n">sites</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
            <span class="c1"># Append the ignored sites at the end.</span>
            <span class="c1"># # sites.extend([site for site in struct2 if site not in s2])</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_sites</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>

            <span class="c1"># Apply scaling</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span>
            <span class="c1"># apply translation</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))),</span> <span class="n">translation</span><span class="p">)</span>

            <span class="c1"># Apply some modification from library</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mapping</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">)]):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">structure_reference</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span> <span class="o">-</span> <span class="n">temp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
                    <span class="n">temp</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">to_unit_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mapping</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="c1"># if include_ignored_species:</span>
            <span class="c1">#     start = int(round(len(temp) / len(struct2) * len(s2)))</span>
            <span class="c1">#     sites.extend(temp.sites[start:])</span>
            <span class="n">transformed_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_sites</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>
            <span class="c1"># transformed_structure = Structure(structure.lattice, structure.species, mapped_coords) # similar to above but different input</span>
            
            <span class="n">cif</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">transformed_structure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">)</span>
            <span class="n">cif</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_structure_with_linalg_orientated</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note:</span>
<span class="sd">        - will be checked later</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## POSCAR file is also created</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;subdir_orientated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">filename_to_transform_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_to_transform</span><span class="p">)</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename_to_transform_path</span><span class="p">)</span>

            <span class="c1"># Transform desired structure into structure_reference</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">translation</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

            <span class="c1"># Apply scaling</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">scaling</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="c1"># apply translation</span>
            <span class="n">translated_coords</span> <span class="o">=</span> <span class="n">scaled_coords</span> <span class="o">+</span> <span class="n">translation</span>
            <span class="c1"># apply mapping (no mapping here)</span>
            <span class="n">mapped_coords</span> <span class="o">=</span> <span class="n">translated_coords</span><span class="p">[</span><span class="n">mapping</span><span class="p">]</span>
            <span class="c1"># # # long story short</span>
            <span class="c1"># # transformed_coords = np.dot(structure.frac_coords[mapping], scaling.T) + translation</span>

            <span class="c1"># Create a new structure with the transformed coordinates</span>
            <span class="n">transformed_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">structure</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">mapped_coords</span><span class="p">)</span>
            <span class="c1"># transformed_structure = Structure.from_sites(mapped_coords) # similar to above but different input</span>
            
            <span class="n">cif</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">transformed_structure</span><span class="p">)</span>
            <span class="n">cif_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">)</span>
            <span class="c1"># dataframe</span>
            <span class="n">cif</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>

            <span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">transformed_structure</span><span class="p">)</span>
            <span class="n">poscar_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_POSCAR_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">destination_path_poscar</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">poscar_filename</span><span class="p">)</span>
            <span class="n">poscar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">destination_path_poscar</span><span class="p">)</span>
            
            <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;subdir_orientated&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination_path</span>


<span class="k">class</span> <span class="nc">PreProcessingCONTCAR</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_CONTCAR_normal_elements</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies CONTCAR files to include standard elemental labels for each site configuration,</span>
<span class="sd">        instead of &#39;  Li_sv_GW/24a6a  P_GW/715c28f22  S_GW/357db9cfb  Cl_GW/3ef3b316\n&#39;</span>
<span class="sd">        from the result of NEB calculation.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - dataframe (pandas.DataFrame): DataFrame containing necessary data columns.</span>
<span class="sd">        - destination_directory (str): Path to the directory where CONTCAR files are located.</span>
<span class="sd">        - filename (str): Base filename for the CONTCAR files.</span>
<span class="sd">        - prefix (str or None): Prefix to append to the filenames (optional).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - None: The function modifies CONTCAR files but does not return any value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="c1"># Generate the new filename</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Get the source file path and destination file path</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>

            <span class="c1"># Read CONTCAR file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">contcar_file</span><span class="p">:</span>
                <span class="n">contcar_lines</span> <span class="o">=</span> <span class="n">contcar_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            
            <span class="n">contcar_lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;   Li   P    S    Cl</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">contcar_lines</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;    24     4    20     4</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1"># Create a new CONTCAR file for each configuration</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">contcar_file</span><span class="p">:</span>
                <span class="n">contcar_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">contcar_lines</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_positive_lessthan1_poscarorcontcar</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">poscarorcontcar_line_nr_start</span><span class="p">,</span> <span class="n">poscarorcontcar_line_nr_end</span><span class="p">,</span> <span class="n">poscarorcontcar_columns_type2</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">var_name_in</span><span class="p">,</span> <span class="n">var_name_out</span><span class="p">,</span> <span class="n">n_decimal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates positive POSCAR/CONTCAR files that have normalized value within the range [0, 1]</span>
<span class="sd">        (based on specified data transformations).</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - dataframe (pandas.DataFrame): DataFrame containing necessary data columns.</span>
<span class="sd">        - destination_directory (str): Path to the directory where CONTCAR files will be saved.</span>
<span class="sd">        - file_type (str): Type of files to be processed.</span>
<span class="sd">        - poscarorcontcar_line_nr_start (int): Line number where relevant data starts in the CONTCAR file.</span>
<span class="sd">        - poscarorcontcar_line_nr_end (int): Line number where relevant data ends in the CONTCAR file.</span>
<span class="sd">        - poscarorcontcar_columns_type2 (list): Column names for the relevant data in the CONTCAR file.</span>
<span class="sd">        - var_name_in (str or None): Variable name for input data (optional).</span>
<span class="sd">        - var_name_out (str): Variable name for output data.</span>
<span class="sd">        - n_decimal (int): Number of decimal places to round the coordinates to (default is 6).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - None: The function modifies and saves CONTCAR files but does not return any value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col_subdir_positive_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;subdir_positive_</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_subdir_positive_file</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">var_name_in</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name_in</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">filename_to_transform_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_to_transform</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_to_transform_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">poscarorcontcar_line_nr_start</span><span class="p">:</span><span class="n">poscarorcontcar_line_nr_end</span><span class="p">]</span>

            <span class="c1"># Split each string by space and create the DataFrame</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

            <span class="c1"># Optional: Rename the columns</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">poscarorcontcar_columns_type2</span>

            <span class="n">df_positive_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">idx_a</span><span class="p">,</span> <span class="n">coord_x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_positive_val</span><span class="p">[</span><span class="s1">&#39;coord_x&#39;</span><span class="p">]):</span>
                <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">coord_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
                <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coord_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">df_positive_val</span><span class="p">[</span><span class="s1">&#39;coord_x&#39;</span><span class="p">][</span><span class="n">idx_a</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx_a</span><span class="p">,</span> <span class="n">coord_y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_positive_val</span><span class="p">[</span><span class="s1">&#39;coord_y&#39;</span><span class="p">]):</span>
                <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">coord_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
                <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coord_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">df_positive_val</span><span class="p">[</span><span class="s1">&#39;coord_y&#39;</span><span class="p">][</span><span class="n">idx_a</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx_a</span><span class="p">,</span> <span class="n">coord_z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_positive_val</span><span class="p">[</span><span class="s1">&#39;coord_z&#39;</span><span class="p">]):</span>
                <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_z</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">coord_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_z</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
                <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coord_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord_z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">df_positive_val</span><span class="p">[</span><span class="s1">&#39;coord_z&#39;</span><span class="p">][</span><span class="n">idx_a</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coord_z</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>

            <span class="n">row_list</span> <span class="o">=</span> <span class="n">df_positive_val</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">row_list_space</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">row_list</span><span class="p">]</span> <span class="c1"># 2 spaces of distance</span>
            <span class="n">row_list_w_beginning</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_list_space</span><span class="p">]</span>       <span class="c1"># 2 spaces in the beginning</span>
            <span class="n">absolute_correct_list</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row_list_w_beginning</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>        

            <span class="n">line_append_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx_c</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">absolute_correct_list</span><span class="p">):</span>
                <span class="n">line_new_line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">line_append_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_new_line</span><span class="p">)</span>

            <span class="n">file_list</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">poscarorcontcar_line_nr_start</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_append_list</span>

            <span class="n">poscarorcontcar_filename_positive</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_CONTCAR_</span><span class="si">{</span><span class="n">var_name_out</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">poscarorcontcar_filename_positive</span><span class="p">)</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">poscarorcontcar_positive_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
                    <span class="n">poscarorcontcar_positive_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_subdir_positive_file</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination_path</span>


    <span class="k">def</span> <span class="nf">create_cif_pymatgen</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_restructure</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

            <span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="n">output_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>

            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">)</span>
            <span class="n">frac_coor</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span>
            <span class="n">cif_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">structure</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">frac_coor</span><span class="p">)</span>
            <span class="n">cif</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">cif_structure</span><span class="p">)</span>
            <span class="n">cif</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">output_filename_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_latticeconstant_structure_dict_iterated</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">proceed_XDATCAR</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">):</span>
        <span class="n">col_latticeconstant_structure_dict</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;latticeconstant_structure_dict_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_latticeconstant_structure_dict_flag</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;latticeconstant_structure_dict_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">_flag&quot;</span>

        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_latticeconstant_structure_dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_latticeconstant_structure_dict_flag</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">latticeconstant_structure_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">var_filename</span> <span class="o">==</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">:</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                
            <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

            <span class="n">new_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">)</span>

            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">new_structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span>
            <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">new_structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span>

            <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>

            <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span>
            <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>

            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="n">beta</span> <span class="o">==</span> <span class="n">gamma</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="n">latticeconstant_structure_dict_flag</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proceed_XDATCAR</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                    <span class="n">latticeconstant_structure_dict_flag</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>


            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_latticeconstant_structure_dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_latticeconstant_structure_dict_flag</span><span class="p">]</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict_flag</span>


<span class="k">class</span> <span class="nc">ReadStructure</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Coor</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_coor_structure_init_dict</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Extracts fractional coordinates of different elements from a given structure</span>
<span class="sd">            and organizes them into a dictionary.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - structure (pymatgen Structure): The input structure containing atomic coordinates.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - dict: A dictionary where keys represent element symbols and values are lists</span>
<span class="sd">            of fractional coordinates corresponding to each element in the structure.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">coor_origin_Li_init</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_P_init</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_S_init</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_Cl_init</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">coor_structure_init_dict</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">coor</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Li&quot;</span><span class="p">:</span>
                    <span class="n">coor_origin_Li_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">coor</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
                    <span class="n">coor_origin_P_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">coor</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                    <span class="n">coor_origin_S_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">coor</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Cl&quot;</span><span class="p">:</span>
                    <span class="n">coor_origin_Cl_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span> 
                
            <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_Li_init</span>
            <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_P_init</span>
            <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_S_init</span>
            <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;Cl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_Cl_init</span>

            <span class="k">return</span> <span class="n">coor_structure_init_dict</span>


        <span class="k">def</span> <span class="nf">get_coor_structure_init_dict_wholedataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Same like function get_coor_structure_init_dict() but goes over </span>
<span class="sd">            all structures stated in the DataFrame and save it in the corresponding column.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - dataframe (pandas.DataFrame): DataFrame containing structure file paths.</span>
<span class="sd">            - mapping (str): Flag indicating whether the structures have undergone mapping.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - None: The function updates the DataFrame with dictionaries of fractional coordinates</span>
<span class="sd">            for each element in the respective structures.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">col_coor_structure_init_dict</span> <span class="o">=</span> <span class="s2">&quot;coor_structure_init_dict&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_structure_init_dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_origin_Li_init</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_P_init</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_S_init</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_origin_Cl_init</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">coor_structure_init_dict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="n">mapping</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
                    <span class="n">new_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;subdir_positive_CONTCAR&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span> <span class="c1"># use this instead if no mapping is done</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;subdir_orientated_positive_poscar&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span> <span class="c1"># or we use this</span>
                    <span class="c1"># new_structure = Structure.from_file(dataframe[&#39;subdir_orientated_positive&#39;][idx])</span>

                <span class="k">for</span> <span class="n">idx_24</span><span class="p">,</span> <span class="n">coor24</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_structure</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Li&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_Li_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span> 
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_P_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_S_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>  
                    <span class="k">if</span> <span class="n">coor24</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Cl&quot;</span><span class="p">:</span>
                        <span class="n">coor_origin_Cl_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span> 
                    
                <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_Li_init</span>
                <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_P_init</span>
                <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_S_init</span>
                <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="s2">&quot;Cl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_origin_Cl_init</span>
            
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_init_dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span>


    <span class="k">class</span> <span class="nc">Metainfo</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_tuple_metainfo</span><span class="p">(</span><span class="n">coor_structure_init_dict_expanded</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
            <span class="n">coor_structure_init_dict_expanded_el</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="p">((</span><span class="n">litype</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">tuple_metainfo</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">coor_li24g_ref</span>      <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
                <span class="n">coor_li48htype8_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">360</span><span class="p">:</span><span class="mi">408</span><span class="p">]</span>

            <span class="n">tuple_metainfo_all</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx_i</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li24g_ref</span><span class="p">):</span>

                <span class="n">tuple_metainfo_24g_dict</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;24g&#39;</span><span class="p">}</span>

                <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_24g_dict</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype3_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype3_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype4_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype3_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype4_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype5_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype3_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype4_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype5_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype6_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype6&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype3_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype4_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype5_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype6_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype6&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype7_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype7&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype1_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>
                        
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype2_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype3_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype4_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype5_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype6_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype6&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype7_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype7&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coor_li48htype8_ref</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                        <span class="n">tuple_metainfo_all_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;48htype8&#39;</span><span class="p">}</span>

                        <span class="n">tuple_metainfo_all</span><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_metainfo_all_dict</span><span class="p">)</span>


            <span class="n">sorted_tuple_metainfo_all</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tuple_metainfo_all</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">top_n_tuple_metainfo</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuple_metainfo_all</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">top_n_tuple_metainfo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">selected_values</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                <span class="n">tuple_metainfo</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_values</span>
                                
            <span class="k">return</span> <span class="n">tuple_metainfo</span>   


        <span class="k">def</span> <span class="nf">get_coor_48htype1_metainfo</span><span class="p">(</span><span class="n">coor_structure_init_dict_expanded</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
            <span class="n">all_coor_48htype1</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded</span><span class="p">[</span><span class="n">el</span><span class="p">][</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>

            <span class="n">coor_48htype1_metainfo</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_coor_48htype1</span><span class="p">):</span>
                <span class="n">coor_48htype1_metainfo</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor</span><span class="p">}</span>

            <span class="k">return</span> <span class="n">coor_48htype1_metainfo</span>


        <span class="k">def</span> <span class="nf">get_idx_cage_coor_24g</span><span class="p">(</span><span class="n">coor_24g_array</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">idx_coor_cage_order</span><span class="p">,</span> <span class="n">amount_clusters</span><span class="p">):</span>
            <span class="n">idx_cage_coor_24g</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

            <span class="c1"># idx_coor_cage_order = {0_1: np.array([0.97111, 0.25   , 0.25   ]), 3_4: np.array([0.02889, 0.75   , 0.25   ]),</span>
            <span class="c1">#                        1_3: np.array([0.02889, 0.25   , 0.75   ]), 2_2: np.array([0.97111, 0.75   , 0.75   ])}</span>

            <span class="k">for</span> <span class="n">idx_cluster</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_clusters</span><span class="p">):</span>
                <span class="n">idx_cage_coor_24g</span><span class="p">[</span><span class="n">idx_cluster</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">cluster_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">idx_cluster</span><span class="p">)</span>

                <span class="c1"># print(f&quot;idx_cluster:{idx_cluster}\n{coor_24g_array[np.array(labels == idx_cluster)]}&quot;)</span>

                <span class="n">coors_cluster</span> <span class="o">=</span> <span class="n">coor_24g_array</span><span class="p">[</span><span class="n">cluster_mask</span><span class="p">]</span>
                <span class="c1"># print(coor_cluster)</span>

                <span class="k">for</span> <span class="n">coor_cluster</span> <span class="ow">in</span> <span class="n">coors_cluster</span><span class="p">:</span> 

                    <span class="c1"># coor_cluster_rounded = tuple(round(coordinate, 5) for coordinate in coor_cluster)</span>
                    <span class="c1"># # print(coor_cluster_rounded)</span>
                    <span class="c1"># print(coor_cluster)</span>

                    <span class="n">idx_cage_coor_24g</span><span class="p">[</span><span class="n">idx_cluster</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor_cluster</span><span class="p">)</span>

            <span class="n">updated_idx_cage_coor_24g</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Iterate over idx_coor_cage_order</span>
            <span class="k">for</span> <span class="n">new_key</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="n">idx_coor_cage_order</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Find the corresponding key in idx_cage_coor_24g based on coor</span>
                <span class="k">for</span> <span class="n">old_key</span><span class="p">,</span> <span class="n">coor_list</span> <span class="ow">in</span> <span class="n">idx_cage_coor_24g</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">coor</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coor_list</span><span class="p">):</span>
                        <span class="n">updated_idx_cage_coor_24g</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_list</span>
                        <span class="k">break</span>

            <span class="k">return</span> <span class="n">updated_idx_cage_coor_24g</span>


        <span class="k">def</span> <span class="nf">get_tuple_cage_metainfo</span><span class="p">(</span><span class="n">tuple_metainfo</span><span class="p">,</span> <span class="n">idx_cage_coor_24g</span><span class="p">):</span>
            <span class="c1"># Good. use further!</span>

            <span class="n">tuple_cage_metainfo</span> <span class="o">=</span> <span class="n">tuple_metainfo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># for idx_tuple, value_list in tuple_cage_metainfo.items():</span>
            <span class="c1">#     # Iterate over values in idx_cage_coor_24g</span>
            <span class="c1">#     for idx_cage, coor_list in idx_cage_coor_24g.items():</span>
            <span class="c1">#         # Iterate over coordinate lists</span>
            <span class="c1">#         for coor in coor_list:</span>
            <span class="c1">#             # Check if coor matches any &#39;coor&#39; in value_list with &#39;type&#39;: &#39;24g&#39;</span>
            <span class="c1">#             for item in value_list:</span>
            <span class="c1">#                 if item[&#39;type&#39;] == &#39;24g&#39; and (item[&#39;coor&#39;] == coor).all():</span>
            <span class="c1">#                     # Assign idx_cage to the matching value</span>
            <span class="c1">#                     item[&#39;idx_cage&#39;] = idx_cage</span>
            <span class="c1">#                 elif item[&#39;type&#39;] != &#39;24g&#39;:</span>
            <span class="c1">#                     item[&#39;idx_cage&#39;] = idx_cage</span>

            <span class="c1"># Iterate over tuple_metainfo</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">tuple_cage_metainfo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Initialize idx_cage for the current group</span>
                <span class="n">current_idx_cage</span> <span class="o">=</span> <span class="kc">None</span>
                
                <span class="c1"># Iterate over values in idx_cage_coor_24g</span>
                <span class="k">for</span> <span class="n">idx_cage</span><span class="p">,</span> <span class="n">coor_list</span> <span class="ow">in</span> <span class="n">idx_cage_coor_24g</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># Iterate over coordinate lists</span>
                    <span class="k">for</span> <span class="n">coor</span> <span class="ow">in</span> <span class="n">coor_list</span><span class="p">:</span>
                        <span class="c1"># Check if coor matches any &#39;coor&#39; in value_list with &#39;type&#39;: &#39;24g&#39;</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;24g&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">coor</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="c1"># Assign idx_cage to the matching value</span>
                                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_cage</span>
                                <span class="n">current_idx_cage</span> <span class="o">=</span> <span class="n">idx_cage</span>
                
                <span class="c1"># Assign the same idx_cage to other types in the current group</span>
                <span class="k">if</span> <span class="n">current_idx_cage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;24g&#39;</span><span class="p">:</span>
                            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_idx_cage</span>

            <span class="k">return</span> <span class="n">tuple_cage_metainfo</span>


    <span class="k">class</span> <span class="nc">Parameter</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_dx_dz_init</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">litype</span><span class="p">):</span>
            <span class="n">dictio</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

                <span class="c1"># return dx1_48h_type1_init, dx2_48h_type1_init, dz_48h_type1_init, dx1_48h_type2_init, dx2_48h_type2_init, dz_48h_type2_init, dx_24g_init, dz1_24g_init, dz2_24g_init</span>

            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

                <span class="c1"># return dx1_48h_type1_init, dx2_48h_type1_init, dz_48h_type1_init, dx1_48h_type2_init, dx2_48h_type2_init, dz_48h_type2_init, dx_24g_init, dz1_24g_init, dz2_24g_init, dx1_48h_type3_init, dx2_48h_type3_init, dz_48h_type3_init</span>

            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li7&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li7&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li8&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type7_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type7_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type7_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz1_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz2_24g_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type1_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type2_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type2_init &quot;</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type3_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type4_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type5_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li7&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type6_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li8&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type7_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type7_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type7_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li9&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx1_48h_type8_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dx2_48h_type8_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">dictio</span><span class="p">[</span><span class="s2">&quot;dz_48h_type8_init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>


                <span class="c1"># return dx1_48h_type1_init, dx2_48h_type1_init, dz_48h_type1_init, dx1_48h_type2_init, dx2_48h_type2_init, dz_48h_type2_init, dx_24g_init, dz1_24g_init, dz2_24g_init, dx1_48h_type3_init, dx2_48h_type3_init, dz_48h_type3_init, dx1_48h_type4_init, dx2_48h_type4_init, dz_48h_type4_init </span>
            
            <span class="c1"># return dx1_48h_type1_init, dx2_48h_type1_init, dz_48h_type1_init, dx1_48h_type2_init, dx2_48h_type2_init, dz_48h_type2_init, dx_24g_init, dz1_24g_init, dz2_24g_init, dx1_48h_type3_init, dx2_48h_type3_init, dz_48h_type3_init</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dictio</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dictio</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">Mapping</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function does:</span>
<span class="sd">        - Mapping to the closest reference by the radius given. </span>
<span class="sd">        - In the correct case, no multiple atom should belong to a same reference atom, otherwise flag stated &quot;True&quot;. </span>
<span class="sd">        - Get weirdos that don&#39;t belong to any closest reference.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - dataframe (pandas.DataFrame): DataFrame containing necessary data columns.</span>
<span class="sd">        - coor_structure_init_dict (dict): Dictionary containing initial fractional coordinates of elements.</span>
<span class="sd">        - el (str): Element symbol for which mapping is performed.</span>
<span class="sd">        - max_mapping_radius (float): Maximum mapping radius for identifying nearby atomic positions.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - flag_el:                                      By default False. True if there&#39;s &gt; 1 atom belong to a same reference. </span>
<span class="sd">        - coor_weirdos_el:                              Coordinate of weirdos</span>
<span class="sd">        - sum_weirdos_el:                               Sum amount of weirdos</span>
<span class="sd">        - duplicate_closest24_w_data_el:                Dictionary, whose key is coor24 </span>
<span class="sd">                                                        and values are multiple coorreference it belongs to and dist.</span>
<span class="sd">        - atom_mapping_el_w_dist_closestduplicate:      Dictionary, whose key is coorreference </span>
<span class="sd">                                                        and its value is THE CLOSEST coor24 and dist</span>
<span class="sd">        - coor_reducedreference_el_closestduplicate:    List of coorreference based on atom_mapping_el_w_dist_closestduplicate, </span>
<span class="sd">                                                        so its the closest only.</span>
<span class="sd">        - atom_mapping_el_closestduplicate:             Dictionary, key: coorreference, value: coor24</span>
<span class="sd">        - sum_mapped_el_closestduplicate:               Sum amount of coor_reducedreference_el_closestduplicate</span>
<span class="sd">        - sum_sanitycheck_el_closestduplicate:          sum_mapped_el_closestduplicate + sum_weirdos_el</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
        <span class="n">col_coor_structure_init_dict</span> <span class="o">=</span> <span class="s2">&quot;coor_structure_init_dict&quot;</span>

        <span class="c1"># col_atom_mapping_el = f&quot;atom_mapping_{el}&quot;</span>
        <span class="c1"># col_atom_mapping_el_w_dist = f&quot;atom_mapping_{el}_w_dist&quot;</span>
        <span class="c1"># col_coor_weirdos_el_dict = f&quot;coor_weirdos_{el}_dict&quot;            # just added</span>
        <span class="c1"># col_coor_reducedreference_el = f&quot;coor_reducedreference_{el}&quot;</span>
        <span class="c1"># col_sum_mapped_el = f&quot;sum_mapped_{el}&quot;</span>
        <span class="c1"># col_sum_sanitycheck_el = f&quot;sum_sanitycheck_{el}&quot;</span>
        <span class="n">col_flag_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;flag_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_duplicate_closest24_w_data_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;duplicate_closest24_w_data_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_mapped_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_sanitycheck_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_closestduplicate&quot;</span>

        <span class="c1"># dataframe[col_atom_mapping_el] = [{} for _ in range(len(dataframe.index))] </span>
        <span class="c1"># dataframe[col_atom_mapping_el_w_dist] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_coor_weirdos_el_dict] = [{el: []} for _ in range(len(dataframe.index))]                       # just added</span>
        <span class="c1"># dataframe[col_coor_reducedreference_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_mapped_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_sanitycheck_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_flag_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_duplicate_closest24_w_data_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_reducedreference_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_mapped_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_sanitycheck_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span> 
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_el_w_dist_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">atom_mapping_el_w_dist</span> <span class="o">=</span> <span class="p">{}</span> 
            <span class="n">atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="p">{}</span> 
            <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># coor_weirdos_el_dict = {}</span>

            <span class="n">coor_origin24_el_init</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_init_dict</span><span class="p">][</span><span class="n">el</span><span class="p">]</span>     <span class="c1"># dataframe[&#39;subdir_orientated_positive&#39;]</span>
                                                                                            <span class="c1"># or without orientation</span>
                                                                                            <span class="c1"># dataframe[&#39;subdir_CONTCAR&#39;]</span>
            
            <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">coor_origin24_el_init</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    

            <span class="k">for</span> <span class="n">idxreference</span><span class="p">,</span> <span class="n">coorreference</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_reference_el_init</span><span class="p">):</span>        
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">atom_mapping_w_dist_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">distance_prev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
                <span class="n">closest24</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">for</span> <span class="n">idx24</span><span class="p">,</span> <span class="n">coor24</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">):</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coorreference</span><span class="p">,</span> <span class="n">coor24</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_mapping_radius</span><span class="p">:</span>
                        <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_prev</span><span class="p">:</span>
                            <span class="n">distance_prev</span> <span class="o">=</span> <span class="n">distance</span>
                            <span class="n">closest24</span> <span class="o">=</span> <span class="n">coor24</span>
                
                    <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_flag_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>

                        <span class="c1"># if tuple(coorreference) in atom_mapping_el_w_dist:</span>
                        <span class="c1">#     atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_w_dist_dict)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     atom_mapping_el_w_dist.setdefault(tuple(coorreference),[atom_mapping_w_dist_dict])</span>
                        
                
                <span class="c1"># if closest24 is not None:</span>
                <span class="c1">#     if tuple(coorreference) in atom_mapping_el:</span>
                <span class="c1">#         atom_mapping_el[tuple(coorreference)].append(closest24)</span>
                <span class="c1">#     else:</span>
                <span class="c1">#         atom_mapping_el[tuple(coorreference)] = tuple(closest24)</span>

                <span class="k">if</span> <span class="n">closest24</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">atom_mapping_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">closest24</span><span class="p">)</span>
                    <span class="n">atom_mapping_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_prev</span>
                    
                    <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">:</span>
                        <span class="n">new_entry</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">new_entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_mapping_w_dist_dict</span><span class="p">)</span>
                        <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_entry</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_mapping_w_dist_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
    
                    <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">closest24</span><span class="p">)]</span>

                <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_reducedreference_el</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">coorreference</span><span class="p">)]</span>

            <span class="n">duplicate_closest24_w_data</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">Mapping</span><span class="o">.</span><span class="n">get_duplicate_closest24_w_data</span><span class="p">(</span><span class="n">atom_mapping_el_w_dist</span><span class="p">)</span>

            <span class="c1"># get the new reduced coorreference, based on the closest distance if it has multiple close coorreference within the radius</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_closest24_w_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">Mapping</span><span class="o">.</span><span class="n">get_atom_mapping_el_w_dist_closestduplicate</span><span class="p">(</span><span class="n">atom_mapping_el_w_dist</span><span class="p">)</span>
                <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_el</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1"># if atom_mapping_el_w_dist_closestduplicate != {}:</span>
            <span class="c1">#    for key, values in atom_mapping_el_w_dist_closestduplicate.items():</span>
            <span class="c1">#        # atom_mapping_el_closestduplicate[key] = [entry[&#39;closest24&#39;] for entry in values]</span>
            <span class="c1">#        atom_mapping_el_closestduplicate[key] = values[&#39;closest24&#39;]</span>
            
            <span class="k">if</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">!=</span> <span class="p">{}:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">closest24_values</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="c1"># If it&#39;s a list, iterate over the dictionaries in the list</span>
                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">:</span>
                            <span class="n">closest24_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="c1"># If it&#39;s a dictionary, directly access &#39;closest24&#39;</span>
                        <span class="n">closest24_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_list</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">])</span>

                    <span class="n">atom_mapping_el_closestduplicate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest24_values</span>

            <span class="c1"># coor_weirdos_el_dict[el] = coor_weirdos_el</span>

            <span class="n">sum_weirdos_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">)</span>
            <span class="c1"># sum_mapped_el = len(coor_reducedreference_el)</span>
            <span class="n">sum_mapped_el_closestduplicate</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">)</span>
            <span class="n">sum_sanitycheck_el_closestduplicate</span> <span class="o">=</span> <span class="n">sum_mapped_el_closestduplicate</span> <span class="o">+</span> <span class="n">sum_weirdos_el</span>

            <span class="k">if</span> <span class="n">sum_sanitycheck_el_closestduplicate</span> <span class="o">!=</span> <span class="mi">24</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sum of mapped atom and weirdos are not 24 at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

            <span class="c1"># dataframe.at[idx, col_atom_mapping_el] = atom_mapping_el</span>
            <span class="c1"># dataframe.at[idx, col_atom_mapping_el_w_dist] = atom_mapping_el_w_dist</span>
            <span class="c1"># dataframe.at[idx, col_coor_weirdos_el_dict] = coor_weirdos_el_dict          # just added</span>
            <span class="c1"># dataframe.at[idx, col_coor_reducedreference_el] = np.array(coor_reducedreference_el)</span>
            <span class="c1"># dataframe.at[idx, col_sum_mapped_el] = sum_mapped_el</span>
            <span class="c1"># dataframe.at[idx, col_sum_sanitycheck_el] = sum_weirdos_el + sum_mapped_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_weirdos_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_weirdos_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_duplicate_closest24_w_data_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">duplicate_closest24_w_data</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_w_dist_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">)</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_el_closestduplicate</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_mapped_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_el_closestduplicate</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_sanitycheck_el_closestduplicate</span>


    <span class="k">def</span> <span class="nf">get_flag_map_weirdos_48htype2_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">):</span>
        <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>         
        <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>              
            <span class="n">col_coor_structure_48htype2_init_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>               <span class="c1"># here is the difference</span>
        <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">col_coor_structure_48htype2_init_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>               <span class="c1"># here is the difference</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;activate_radius is wrongly given&quot;</span><span class="p">)</span>

        <span class="c1"># col_atom_mapping_48htype2_el = f&quot;atom_mapping_48htype2_{el}&quot;</span>
        <span class="c1"># col_atom_mapping_48htype2_el_w_dist = f&quot;atom_mapping_48htype2_{el}_w_dist&quot;</span>
        <span class="c1"># col_coor_reducedreference_48htype2_el = f&quot;coor_reducedreference_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_mapped_48htype2_el = f&quot;sum_mapped_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_sanitycheck_48htype2_el = f&quot;sum_sanitycheck_48htype2_{el}&quot;</span>
        <span class="n">col_flag_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;flag_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_weirdos_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_weirdos_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_weirdos_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_duplicate_closest24_w_data_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;duplicate_closest24_w_data_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_reducedreference_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_mapped_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_sanitycheck_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_48htype2_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_closestduplicate&quot;</span>

        <span class="c1"># dataframe[col_atom_mapping_48htype2_el] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_atom_mapping_48htype2_el_w_dist] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_coor_reducedreference_48htype2_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_mapped_48htype2_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_sanitycheck_48htype2_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_flag_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_weirdos_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_weirdos_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_duplicate_closest24_w_data_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_reducedreference_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_mapped_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_sanitycheck_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_48htype2_el_w_dist_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

        <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span>
        <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">48</span><span class="p">:</span><span class="mi">96</span><span class="p">]</span>
        <span class="n">coor_li24g_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">96</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">atom_mapping_el_w_dist</span> <span class="o">=</span> <span class="p">{}</span> 
            <span class="n">atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="p">{}</span> 
            <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">coor_origin24_el_init</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_48htype2_init_el</span><span class="p">]</span><span class="c1">#[el]             # dataframe[&#39;subdir_orientated_positive&#39;]</span>
                                                                                            <span class="c1"># or without orientation</span>
                                                                                            <span class="c1"># dataframe[&#39;subdir_CONTCAR&#39;]</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="n">coor_li48htype2_ref</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">coor_origin24_el_init</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    

                <span class="k">for</span> <span class="n">idxreference</span><span class="p">,</span> <span class="n">coorreference</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li48htype2_ref</span><span class="p">):</span>        
                    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">atom_mapping_w_dist_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">distance_prev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
                    <span class="n">closest24</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">for</span> <span class="n">idx24</span><span class="p">,</span> <span class="n">coor24</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">):</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coorreference</span><span class="p">,</span> <span class="n">coor24</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">:</span>
                            <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_prev</span><span class="p">:</span>
                                <span class="n">distance_prev</span> <span class="o">=</span> <span class="n">distance</span>
                                <span class="n">closest24</span> <span class="o">=</span> <span class="n">coor24</span>
                    
                        <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_flag_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>
                        
                    <span class="k">if</span> <span class="n">closest24</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">atom_mapping_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">closest24</span><span class="p">)</span>
                        <span class="n">atom_mapping_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_prev</span>

                        <span class="c1"># if tuple(coorreference) in atom_mapping_el_w_dist:</span>
                        <span class="c1">#     atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_w_dist_dict)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     atom_mapping_el_w_dist[tuple(coorreference)] = atom_mapping_w_dist_dict</span>
                            
                        <span class="c1"># if tuple(coorreference) in atom_mapping_el:</span>
                        <span class="c1">#     atom_mapping_el[tuple(coorreference)].append(closest24)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     atom_mapping_el[tuple(coorreference)] = tuple(closest24)</span>

                        <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">:</span>
                            <span class="n">new_entry</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">new_entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_mapping_w_dist_dict</span><span class="p">)</span>
                            <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_entry</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_mapping_w_dist_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

                        <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">closest24</span><span class="p">)]</span>

                    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_reducedreference_el</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">coorreference</span><span class="p">)]</span>

                <span class="n">duplicate_closest24_w_data</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">Mapping</span><span class="o">.</span><span class="n">get_duplicate_closest24_w_data</span><span class="p">(</span><span class="n">atom_mapping_el_w_dist</span><span class="p">)</span>

                <span class="c1"># get atom_mapping_el_closestduplicate</span>
                <span class="c1"># if duplicate_closest24_w_data != {}:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_closest24_w_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">Mapping</span><span class="o">.</span><span class="n">get_atom_mapping_el_w_dist_closestduplicate</span><span class="p">(</span><span class="n">atom_mapping_el_w_dist</span><span class="p">)</span>
                    <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_el</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                
                <span class="c1"># if atom_mapping_el_w_dist_closestduplicate != {}:</span>
                <span class="c1">#    for key, value in atom_mapping_el_w_dist_closestduplicate.items():</span>
                <span class="c1">#        atom_mapping_el_closestduplicate[key] = [entry[&#39;closest24&#39;] for entry in value]</span>

                <span class="k">if</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">closest24_values</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="c1"># If it&#39;s a list, iterate over the dictionaries in the list</span>
                            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">:</span>
                                <span class="n">closest24_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="c1"># If it&#39;s a dictionary, directly access &#39;closest24&#39;</span>
                            <span class="n">closest24_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_list</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">])</span>

                        <span class="n">atom_mapping_el_closestduplicate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest24_values</span>

                <span class="n">sum_weirdos_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">)</span>
                <span class="c1"># sum_mapped_el = len(coor_reducedreference_el)</span>
                <span class="n">sum_mapped_el_closestduplicate</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">)</span>

                <span class="c1"># dataframe.at[idx, col_atom_mapping_48htype2_el] = atom_mapping_el</span>
                <span class="c1"># dataframe.at[idx, col_atom_mapping_48htype2_el_w_dist] = atom_mapping_el_w_dist</span>
                <span class="c1"># dataframe.at[idx, col_coor_reducedreference_48htype2_el] = np.array(coor_reducedreference_el)</span>
                <span class="c1"># dataframe.at[idx, col_sum_mapped_48htype2_el] = sum_mapped_el</span>
                <span class="c1"># dataframe.at[idx, col_sum_sanitycheck_48htype2_el] = sum_mapped_el + sum_weirdos_el </span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_weirdos_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_weirdos_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_duplicate_closest24_w_data_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">duplicate_closest24_w_data</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">)</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_mapped_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_el_closestduplicate</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_el_closestduplicate</span> <span class="o">+</span> <span class="n">sum_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_el_closestduplicate</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htype2_el_w_dist_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span>

            <span class="c1"># elif coor_origin24_el_init == []:</span>
            <span class="c1">#     dataframe.at[idx, col_atom_mapping_48htype2_el] = {} </span>
            <span class="c1">#     dataframe.at[idx, col_atom_mapping_48htype2_el_w_dist] = {}</span>
            <span class="c1">#     dataframe.at[idx, col_sum_weirdos_48htype2_el] = 0</span>


    <span class="k">def</span> <span class="nf">get_flag_map_weirdos_48htype1_48htype2_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype1_48htype2</span><span class="p">):</span>
        <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>                       
        <span class="n">col_coor_structure_48htype1_48htype2_init_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>               <span class="c1"># here is the difference</span>

        <span class="c1"># col_atom_mapping_48htype1_48htype2_el = f&quot;atom_mapping_48htype1_48htype2_{el}&quot;</span>
        <span class="c1"># col_atom_mapping_48htype1_48htype2_el_w_dist = f&quot;atom_mapping_48htype1_48htype2_{el}_w_dist&quot;</span>
        <span class="c1"># col_coor_weirdos_48htype1_48htype2_el_dict = f&quot;coor_weirdos_48htype1_48htype2_{el}_dict&quot;            # just added</span>
        <span class="c1"># col_coor_reducedreference_48htype1_48htype2_el = f&quot;coor_reducedreference_48htype1_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_mapped_48htype1_48htype2_el = f&quot;sum_mapped_48htype1_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_sanitycheck_48htype1_48htype2_el = f&quot;sum_sanitycheck_48htype1_48htype2_{el}&quot;</span>
        <span class="n">col_flag_48htype1_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;flag_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_weirdos_48htype1_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_weirdos_48htype1_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_weirdos_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_duplicate_closest24_w_data_48htype1_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;duplicate_closest24_w_data_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_mapped_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_sanitycheck_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>

        <span class="c1"># dataframe[col_atom_mapping_48htype1_48htype2_el] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_atom_mapping_48htype1_48htype2_el_w_dist] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_coor_reducedreference_48htype1_48htype2_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_coor_weirdos_48htype1_48htype2_el_dict] = [{el: []} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_mapped_48htype1_48htype2_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_sanitycheck_48htype1_48htype2_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_flag_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_weirdos_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_weirdos_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_duplicate_closest24_w_data_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_mapped_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_sanitycheck_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span> 

        <span class="n">coor_li48htype1_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">96</span><span class="p">]</span>
        <span class="n">coor_li24g_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">96</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">atom_mapping_el_w_dist</span> <span class="o">=</span> <span class="p">{}</span> 
            <span class="n">atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="p">{}</span> 
            <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># coor_weirdos_el_dict = {}</span>

            <span class="n">coor_origin24_el_init</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_48htype1_48htype2_init_el</span><span class="p">]</span><span class="c1">#[el]             # dataframe[&#39;subdir_orientated_positive&#39;]</span>
                                                                                            <span class="c1"># or without orientation</span>
                                                                                            <span class="c1"># dataframe[&#39;subdir_CONTCAR&#39;]</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># need this for the Operation.Distance.mic_eucledian_distance()</span>
                <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="n">coor_li48htype1_li48htype2_ref</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">coor_origin24_el_init</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    

                <span class="k">for</span> <span class="n">idxreference</span><span class="p">,</span> <span class="n">coorreference</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li48htype1_li48htype2_ref</span><span class="p">):</span>        
                    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">atom_mapping_w_dist_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">distance_prev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
                    <span class="n">closest24</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">for</span> <span class="n">idx24</span><span class="p">,</span> <span class="n">coor24</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">):</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coorreference</span><span class="p">,</span> <span class="n">coor24</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_mapping_radius_48htype1_48htype2</span><span class="p">:</span>
                            <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_prev</span><span class="p">:</span>
                                <span class="n">distance_prev</span> <span class="o">=</span> <span class="n">distance</span>
                                <span class="n">closest24</span> <span class="o">=</span> <span class="n">coor24</span>
                    
                        <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_flag_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>
                        
                    <span class="k">if</span> <span class="n">closest24</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">atom_mapping_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">closest24</span><span class="p">)</span>
                        <span class="n">atom_mapping_w_dist_dict</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_prev</span>

                        <span class="c1"># if tuple(coorreference) in atom_mapping_el_w_dist:</span>
                        <span class="c1">#     atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_w_dist_dict)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     atom_mapping_el_w_dist[tuple(coorreference)] = atom_mapping_w_dist_dict</span>
                            
                        <span class="c1"># if tuple(coorreference) in atom_mapping_el:</span>
                        <span class="c1">#     atom_mapping_el[tuple(coorreference)].append(closest24)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     atom_mapping_el[tuple(coorreference)] = tuple(closest24)</span>

                        <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">:</span>
                            <span class="n">new_entry</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">new_entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_mapping_w_dist_dict</span><span class="p">)</span>
                            <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_entry</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_mapping_w_dist_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
        
                        <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">closest24</span><span class="p">)]</span>

                    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_reducedreference_el</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">coorreference</span><span class="p">)]</span>

                <span class="n">duplicate_closest24_w_data</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">Mapping</span><span class="o">.</span><span class="n">get_duplicate_closest24_w_data</span><span class="p">(</span><span class="n">atom_mapping_el_w_dist</span><span class="p">)</span>

                <span class="c1"># get atom_mapping_el_closestduplicate</span>
                <span class="c1"># if duplicate_closest24_w_data != {}:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_closest24_w_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">Mapping</span><span class="o">.</span><span class="n">get_atom_mapping_el_w_dist_closestduplicate</span><span class="p">(</span><span class="n">atom_mapping_el_w_dist</span><span class="p">)</span>
                    <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_el</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># if atom_mapping_el_w_dist_closestduplicate != {}:</span>
                <span class="c1">#    for key, values in atom_mapping_el_w_dist_closestduplicate.items():</span>
                <span class="c1">#        # atom_mapping_el_closestduplicate[key] = [entry[&#39;closest24&#39;] for entry in values]</span>
                <span class="c1">#        atom_mapping_el_closestduplicate[key] = values[&#39;closest24&#39;]</span>

                <span class="k">if</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">closest24_values</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="c1"># If it&#39;s a list, iterate over the dictionaries in the list</span>
                            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">:</span>
                                <span class="n">closest24_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="c1"># If it&#39;s a dictionary, directly access &#39;closest24&#39;</span>
                            <span class="n">closest24_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_list</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">])</span>

                        <span class="n">atom_mapping_el_closestduplicate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest24_values</span>

                <span class="c1"># coor_weirdos_el_dict[el] = coor_weirdos_el</span>

                <span class="n">sum_weirdos_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">)</span>
                <span class="c1"># sum_mapped_el = len(coor_reducedreference_el)</span>
                <span class="n">sum_mapped_el_closestduplicate</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">)</span>

                <span class="c1"># dataframe.at[idx, col_atom_mapping_48htype1_48htype2_el] = atom_mapping_el</span>
                <span class="c1"># dataframe.at[idx, col_atom_mapping_48htype1_48htype2_el_w_dist] = atom_mapping_el_w_dist</span>
                <span class="c1"># dataframe.at[idx, col_coor_weirdos_48htype1_48htype2_el_dict] = coor_weirdos_el_dict</span>
                <span class="c1"># dataframe.at[idx, col_coor_reducedreference_48htype1_48htype2_el] = np.array(coor_reducedreference_el)</span>
                <span class="c1"># dataframe.at[idx, col_sum_mapped_48htype1_48htype2_el] = sum_mapped_el</span>
                <span class="c1"># dataframe.at[idx, col_sum_sanitycheck_48htype1_48htype2_el] = sum_mapped_el + sum_weirdos_el </span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_weirdos_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_weirdos_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_duplicate_closest24_w_data_48htype1_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">duplicate_closest24_w_data</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">)</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_mapped_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_el_closestduplicate</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_el_closestduplicate</span> <span class="o">+</span> <span class="n">sum_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_el_closestduplicate</span>

            <span class="c1"># elif coor_origin24_el_init == []:</span>
            <span class="c1">#     dataframe.at[idx, col_atom_mapping_48htype1_48htype2_el] = {} </span>
            <span class="c1">#     dataframe.at[idx, col_atom_mapping_48htype1_48htype2_el_w_dist] = {}</span>
            <span class="c1">#     dataframe.at[idx, col_sum_weirdos_48htype1_48htype2_el] = 0</span>


    <span class="k">def</span> <span class="nf">get_flag_map_weirdos_48htypesmerged_level1_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
        <span class="c1"># # col_flag_el = f&quot;flag_{el}&quot;</span>
        <span class="c1"># col_coor_weirdos_el = f&quot;coor_weirdos_{el}&quot;</span>
        <span class="c1"># col_coor_weirdos_el_dict = f&quot;coor_weirdos_{el}_dict&quot;            # just added</span>
        <span class="c1"># col_atom_mapping_el_w_dist = f&quot;atom_mapping_{el}_w_dist&quot;</span>
        <span class="c1"># col_coor_reducedreference_el = f&quot;coor_reducedreference_{el}_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>


        <span class="c1"># # col_flag_48htype1_48htype2_el = f&quot;flag_48htype1_48htype2_{el}&quot;</span>
        <span class="c1"># col_atom_mapping_48htype1_48htype2_el_w_dist = f&quot;atom_mapping_48htype1_48htype2_{el}_w_dist&quot;</span>
        <span class="c1"># col_coor_reducedreference_48htype1_48htype2_el = f&quot;coor_reducedreference_48htype1_48htype2_{el}_closestduplicate&quot;</span>
        <span class="n">col_sum_weirdos_48htype1_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_weirdos_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_atom_mapping_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htype1_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>


        <span class="n">col_flag_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;flag_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_atom_mapping_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># col_atom_mapping_48htypesmerged_level1_el_w_dist = f&quot;atom_mapping_48htypesmerged_level1_{el}_w_dist&quot;</span>
        <span class="n">col_coor_reducedreference_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_mapped_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_sanitycheck_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_ndim_coor_reducedreference_level1_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ndim_coor_reducedreference_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_ndim_coor_reducedreference_48htype2_level1_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ndim_coor_reducedreference_48htype2_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>

        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_flag_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="c1"># dataframe[col_atom_mapping_48htypesmerged_level1_el_w_dist] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_reducedreference_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_mapped_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_sanitycheck_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_reducedreference_level1_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_reducedreference_48htype2_level1_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="c1"># print(f&quot;idx_48htypesmerged: {idx}&quot;)</span>
            <span class="n">atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_closestduplicate</span><span class="p">]</span>
            <span class="n">atom_mapping_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span>
            <span class="c1"># atom_mapping_el_w_dist = dataframe.at[idx, col_atom_mapping_el_w_dist]</span>
            <span class="c1"># atom_mapping_48htype1_48htype2_el_w_dist = dataframe.at[idx, col_atom_mapping_48htype1_48htype2_el_w_dist]</span>
            <span class="c1"># coor_reducedreference_el = dataframe.at[idx, col_coor_reducedreference_el]</span>
            <span class="c1"># coor_reducedreference_48htype1_48htype2_el = dataframe.at[idx, col_coor_reducedreference_48htype1_48htype2_el]</span>
            <span class="c1"># _closestduplicate</span>
            <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_el_closestduplicate</span><span class="p">]</span>
            <span class="n">coor_reducedreference_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="p">]</span>
            <span class="c1"># # these are just copying</span>
            <span class="c1"># coor_weirdos_48htypesmerged_level1_el = dataframe.at[idx, col_coor_weirdos_48htype1_48htype2_el]</span>
            <span class="n">sum_weirdos_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_weirdos_48htype1_48htype2_el</span><span class="p">]</span>
            <span class="c1"># duplicate_closest24_w_data_48htypesmerged = dataframe.at[idx, col_duplicate_closest24_w_data_48htype1_48htype2_el]</span>
            
            <span class="c1"># # _closestduplicate</span>
            <span class="c1"># coor_reducedreference_48htypesmerged_level1_el_closestduplicate = dataframe.at[idx, col_coor_reducedreference_48htype1_48htype2_el_closestduplicate]</span>
            <span class="c1"># coor_reducedreference_48htypesmerged_level1_el = []</span>

            <span class="n">atom_mapping_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">merge_dictionaries</span><span class="p">(</span><span class="n">atom_mapping_el_closestduplicate</span><span class="p">,</span> <span class="n">atom_mapping_48htype1_48htype2_el_closestduplicate</span><span class="p">)</span>
            <span class="n">duplicate_coor24s</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">get_duplicate_values</span><span class="p">(</span><span class="n">atom_mapping_48htypesmerged_level1_el</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_coor24s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>        
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_flag_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>        
            <span class="c1"># for coorreference in atom_mapping_48htypesmerged_level1_el:</span>
            <span class="c1">#     values24 = atom_mapping_48htypesmerged_level1_el[coorreference]   # get value for the key</span>
            <span class="c1">#     if len(values24) &gt; 1:        </span>
            <span class="c1">#         dataframe.at[idx, col_flag_48htypesmerged_level1_el] = &quot;True&quot;</span>
            
            <span class="c1"># atom_mapping_48htypesmerged_level1_el_w_dist = Operation.Dict.merge_dictionaries(atom_mapping_el_w_dist, atom_mapping_48htype1_48htype2_el_w_dist)</span>

            <span class="c1"># # if coor_reducedreference_48htype1_48htype2_el != None:</span>
            <span class="c1"># # if coor_reducedreference_48htype1_48htype2_el.size &gt; 0:</span>
            <span class="c1"># if coor_reducedreference_48htype1_48htype2_el.ndim == 2:</span>
            <span class="c1">#     coor_reducedreference_48htypesmerged_level1_el = np.concatenate((coor_reducedreference_el, coor_reducedreference_48htype1_48htype2_el), axis=0)</span>
            <span class="c1"># elif coor_reducedreference_48htype1_48htype2_el.ndim == 1:</span>
            <span class="c1">#     coor_reducedreference_48htypesmerged_level1_el = np.array(coor_reducedreference_el.copy())</span>
            <span class="c1"># else:</span>
            <span class="c1">#     break</span>

            <span class="c1">## we use _closestduplicate here since it&#39;s the corrected one wrt distance</span>
            <span class="c1"># if coor_reducedreference_48htype1_48htype2_el_closestduplicate != None:</span>
            <span class="c1"># if coor_reducedreference_48htype1_48htype2_el_closestduplicate.size &gt; 0:</span>
            <span class="c1"># # # if coor_reducedreference_48htype1_48htype2_el_closestduplicate.ndim == 2:</span>
            <span class="c1"># # #     if coor_reducedreference_el_closestduplicate.ndim == 2:</span>
            <span class="c1"># # #         coor_reducedreference_48htypesmerged_level1_el_closestduplicate = np.concatenate((coor_reducedreference_el_closestduplicate, coor_reducedreference_48htype1_48htype2_el_closestduplicate), axis=0)</span>
            <span class="c1"># # #     else:</span>
            <span class="c1"># # #         print(f&quot;coor_reducedreference_el_closestduplicate has no correct dimension at idx: {idx}, dimension: {coor_reducedreference_el_closestduplicate.ndim}&quot;)</span>
            <span class="c1"># # #         pass</span>
            <span class="c1"># # #         # print(f&quot;coor_reducedreference_el_closestduplicate: \n {coor_reducedreference_el_closestduplicate}&quot;)</span>
            <span class="c1"># # # elif coor_reducedreference_48htype1_48htype2_el_closestduplicate.ndim == 1:</span>
            <span class="c1"># # #     coor_reducedreference_48htypesmerged_level1_el_closestduplicate = np.array(coor_reducedreference_el_closestduplicate.copy())</span>
            <span class="c1"># # # else:</span>
            <span class="c1"># # #     print(f&quot;coor_reducedreference_48htype1_48htype2_el_closestduplicate has no correct dimension at idx: {idx}, dimension: {coor_reducedreference_48htypesmerged_level1_el_closestduplicate.ndim}&quot;)</span>
            <span class="c1"># # #     # break</span>

            <span class="k">if</span> <span class="n">coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="n">coor_reducedreference_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">,</span> <span class="n">coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># else:</span>
                <span class="c1">#     print(f&quot;coor_reducedreference_el_closestduplicate has no correct dimension at idx: {idx}&quot;)</span>
                <span class="c1">#     continue</span>
                    <span class="c1"># print(f&quot;coor_reducedreference_el_closestduplicate: \n {coor_reducedreference_el_closestduplicate}&quot;)</span>
            <span class="k">elif</span> <span class="n">coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_reducedreference_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_reducedreference_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htype1_48htype2_el_closestduplicate or coor_reducedreference_el_closestduplicate has no correct dimension at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># break</span>

            <span class="c1"># sum_mapped_48htypesmerged_level1_el = len(atom_mapping_48htypesmerged_level1_el)</span>
            <span class="n">sum_mapped_48htypesmerged_level1_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_48htypesmerged_level1_el</span><span class="p">)</span>

            <span class="n">ndim_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span>
            <span class="n">ndim_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_48htype1_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_48htypesmerged_level1_el</span>
            <span class="c1"># dataframe.at[idx, col_atom_mapping_48htypesmerged_level1_el_w_dist] = atom_mapping_48htypesmerged_level1_el_w_dist</span>
            <span class="c1"># dataframe.at[idx, col_coor_weirdos_48htypesmerged_level1_el] = coor_weirdos_48htypesmerged_level1_el        # these are just copying</span>
            <span class="c1"># dataframe.at[idx, col_coor_reducedreference_48htypesmerged_level1_el] = coor_reducedreference_48htypesmerged_level1_el  </span>
            <span class="c1"># dataframe.at[idx, col_sum_weirdos_48htypesmerged_level1_el] = sum_weirdos_48htypesmerged_level1_el          # these are just copying</span>
            <span class="c1"># dataframe.at[idx, col_sum_mapped_48htypesmerged_level1_el] = sum_mapped_48htypesmerged_level1_el</span>
            <span class="c1"># dataframe.at[idx, col_sum_sanitycheck_48htypesmerged_level1_el] = sum_weirdos_48htypesmerged_level1_el + sum_mapped_48htypesmerged_level1_el</span>
            <span class="c1"># dataframe.at[idx, col_duplicate_closest24_w_data_48htypesmerged_level1_el] = duplicate_closest24_w_data_48htypesmerged     # these are just copying</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_reducedreference_48htypesmerged_level1_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_mapped_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_48htypesmerged_level1_el</span> 
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_48htypesmerged_level1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_48htypesmerged_level1_el</span> <span class="o">+</span> <span class="n">sum_weirdos_48htypesmerged_level1_el</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_reducedreference_level1_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_reducedreference_el_closestduplicate</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_reducedreference_48htype2_level1_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_reducedreference_48htype1_48htype2_el_closestduplicate</span>


    <span class="k">def</span> <span class="nf">get_flag_map_48htypesmerged_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># # col_flag_48htype1_48htype2_el = f&quot;flag_48htype1_48htype2_{el}&quot;</span>
            <span class="c1"># col_atom_mapping_el_w_dist = f&quot;atom_mapping_48htype1_48htype2_{el}_w_dist&quot;</span>
            <span class="c1"># col_coor_reducedreference_el = f&quot;coor_reducedreference_48htype1_48htype2_{el}&quot;</span>
            <span class="c1"># col_atom_mapping_el_closestduplicate = f&quot;atom_mapping_48htype1_48htype2_{el}_closestduplicate&quot;</span>
            <span class="c1"># col_coor_reducedreference_el_closestduplicate = f&quot;coor_reducedreference_48htype1_48htype2_{el}_closestduplicate&quot;</span>
            <span class="c1"># # col_flag_48htypesmerged_level1_el = f&quot;flag_48htypesmerged_level1_{el}&quot;</span>
            <span class="n">col_atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># col_atom_mapping_el_w_dist = f&quot;atom_mapping_48htypesmerged_level1_{el}_w_dist&quot;</span>
            <span class="n">col_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htypesmerged_level1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># # col_flag_el = f&quot;flag_{el}&quot;</span>
            <span class="c1"># col_coor_weirdos_el = f&quot;coor_weirdos_{el}&quot;</span>
            <span class="c1"># col_coor_weirdos_el_dict = f&quot;coor_weirdos_{el}_dict&quot;            # just added</span>
            <span class="c1"># col_atom_mapping_el_w_dist = f&quot;atom_mapping_{el}_w_dist&quot;</span>
            <span class="c1"># col_coor_reducedreference_el = f&quot;coor_reducedreference_{el}&quot;</span>
            <span class="n">col_atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
            <span class="n">col_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
            <span class="n">col_atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_closestduplicate&quot;</span>
            <span class="n">col_sum_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_sum_mapped_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_sum_sanitycheck_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_duplicate_closest24_w_data_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;duplicate_closest24_w_data_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_sum_mapped_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
            <span class="n">col_sum_sanitycheck_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;activate_radius is not correct&quot;</span><span class="p">)</span>

        <span class="c1"># # col_flag_48htype2_el = f&quot;flag_48htype2_{el}&quot;</span>
        <span class="c1"># col_coor_reducedreference_48htype2_el = f&quot;coor_reducedreference_48htype2_{el}&quot;</span>
        <span class="n">col_atom_mapping_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_weirdos_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_weirdos_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_coor_reducedreference_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_48htype2_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_closestduplicate&quot;</span>
        <span class="c1"># col_atom_mapping_48htype2_el_w_dist = f&quot;atom_mapping_48htype2_{el}_w_dist&quot;</span>
        <span class="c1"># col_coor_weirdos_48htype2_el = f&quot;coor_weirdos_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_mapped_48htype2_el = f&quot;sum_mapped_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_sanitycheck_48htype2_el = f&quot;sum_sanitycheck_48htype2_{el}&quot;</span>
        <span class="c1"># col_duplicate_closest24_w_data_48htype2_el = f&quot;duplicate_closest24_w_data_48htype2_{el}&quot;</span>
        <span class="c1"># col_sum_mapped_48htype2_el_closestduplicate = f&quot;sum_mapped_48htype2_{el}_closestduplicate&quot;</span>
        <span class="c1"># cocommand:cellOutput.enableScrolling?23798be1-d942-4554-a3c6-774194ee7e7el_sum_sanitycheck_48htype2_el_closestduplicate = f&quot;sum_sanitycheck_48htype2_{el}_closestduplicate&quot;</span>

        <span class="c1"># col_coor_reducedreference_48htypesmerged_el = f&quot;coor_reducedreference_48htypesmerged_{el}&quot;</span>
        <span class="c1"># col_sum_mapped_48htypesmerged_el = f&quot;sum_mapped_48htypesmerged_{el}&quot;</span>
        <span class="c1"># col_sum_sanitycheck_48htypesmerged_el = f&quot;sum_sanitycheck_48htypesmerged_{el}&quot;</span>
        <span class="n">col_flag_48htypesmerged_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;flag_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_atom_mapping_48htypesmerged_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># col_coor_weirdos_48htypesmerged_el = f&quot;coor_weirdos_48htypesmerged_{el}&quot;</span>
        <span class="c1"># col_sum_weirdos_48htypesmerged_el = f&quot;sum_weirdos_48htypesmerged_{el}&quot;</span>
        <span class="c1"># col_duplicate_closest24_w_data_48htypesmerged_el = f&quot;duplicate_closest24_w_data_48htypesmerged_{el}&quot;</span>
        <span class="n">col_coor_reducedreference_48htypesmerged_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_mapped_48htypesmerged_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_mapped_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_sum_sanitycheck_48htypesmerged_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">col_ndim_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ndim_coor_reducedreference_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_ndim_coor_reducedreference_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ndim_coor_reducedreference_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_atom_mapping_48htypesmerged_el_w_dist</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist&quot;</span>

        <span class="c1"># dataframe[col_coor_reducedreference_48htypesmerged_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_mapped_48htypesmerged_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_sanitycheck_48htypesmerged_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_flag_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="c1"># dataframe[col_atom_mapping_48htypesmerged_el_w_dist] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_coor_weirdos_48htypesmerged_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_sum_weirdos_48htypesmerged_el] = [0 for _ in range(len(dataframe.index))]</span>
        <span class="c1"># dataframe[col_duplicate_closest24_w_data_48htypesmerged_el] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_reducedreference_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_mapped_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_sanitycheck_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_reducedreference_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_reducedreference_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_48htypesmerged_el_w_dist</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="c1"># print(f&quot;idx_48htypesmerged: {idx}&quot;)</span>
            <span class="c1"># atom_mapping_el_w_dist = dataframe.at[idx, col_atom_mapping_el_w_dist]</span>
            <span class="c1"># atom_mapping_48htype2_el_w_dist = dataframe.at[idx, col_atom_mapping_48htype2_el_w_dist]</span>
            <span class="n">atom_mapping_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_closestduplicate</span><span class="p">]</span>
            <span class="n">atom_mapping_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htype2_el_closestduplicate</span><span class="p">]</span>
            <span class="c1"># coor_reducedreference_el = dataframe.at[idx, col_coor_reducedreference_el]</span>
            <span class="c1"># coor_reducedreference_48htype2_el = dataframe.at[idx, col_coor_reducedreference_48htype2_el]</span>
            <span class="c1"># _closestduplicate</span>
            <span class="n">coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_el_closestduplicate</span><span class="p">]</span>
            <span class="n">coor_reducedreference_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_48htype2_el_closestduplicate</span><span class="p">]</span>
            <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_w_dist_closestduplicate</span><span class="p">]</span>
            <span class="n">atom_mapping_48htype2_el_w_dist_closestduplicate</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htype2_el_w_dist_closestduplicate</span><span class="p">]</span>
            <span class="c1"># these are just copying</span>
            <span class="c1"># coor_weirdos_48htypesmerged_el = dataframe.at[idx, col_coor_weirdos_48htype2_el]</span>
            <span class="n">sum_weirdos_48htypesmerged_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_weirdos_48htype2_el</span><span class="p">]</span>
            <span class="c1"># duplicate_closest24_w_data_48htypesmerged = dataframe.at[idx, col_duplicate_closest24_w_data_48htype2_el]</span>
            
            <span class="c1"># # _closestduplicate</span>
            <span class="c1"># coor_reducedreference_48htypesmerged_el_closestduplicate = dataframe.at[idx, col_coor_reducedreference_48htype2_el_closestduplicate]</span>
            <span class="n">coor_reducedreference_48htypesmerged_el</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">atom_mapping_48htypesmerged_el</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">merge_dictionaries</span><span class="p">(</span><span class="n">atom_mapping_el_closestduplicate</span><span class="p">,</span> <span class="n">atom_mapping_48htype2_el_closestduplicate</span><span class="p">)</span>
            <span class="n">duplicate_coor24s</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">get_duplicate_values</span><span class="p">(</span><span class="n">atom_mapping_48htypesmerged_el</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_coor24s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>        
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_flag_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>        
            <span class="c1"># for coorreference in atom_mapping_48htypesmerged_el:</span>
            <span class="c1">#     values24 = atom_mapping_48htypesmerged_el[coorreference]   # get value for the key</span>
            <span class="c1">#     if len(values24) &gt; 1:        </span>
            <span class="c1">#         dataframe.at[idx, col_flag_48htypesmerged_el] = &quot;True&quot;</span>
            
            <span class="c1"># atom_mapping_48htypesmerged_el_w_dist = Operation.Dict.merge_dictionaries(atom_mapping_el_w_dist, atom_mapping_48htype2_el_w_dist)</span>

            <span class="c1"># # if coor_reducedreference_48htype2_el != None:</span>
            <span class="c1"># # if coor_reducedreference_48htype2_el.size &gt; 0:</span>
            <span class="c1"># if coor_reducedreference_48htype2_el.ndim == 2:</span>
            <span class="c1">#     coor_reducedreference_48htypesmerged_el = np.concatenate((coor_reducedreference_el, coor_reducedreference_48htype2_el), axis=0)</span>
            <span class="c1"># elif coor_reducedreference_48htype2_el.ndim == 1:</span>
            <span class="c1">#     coor_reducedreference_48htypesmerged_el = np.array(coor_reducedreference_el.copy())</span>
            <span class="c1"># else:</span>
            <span class="c1">#     break</span>

            <span class="c1">## we use _closestduplicate here since it&#39;s the corrected one wrt distance</span>
            <span class="c1"># if coor_reducedreference_48htype2_el_closestduplicate != None:</span>
            <span class="c1"># if coor_reducedreference_48htype2_el_closestduplicate.size &gt; 0:</span>
            <span class="c1"># # # if coor_reducedreference_48htype2_el_closestduplicate.ndim == 2:</span>
            <span class="c1"># # #     if coor_reducedreference_el_closestduplicate.ndim == 2:</span>
            <span class="c1"># # #         coor_reducedreference_48htypesmerged_el_closestduplicate = np.concatenate((coor_reducedreference_el_closestduplicate, coor_reducedreference_48htype2_el_closestduplicate), axis=0)</span>
            <span class="c1"># # #     else:</span>
            <span class="c1"># # #         print(f&quot;coor_reducedreference_el_closestduplicate has no correct dimension at idx: {idx}, dimension: {coor_reducedreference_el_closestduplicate.ndim}&quot;)</span>
            <span class="c1"># # #         pass</span>
            <span class="c1"># # #         # print(f&quot;coor_reducedreference_el_closestduplicate: \n {coor_reducedreference_el_closestduplicate}&quot;)</span>
            <span class="c1"># # # elif coor_reducedreference_48htype2_el_closestduplicate.ndim == 1:</span>
            <span class="c1"># # #     coor_reducedreference_48htypesmerged_el_closestduplicate = np.array(coor_reducedreference_el_closestduplicate.copy())</span>
            <span class="c1"># # # else:</span>
            <span class="c1"># # #     print(f&quot;coor_reducedreference_48htype2_el_closestduplicate has no correct dimension at idx: {idx}, dimension: {coor_reducedreference_48htypesmerged_el_closestduplicate.ndim}&quot;)</span>
            <span class="c1"># # #     # break</span>

            <span class="k">if</span> <span class="n">coor_reducedreference_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="n">coor_reducedreference_48htypesmerged_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="p">,</span> <span class="n">coor_reducedreference_48htype2_el_closestduplicate</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># else:</span>
                <span class="c1">#     print(f&quot;coor_reducedreference_el_closestduplicate has no correct dimension at idx: {idx}&quot;)</span>
                <span class="c1">#     continue</span>
                    <span class="c1"># print(f&quot;coor_reducedreference_el_closestduplicate: \n {coor_reducedreference_el_closestduplicate}&quot;)</span>
            <span class="k">elif</span> <span class="n">coor_reducedreference_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_reducedreference_48htypesmerged_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_reducedreference_48htypesmerged_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htype2_el_closestduplicate or coor_reducedreference_el_closestduplicate has no correct dimension at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># break</span>

            <span class="c1"># sum_mapped_48htypesmerged_el = len(atom_mapping_48htypesmerged_el)</span>
            <span class="n">sum_mapped_48htypesmerged_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_48htypesmerged_el</span><span class="p">)</span>

            <span class="n">ndim_coor_reducedreference_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span>
            <span class="n">ndim_coor_reducedreference_48htype2_el_closestduplicate</span> <span class="o">=</span> <span class="n">coor_reducedreference_48htype2_el_closestduplicate</span><span class="o">.</span><span class="n">ndim</span>

            <span class="n">atom_mapping_48htypesmerged_el_w_dist</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist_closestduplicate</span> <span class="o">|</span> <span class="n">atom_mapping_48htype2_el_w_dist_closestduplicate</span>

            <span class="c1"># dataframe.at[idx, col_coor_weirdos_48htypesmerged_el] = coor_weirdos_48htypesmerged_el        # these are just copying</span>
            <span class="c1"># dataframe.at[idx, col_coor_reducedreference_48htypesmerged_el] = coor_reducedreference_48htypesmerged_el  </span>
            <span class="c1"># dataframe.at[idx, col_sum_weirdos_48htypesmerged_el] = sum_weirdos_48htypesmerged_el          # these are just copying</span>
            <span class="c1"># dataframe.at[idx, col_sum_mapped_48htypesmerged_el] = sum_mapped_48htypesmerged_el</span>
            <span class="c1"># dataframe.at[idx, col_sum_sanitycheck_48htypesmerged_el] = sum_weirdos_48htypesmerged_el + sum_mapped_48htypesmerged_el</span>
            <span class="c1"># dataframe.at[idx, col_duplicate_closest24_w_data_48htypesmerged_el] = duplicate_closest24_w_data_48htypesmerged     # these are just copying</span>
            <span class="c1"># dataframe.at[idx, col_atom_mapping_48htypesmerged_el_w_dist] = atom_mapping_48htypesmerged_el_w_dist</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_48htypesmerged_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor_reducedreference_48htypesmerged_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_mapped_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_48htypesmerged_el</span> 
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_48htypesmerged_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_mapped_48htypesmerged_el</span> <span class="o">+</span> <span class="n">sum_weirdos_48htypesmerged_el</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_reducedreference_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_reducedreference_el_closestduplicate</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_reducedreference_48htype2_el_closestduplicate</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_reducedreference_48htype2_el_closestduplicate</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_48htypesmerged_el_w_dist</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_48htypesmerged_el_w_dist</span>


    <span class="k">class</span> <span class="nc">AtomIndexing</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_idx_weirdos_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Identifies indexes of weirdo for a specific element within structures.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - dataframe (pandas.DataFrame): DataFrame containing necessary data columns.</span>
<span class="sd">            - el (str): Element symbol for which anomalies to be identified.</span>
<span class="sd">            - activate_radius (int): Number indicating how many level of mapping radius to be used.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - idx0_weirdos_el: List of indexes of weirdos. Numeration starts from 0.</span>
<span class="sd">            - #weirdos_el: Amount of weirdos.</span>
<span class="sd">            - idx_coor_weirdos_el: Dictionary, key: index of weirdo, value: coordinate of weirdo.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">col_coor_structure_init_dict</span> <span class="o">=</span> <span class="s2">&quot;coor_structure_init_dict&quot;</span>

            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">col_idx0_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;idx0_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_nr_of_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_idx_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;idx_coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx0_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_nr_of_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_origin24_el_init</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_init_dict</span><span class="p">][</span><span class="n">el</span><span class="p">]</span>
                <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_weirdos_el</span><span class="p">]</span>
                
                <span class="n">idx_weirdos_el</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">idx_coor_weirdos_el</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">given_arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">):</span>
                    
                    <span class="c1"># coor_weirdos_el = dataframe.at[idx, col_coor_weirdos_el]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="n">given_arr</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">idx_weirdos_el</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                                <span class="n">idx_coor_weirdos_el</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx0_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_nr_of_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_weirdos_el</span><span class="p">)</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor_weirdos_el</span>


        <span class="k">def</span> <span class="nf">idx_correcting_mapped_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Given list of reference structure&#39;s coordinate (that&#39;s considered already for mapping), </span>
<span class="sd">            then they&#39;re re-ordered again aka being corrected for its indexing.</span>
<span class="sd">            Correcting done by calculating the distance of given reference to each atom of the structures,</span>
<span class="sd">            for which the closest one is considered.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - dataframe (pandas.DataFrame): DataFrame containing necessary data columns.</span>
<span class="sd">            - el (str): Element symbol for which anomalies to be identified.</span>
<span class="sd">            - activate_radius (int): Number indicating how many level of mapping radius to be used.</span>

<span class="sd">            Returns:</span>
<span class="sd">            - idx_correcting_el (list): Corrected index</span>
<span class="sd">            - coor_reducedreference_sorted_el (list): Reference coordinate with corrected ordering</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">col_coor_structure_init_dict</span> <span class="o">=</span> <span class="s2">&quot;coor_structure_init_dict&quot;</span>

            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">col_coor_reducedreference_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_coor_reducedreference_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>

            <span class="n">col_idx_correcting_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;idx_correcting_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># col_atom_mapping_el_w_dist_idx24 = f&quot;atom_mapping_{el}_w_dist_idx24&quot;</span>
            <span class="c1"># col_coor_reducedreference_closestduplicate_el = f&quot;coor_reducedreference_closestduplicate_{el}&quot;</span>
            <span class="n">col_coor_reducedreference_sorted_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_sorted_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_correcting_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="c1"># dataframe[col_atom_mapping_el_w_dist_idx24] = [{} for _ in range(len(dataframe.index))]</span>
            <span class="c1"># dataframe[col_coor_reducedreference_closestduplicate_el] = None</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_reducedreference_sorted_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_origin24_el_init</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_init_dict</span><span class="p">][</span><span class="n">el</span><span class="p">]</span> 
                <span class="n">coor_reducedreference_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_el</span><span class="p">]</span>

                <span class="n">idx_correcting_el</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># atom_mapping_el_w_dist_idx24 = {} </span>
                <span class="n">idx_coor_el</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">idxreference</span><span class="p">,</span> <span class="n">coorreference</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_reducedreference_el</span><span class="p">):</span>
                    <span class="n">distance_prev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
                    <span class="n">closest24</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">idx_closest24</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># atom_mapping_w_dist_idx24_dict = {}</span>

                    <span class="c1"># atom_mapping_el_w_dist_idx24[tuple(coorreference)] = []</span>

                    <span class="k">for</span> <span class="n">idx24</span><span class="p">,</span> <span class="n">coor24</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_origin24_el_init</span><span class="p">):</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coorreference</span><span class="p">,</span> <span class="n">coor24</span><span class="p">)</span>

                        <span class="c1"># if distance != 0:</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_prev</span><span class="p">:</span>
                            <span class="n">distance_prev</span> <span class="o">=</span> <span class="n">distance</span>
                            <span class="n">closest24</span> <span class="o">=</span> <span class="n">coor24</span>
                            <span class="n">idx_closest24</span> <span class="o">=</span> <span class="n">idx24</span>
                    
                    <span class="n">idx_correcting_el</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_closest24</span><span class="p">)</span>

                    <span class="c1"># if closest24 is not None:</span>
                    <span class="c1">#     atom_mapping_w_dist_idx24_dict[&#39;closest24&#39;] = tuple(closest24)</span>
                    <span class="c1">#     atom_mapping_w_dist_idx24_dict[&#39;dist&#39;] = distance_prev</span>
                    <span class="c1">#     atom_mapping_w_dist_idx24_dict[&#39;idx_closest24&#39;] = idx_closest24</span>

                    <span class="c1">#     # if tuple(coorreference) in atom_mapping_el_w_dist_idx24:</span>
                    <span class="c1">#     #     atom_mapping_el_w_dist_idx24[tuple(coorreference)].append(atom_mapping_w_dist_idx24_dict)</span>
                    <span class="c1">#     # else:</span>
                    <span class="c1">#     #     atom_mapping_el_w_dist_idx24[tuple(coorreference)] = atom_mapping_w_dist_idx24_dict</span>
            
                    <span class="c1">#     if tuple(coorreference) in atom_mapping_el_w_dist_idx24:</span>
                    <span class="c1">#         new_entry = atom_mapping_el_w_dist_idx24[tuple(coorreference)].copy()</span>
                    <span class="c1">#         new_entry.append(atom_mapping_w_dist_idx24_dict)</span>
                    <span class="c1">#         atom_mapping_el_w_dist_idx24[tuple(coorreference)] = new_entry</span>
                    <span class="c1">#     else:</span>
                    <span class="c1">#         atom_mapping_el_w_dist_idx24[tuple(coorreference)] = [atom_mapping_w_dist_idx24_dict.copy()]</span>

                <span class="c1"># coor_reducedreference_closestduplicate_el = [coor_reducedreference_el[i] for i in idx_correcting_el]</span>
                <span class="c1"># # coor_reducedreference_closestduplicate_el_closestduplicate = [coor_reducedreference_el_closestduplicate[i] for i in idx_correcting_el]</span>

                <span class="c1"># create a dictionary, for which key: corrected index, value: corresponding reference coordinate</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_correcting_el</span><span class="p">)):</span>
                    <span class="n">idx_coor_el</span><span class="p">[</span><span class="n">idx_correcting_el</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">coor_reducedreference_el</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">sorted_idx_coor_el</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx_coor_el</span><span class="o">.</span><span class="n">items</span><span class="p">())}</span>
                <span class="n">sorted_coor</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_idx_coor_el</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_correcting_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_correcting_el</span>
                <span class="c1"># dataframe.at[idx, col_atom_mapping_el_w_dist_idx24] = atom_mapping_el_w_dist_idx24</span>
                <span class="c1"># dataframe.at[idx, col_coor_reducedreference_closestduplicate_el] = coor_reducedreference_closestduplicate_el</span>
                <span class="c1"># # dataframe.at[idx, col_coor_reducedreference_closestduplicate_el_closestduplicate] = coor_reducedreference_closestduplicate_el_closestduplicate</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_sorted_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_coor</span>


        <span class="k">def</span> <span class="nf">get_idx_coor_limapped_weirdos_dict_litype</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
            <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>

            <span class="n">col_idx_without_weirdos</span> <span class="o">=</span> <span class="s2">&quot;idx_without_weirdos&quot;</span>
            <span class="n">col_idx_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;idx_coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_idx0_weirdos_Li</span> <span class="o">=</span> <span class="s2">&quot;idx0_weirdos_Li&quot;</span>
            <span class="n">col_sum_of_weirdos_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#weirdos_Li&quot;</span>
            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1">#col_coor_reducedreference_Li = &quot;coor_reducedreference_Li&quot;</span>
                <span class="c1"># col_coor_reducedreference_Li = f&quot;coor_reducedreference_48htypesmerged_{el}&quot; # CHANGED</span>
                <span class="n">col_coor_reducedreference_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_sorted_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="c1"># col_coor_weirdos_48htypesmerged_Li = &quot;coor_weirdos_48htypesmerged_Li&quot;</span>
                <span class="c1"># col_coor_weirdos_el = f&quot;coor_weirdos_48htype2_{el}&quot;</span>
                <span class="n">col_sum_sanitycheck_Li</span> <span class="o">=</span> <span class="s2">&quot;sum_sanitycheck_48htypesmerged_Li&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># col_coor_reducedreference_Li = f&quot;coor_reducedreference_{el}_closestduplicate&quot; # CHANGED</span>
                <span class="n">col_coor_reducedreference_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_sorted_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">col_sum_sanitycheck_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>


            <span class="n">col_idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="s2">&quot;idx_coor_limapped_weirdos_dict&quot;</span> <span class="c1">#</span>
            <span class="n">col_sum_label_and_weirdo_flag</span> <span class="o">=</span> <span class="s2">&quot;#label_and_#weirdo_flag&quot;</span>
            <span class="n">col_amount_types_and_weirdo</span> <span class="o">=</span> <span class="s2">&quot;amount_types_and_weirdo&quot;</span> <span class="c1">#</span>
            <span class="n">col_ratio_48htype1_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_48htype1_Li&quot;</span>
            <span class="n">col_ratio_48htype2_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_48htype2_Li&quot;</span>
            <span class="n">col_ratio_24g_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_24g_Li&quot;</span>
            <span class="n">col_ratio_weirdo_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_weirdo_Li&quot;</span>
            <span class="n">col_sum_amount</span> <span class="o">=</span> <span class="s2">&quot;sum_amount&quot;</span> <span class="c1">#</span>
            <span class="n">col_idx_coor_limapped_weirdos_dict_init</span> <span class="o">=</span> <span class="s2">&quot;idx_coor_limapped_weirdos_dict_init&quot;</span> <span class="c1">#</span>
            <span class="n">col_ndim_coor_reducedreference_Li</span> <span class="o">=</span> <span class="s2">&quot;ndim_coor_reducedreference_Li&quot;</span> <span class="c1">#</span>
            <span class="n">col_ndim_coor_weirdos_el</span> <span class="o">=</span> <span class="s2">&quot;ndim_coor_weirdos_el&quot;</span> <span class="c1">#</span>
            <span class="n">col_len_coor_weirdos_el</span> <span class="o">=</span> <span class="s2">&quot;len_coor_weirdos_el&quot;</span> <span class="c1">#</span>
            <span class="n">col_len_coor_reducedreference_Li</span> <span class="o">=</span> <span class="s2">&quot;len_coor_reducedreference_Li&quot;</span> 
            <span class="n">col_len_idx0_weirdos_Li</span> <span class="o">=</span> <span class="s2">&quot;len_idx0_weirdos_Li&quot;</span>
            <span class="n">col_len_idx_without_weirdos</span> <span class="o">=</span> <span class="s2">&quot;len_idx_without_weirdos&quot;</span>
            <span class="n">col_ndim_flag_coor</span> <span class="o">=</span> <span class="s2">&quot;ndim_flag_coor&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor_limapped_weirdos_dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_label_and_weirdo_flag</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_amount_types_and_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_amount</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor_limapped_weirdos_dict_init</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_idx0_weirdos_Li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_idx_without_weirdos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_flag_coor</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>

            <span class="n">coor_li24g_ref</span>      <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
                <span class="n">coor_li48htype8_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">360</span><span class="p">:</span><span class="mi">408</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">idx_coor_limapped_weirdos_dict_init</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">idx_without_weirdos</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_without_weirdos</span><span class="p">]</span>
                <span class="n">coor_reducedreference_Li</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_Li</span><span class="p">])</span>
                <span class="n">idx_coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_weirdos_el</span><span class="p">]</span>
                <span class="c1"># coor_weirdos_48htype2_el = np.array(dataframe.at[idx, col_coor_weirdos_48htype2_el])</span>
                <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">idx_coor_weirdos_el</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="n">idx0_weirdos_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx0_weirdos_Li</span><span class="p">]</span>
                <span class="n">nr_of_weirdos_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_of_weirdos_Li</span><span class="p">]</span>
                <span class="n">sum_sanitycheck_48htypesmerged_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_Li</span><span class="p">]</span>

                <span class="n">ndim_coor_reducedreference_Li</span> <span class="o">=</span> <span class="n">coor_reducedreference_Li</span><span class="o">.</span><span class="n">ndim</span>
                <span class="n">ndim_coor_weirdos_el</span> <span class="o">=</span> <span class="n">coor_weirdos_el</span><span class="o">.</span><span class="n">ndim</span>
                <span class="n">len_coor_weirdos_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">)</span>
                <span class="n">len_coor_reducedreference_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_Li</span><span class="p">)</span>
                <span class="n">len_idx0_weirdos_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span>
                <span class="n">len_idx_without_weirdos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span>

                <span class="c1"># if coor_weirdos_el.ndim == 2:</span>
                <span class="k">if</span> <span class="n">ndim_coor_reducedreference_Li</span> <span class="o">==</span> <span class="n">ndim_coor_weirdos_el</span> <span class="o">&amp;</span> <span class="n">ndim_coor_weirdos_el</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">coor_reducedreference_Li</span><span class="p">,</span> <span class="n">coor_weirdos_el</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_flag_coor</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>
                <span class="c1"># elif coor_weirdos_el.ndim == 1:</span>
                <span class="k">elif</span> <span class="n">ndim_coor_weirdos_el</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_Li</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">ndim_coor_reducedreference_Li</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coor_weirdos_el or coor_reducedreference_Li has no correct dimension at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># break</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">idx_without_weirdos</span><span class="p">,</span> <span class="n">idx0_weirdos_Li</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;idx0_weirdos_Li or idx_without_weirdos has no correct len at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># break</span>

                <span class="n">idx_coor_limapped_weirdos_dict_init</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">idx0_limapped_weirdos</span><span class="p">,</span> <span class="n">coor_limapped_weirdos</span><span class="p">))</span>

                <span class="n">coor_24g_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_weirdo_Li</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">coor_48htype1_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype2_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype3_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype4_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype5_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype6_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype7_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype8_Li</span> <span class="o">=</span> <span class="p">[]</span>   
                
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict_init</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">idx_coor_limapped_weirdos_dict_val</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">idx_24g_temp</span><span class="p">,</span> <span class="n">coor_li24g_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li24g_ref</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_li24g_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;24g&quot;</span>
                            <span class="n">coor_24g_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                                <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>
                    <span class="k">for</span> <span class="n">idx_weirdos_temp</span><span class="p">,</span> <span class="n">coor_weirdos_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_weirdos_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;weirdos&quot;</span>
                            <span class="n">coor_weirdo_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                                <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">litype</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">coor_li48htype_ref</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="sa">f</span><span class="s2">&quot;coor_li48htype</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_ref&quot;</span><span class="p">]</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;48htype</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="k">for</span> <span class="n">idx_temp</span><span class="p">,</span> <span class="n">coor_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li48htype_ref</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
                                <span class="nb">locals</span><span class="p">()[</span><span class="sa">f</span><span class="s2">&quot;coor_48htype</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_Li&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                                    <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>
                            

                    <span class="c1"># if int(key) in idx_coor_limapped_weirdos_dict:</span>
                    <span class="c1">#     idx_coor_limapped_weirdos_dict[int(key)].append(idx_coor_limapped_weirdos_dict_val)</span>
                    <span class="c1"># else:</span>
                    <span class="c1">#     idx_coor_limapped_weirdos_dict[int(key)] = idx_coor_limapped_weirdos_dict_val</span>

                <span class="c1"># amount of each type</span>
                <span class="n">amount_24g_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_24g_Li</span><span class="p">)</span>
                <span class="n">amount_weirdo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdo_Li</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype3_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype3_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_48htype3_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype3_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype3_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype4_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype4_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_48htype3_Li</span> <span class="o">+</span> <span class="n">amount_48htype4_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype3_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype3_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype4_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype4_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype5_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype5_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_48htype3_Li</span> <span class="o">+</span> <span class="n">amount_48htype4_Li</span> <span class="o">+</span> <span class="n">amount_48htype5_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype3_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype3_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype4_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype4_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype5_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype5_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype6_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype6_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_48htype3_Li</span> <span class="o">+</span> <span class="n">amount_48htype4_Li</span> <span class="o">+</span> <span class="n">amount_48htype5_Li</span> <span class="o">+</span> <span class="n">amount_48htype6_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype3_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype3_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype4_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype4_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype5_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype5_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype6_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype6_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype7_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype7_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_48htype3_Li</span> <span class="o">+</span> <span class="n">amount_48htype4_Li</span> <span class="o">+</span> <span class="n">amount_48htype5_Li</span> <span class="o">+</span> <span class="n">amount_48htype6_Li</span> <span class="o">+</span> <span class="n">amount_48htype7_Li</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype3_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype3_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype4_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype4_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype5_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype5_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype6_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype6_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype7_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype7_Li</span><span class="p">)</span>
                    <span class="n">amount_48htype8_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype8_Li</span><span class="p">)</span>
                    <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_48htype3_Li</span> <span class="o">+</span> <span class="n">amount_48htype4_Li</span> <span class="o">+</span> <span class="n">amount_48htype5_Li</span> <span class="o">+</span> <span class="n">amount_48htype6_Li</span> <span class="o">+</span> <span class="n">amount_48htype7_Li</span> <span class="o">+</span> <span class="n">amount_48htype8_Li</span>


                <span class="c1"># sanity check for the amount</span>
                <span class="c1"># if amount_weirdo == nr_of_weirdos_Li &amp; sum_amount == sum_sanitycheck_48htypesmerged_Li:</span>
                <span class="c1"># if int(amount_weirdo) == int(nr_of_weirdos_Li) &amp; int(sum_amount) == int(sum_sanitycheck_48htypesmerged_Li):</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount_weirdo</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">nr_of_weirdos_Li</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sum_amount</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sum_sanitycheck_48htypesmerged_Li</span><span class="p">):</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_label_and_weirdo_flag</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>

                <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 48htype3: </span><span class="si">{</span><span class="n">amount_48htype3_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 48htype3: </span><span class="si">{</span><span class="n">amount_48htype3_Li</span><span class="si">}</span><span class="s2">, 48htype4: </span><span class="si">{</span><span class="n">amount_48htype4_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 48htype3: </span><span class="si">{</span><span class="n">amount_48htype3_Li</span><span class="si">}</span><span class="s2">, 48htype4: </span><span class="si">{</span><span class="n">amount_48htype4_Li</span><span class="si">}</span><span class="s2">, 48htype5: </span><span class="si">{</span><span class="n">amount_48htype5_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 48htype3: </span><span class="si">{</span><span class="n">amount_48htype3_Li</span><span class="si">}</span><span class="s2">, 48htype4: </span><span class="si">{</span><span class="n">amount_48htype4_Li</span><span class="si">}</span><span class="s2">, 48htype5: </span><span class="si">{</span><span class="n">amount_48htype5_Li</span><span class="si">}</span><span class="s2">, 48htype6: </span><span class="si">{</span><span class="n">amount_48htype6_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 48htype3: </span><span class="si">{</span><span class="n">amount_48htype3_Li</span><span class="si">}</span><span class="s2">, 48htype4: </span><span class="si">{</span><span class="n">amount_48htype4_Li</span><span class="si">}</span><span class="s2">, 48htype5: </span><span class="si">{</span><span class="n">amount_48htype5_Li</span><span class="si">}</span><span class="s2">, 48htype6: </span><span class="si">{</span><span class="n">amount_48htype6_Li</span><span class="si">}</span><span class="s2">, 48htype7: </span><span class="si">{</span><span class="n">amount_48htype7_Li</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">, 48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 48htype3: </span><span class="si">{</span><span class="n">amount_48htype3_Li</span><span class="si">}</span><span class="s2">, 48htype4: </span><span class="si">{</span><span class="n">amount_48htype4_Li</span><span class="si">}</span><span class="s2">, 48htype5: </span><span class="si">{</span><span class="n">amount_48htype5_Li</span><span class="si">}</span><span class="s2">, 48htype6: </span><span class="si">{</span><span class="n">amount_48htype6_Li</span><span class="si">}</span><span class="s2">, 48htype7: </span><span class="si">{</span><span class="n">amount_48htype7_Li</span><span class="si">}</span><span class="s2">, 48htype8: </span><span class="si">{</span><span class="n">amount_48htype8_Li</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># ratio_48htype1_Li = amount_48htype1_Li / sum_amount</span>
                <span class="c1"># ratio_48htype2_Li = amount_48htype2_Li / sum_amount</span>
                <span class="c1"># ratio_24g_Li = amount_24g_Li / sum_amount</span>
                <span class="c1"># ratio_weirdo_Li = amount_weirdo / sum_amount</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_limapped_weirdos_dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_amount_types_and_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_types_and_weirdo</span>
                <span class="c1"># dataframe.at[idx, col_ratio_48htype1_Li] = ratio_48htype1_Li</span>
                <span class="c1"># dataframe.at[idx, col_ratio_48htype2_Li] = ratio_48htype2_Li</span>
                <span class="c1"># dataframe.at[idx, col_ratio_24g_Li] = ratio_24g_Li</span>
                <span class="c1"># dataframe.at[idx, col_ratio_weirdo_Li] = ratio_weirdo_Li</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_amount</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_amount</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_limapped_weirdos_dict_init</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_init</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_reducedreference_Li</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_coor_weirdos_el</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_coor_reducedreference_Li</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_idx0_weirdos_Li</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_idx0_weirdos_Li</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_idx_without_weirdos</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_idx_without_weirdos</span>


    <span class="k">class</span> <span class="nc">Labelling</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_distance_weirdos_label_el</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">litype</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># to do: add idx of weirdo and coorreference</span>
            <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
            <span class="n">col_idx_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;idx_coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">col_top3_sorted_idxweirdo_dist_label_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top3_sorted_idxweirdo_dist_label_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top3_sorted_idxweirdo_dist_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top3_sorted_idxweirdo_dist_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top3_sorted_idxweirdo_label_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top3_sorted_idxweirdo_label_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top1_sorted_idxweirdo_dist_label_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top1_sorted_idxweirdo_dist_label_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top1_sorted_idxweirdo_dist_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top1_sorted_idxweirdo_dist_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top1_sorted_idxweirdo_label_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top1_sorted_idxweirdo_label_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top1_sorted_idxweirdo_coor_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top1_sorted_idxweirdo_coor_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">col_top1_sorted_idxweirdo_file_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top1_sorted_idxweirdo_file_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>

            <span class="n">col_sum_closest_24g_el</span>      <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_24g_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_24g_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype3_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype3_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype3_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype3_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype4_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype4_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype3_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype3_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype4_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype4_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype5_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype5_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype3_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype3_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype4_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype4_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype5_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype5_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype6_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype6_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype6_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype3_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype3_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype4_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype4_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype5_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype5_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype6_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype6_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype7_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype7_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype6_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype7_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">col_sum_closest_48htype1_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype1_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype2_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype2_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype3_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype3_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype4_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype4_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype5_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype5_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype6_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype6_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype7_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype7_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">col_sum_closest_48htype8_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#closest_48htype8_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype6_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype7_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
                <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_closest_48htype8_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>


            <span class="c1"># dataframe[col_top3_dist_weirdos_array_el] = None</span>
            <span class="c1"># dataframe[col_top3_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = [{} for _ in range(len(dataframe.index))]</span>
            <span class="c1"># dataframe[col_dist_weirdos_atomreference_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
            <span class="c1"># dataframe[col_dist_weirdos_el] = [np.array([]) for _ in range(len(dataframe.index))]</span>
            <span class="c1"># dataframe[col_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = [{} for _ in range(len(dataframe.index))]</span>
            <span class="c1"># dataframe[col_sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = [{} for _ in range(len(dataframe.index))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top3_sorted_idxweirdo_dist_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top3_sorted_idxweirdo_dist_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top3_sorted_idxweirdo_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top1_sorted_idxweirdo_dist_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top1_sorted_idxweirdo_dist_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top1_sorted_idxweirdo_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top1_sorted_idxweirdo_coor_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top1_sorted_idxweirdo_file_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            
            <span class="n">coor_li24g_ref</span>      <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">,</span> <span class="n">coor_li48htype6_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">,</span> <span class="n">coor_li48htype6_ref</span><span class="p">,</span> <span class="n">coor_li48htype7_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype7&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
                <span class="n">coor_li48htype8_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">360</span><span class="p">:</span><span class="mi">408</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">,</span> <span class="n">coor_li48htype6_ref</span><span class="p">,</span> <span class="n">coor_li48htype7_ref</span><span class="p">,</span> <span class="n">coor_li48htype8_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype7&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype8&quot;</span><span class="p">]</span>


            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">dist_weirdos_atomreference_el</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">dist_weirdos_el</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top3_sorted_idxweirdo_dist_label_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top3_sorted_idxweirdo_dist_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top3_sorted_idxweirdo_label_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top1_sorted_idxweirdo_dist_label_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top1_sorted_idxweirdo_label_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top1_sorted_idxweirdo_dist_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top1_sorted_idxweirdo_coor_el</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">top1_sorted_idxweirdo_file_el</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">idx_coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_weirdos_el</span><span class="p">]</span>
                <span class="n">idx_weirdos_el</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">idx_coor_weirdos_el</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_weirdos_el</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idx_weirdo</span> <span class="ow">in</span> <span class="n">idx_weirdos_el</span><span class="p">:</span>
                        <span class="n">coor_weirdo</span> <span class="o">=</span> <span class="n">idx_coor_weirdos_el</span><span class="p">[</span><span class="n">idx_weirdo</span><span class="p">]</span>
                        <span class="n">distance_weirdo_prev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>

                        <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">[</span><span class="n">idx_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        
                        <span class="k">for</span> <span class="n">idxreference</span><span class="p">,</span> <span class="n">coorreference</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_reference_el_init</span><span class="p">):</span>
                            <span class="n">coorweirdo_dist_label_coorreference_val_el</span> <span class="o">=</span> <span class="p">{}</span>
                    
                            <span class="n">distance_weirdo</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coorreference</span><span class="p">,</span> <span class="n">coor_weirdo</span><span class="p">)</span>

                            <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_weirdo</span>

                            <span class="k">for</span> <span class="n">idx_24g_temp</span><span class="p">,</span> <span class="n">coor_li24g_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li24g_ref</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">coorreference</span> <span class="o">==</span> <span class="n">coor_li24g_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                    <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;coor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coor_weirdo</span><span class="p">)</span>
                                    <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;24g&quot;</span>
                                    <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;coorreference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)</span>
                                    <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
                                    <span class="k">if</span> <span class="n">idx_weirdo</span> <span class="ow">in</span> <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">:</span>
                                        <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">[</span><span class="n">idx_weirdo</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">[</span><span class="n">idx_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="n">coorweirdo_dist_label_coorreference_val_el</span>

                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">litype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">coor_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinate_lists</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="n">coorreference</span> <span class="o">==</span> <span class="n">coor_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                        <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;coor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coor_weirdo</span><span class="p">)</span>
                                        <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                                        <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;coorreference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)</span>
                                        <span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

                                        <span class="k">if</span> <span class="n">idx_weirdo</span> <span class="ow">in</span> <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">:</span>
                                            <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">[</span><span class="n">idx_weirdo</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">)</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="p">[</span><span class="n">idx_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">coorweirdo_dist_label_coorreference_val_el</span><span class="p">]</span>

                            <span class="k">if</span> <span class="n">distance_weirdo</span> <span class="o">&lt;</span> <span class="n">distance_weirdo_prev</span><span class="p">:</span>
                                <span class="n">distance_weirdo_prev</span> <span class="o">=</span> <span class="n">distance_weirdo</span>
                                <span class="n">closestreference</span> <span class="o">=</span> <span class="n">coorreference</span>

                        <span class="n">dist_weirdos_atomreference_el_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance_weirdo</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coor_weirdo</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">closestreference</span><span class="p">)]</span>
                        <span class="n">dist_weirdos_el_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance_weirdo</span><span class="p">]</span>
                        <span class="n">dist_weirdos_atomreference_el</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_weirdos_atomreference_el_array</span><span class="p">)</span>
                        <span class="n">dist_weirdos_el</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_weirdos_el_array</span><span class="p">)</span>
                        <span class="c1"># float_dist_weirdos_el = np.append(float_dist_weirdos_el, [distance_weirdo_prev])</span>

                        <span class="c1"># sorted_dist_weirdos_array_el = sorted(set(dist_weirdos_array_el))</span>
                        <span class="c1"># top3_dist_weirdos_array_el = sorted_dist_weirdos_array_el[0:3]</span>

                        <span class="c1"># coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el[&#39;top3_dist&#39;] = top3_dist_weirdos_array_el</span>

                        <span class="c1"># if tuple(coor_weirdo) in top3_dist_weirdos_el:</span>
                        <span class="c1">#     top3_dist_weirdos_el[tuple(coor_weirdo)].append(coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     top3_dist_weirdos_el[tuple(coor_weirdo)] = coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span>

                        <span class="c1"># for key_temp1, val_temp1 in coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el.items():</span>
                        <span class="c1">#     sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el = {key_temp1: sorted(val_temp1, key=lambda x: x[&#39;dist&#39;])}</span>
                        <span class="n">sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span> <span class="o">=</span> <span class="p">{</span>
                                                                            <span class="n">k</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">])</span>
                                                                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                                                        <span class="p">}</span>
                        
                        <span class="n">top3_sorted_coorweirdo_dist_label_coorreference_el</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">top3_sorted_coorweirdo_dist_label_coorreference_el</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">selected_values</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top3_sorted_idxweirdo_dist_label_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_values</span>
                            <span class="n">selected_dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top3_sorted_idxweirdo_dist_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_dists</span>
                            <span class="n">selected_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top3_sorted_idxweirdo_label_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_types</span>

                        <span class="n">top1_sorted_coorweirdo_dist_label_coorreference_el</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">top1_sorted_coorweirdo_dist_label_coorreference_el</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">top1_selected_values</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top1_sorted_idxweirdo_dist_label_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">top1_selected_values</span>
                            <span class="n">selected_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top1_sorted_idxweirdo_label_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_types</span>
                            <span class="n">selected_dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top1_sorted_idxweirdo_dist_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_dists</span>
                            <span class="n">selected_coors</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top1_sorted_idxweirdo_coor_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_coors</span>
                            <span class="n">selected_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">]</span>
                            <span class="n">top1_sorted_idxweirdo_file_el</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_files</span>

                        <span class="c1"># Types to count</span>
                        <span class="n">types_to_count</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;48htype</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">litype</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span>

                        <span class="c1"># Initialize counts</span>
                        <span class="n">type_counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types_to_count</span><span class="p">}</span>

                        <span class="c1"># Count occurrences</span>
                        <span class="k">for</span> <span class="n">closest_type</span> <span class="ow">in</span> <span class="n">top1_sorted_idxweirdo_label_el</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">closest_type</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">type_counts</span><span class="p">:</span>
                                    <span class="n">type_counts</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c1"># # dataframe.at[idx, col_dist_weirdos_atomreference_el] = sorted(dist_weirdos_atomreference_el, coor_weirdo=lambda x: x[0]) </span>
                    <span class="c1"># dataframe.at[idx, col_dist_weirdos_el] = np.array([coorreference[0] for index, coorreference in enumerate(dist_weirdos_atomreference_el)])</span>
                    <span class="c1"># # dataframe.at[idx, col_dist_weirdos_el] = sorted(dist_weirdos_el, coor_weirdo=lambda x: x[0]) </span>
                    <span class="c1"># dataframe.at[idx, col_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span>
                    <span class="c1"># dataframe.at[idx, col_sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top3_sorted_idxweirdo_dist_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top3_sorted_idxweirdo_dist_label_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top3_sorted_idxweirdo_dist_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top3_sorted_idxweirdo_dist_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top3_sorted_idxweirdo_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top3_sorted_idxweirdo_label_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_dist_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top1_sorted_idxweirdo_dist_label_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_dist_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top1_sorted_idxweirdo_dist_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_label_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top1_sorted_idxweirdo_label_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_coor_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top1_sorted_idxweirdo_coor_el</span>
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_file_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">top1_sorted_idxweirdo_file_el</span>
                    
                    <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_24g_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype6_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype6_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype7_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype7&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype1_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype2_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype3_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype4_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype5_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype6_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype7_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype7&#39;</span><span class="p">]</span>
                        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_closest_48htype8_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="p">[</span><span class="s1">&#39;48htype8&#39;</span><span class="p">]</span>

                    <span class="c1"># dataframe.at[idx, col_top3_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = top3_dist_weirdos_el</span>
                    <span class="c1"># print(coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el)</span>
                <span class="c1"># else:</span>
                <span class="c1">#     dataframe.at[idx, col_dist_weirdos_atomreference_el] = {}</span>
                <span class="c1">#     # dataframe.at[idx, col_dist_weirdos_el] = np.array([coorreference[0] for index, coorreference in enumerate(dist_weirdos_atomreference_el)])</span>
                <span class="c1">#     dataframe.at[idx, col_dist_weirdos_el] = []</span>
                <span class="c1">#     dataframe.at[idx, col_top3_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_el] = []</span>


        <span class="k">def</span> <span class="nf">get_label_mapping</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">litype</span><span class="p">):</span>
            <span class="c1"># TO DO: split into elementwise</span>

            <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_atom_mapping_el_w_dist</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_closestduplicate&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">col_atom_mapping_el_w_dist</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist&quot;</span>
            
            <span class="n">col_atom_mapping_el_w_dist_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_label&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_el_w_dist_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

            <span class="n">coor_li24g_ref</span>      <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">,</span> <span class="n">coor_li48htype6_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">,</span> <span class="n">coor_li48htype6_ref</span><span class="p">,</span> <span class="n">coor_li48htype7_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype7&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>
                <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>
                <span class="n">coor_li48htype3_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">168</span><span class="p">]</span>
                <span class="n">coor_li48htype4_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">168</span><span class="p">:</span><span class="mi">216</span><span class="p">]</span>
                <span class="n">coor_li48htype5_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">216</span><span class="p">:</span><span class="mi">264</span><span class="p">]</span>
                <span class="n">coor_li48htype6_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">264</span><span class="p">:</span><span class="mi">312</span><span class="p">]</span>
                <span class="n">coor_li48htype7_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">312</span><span class="p">:</span><span class="mi">360</span><span class="p">]</span>
                <span class="n">coor_li48htype8_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">360</span><span class="p">:</span><span class="mi">408</span><span class="p">]</span>
                <span class="n">coordinate_lists</span>    <span class="o">=</span> <span class="p">[</span><span class="n">coor_li48htype1_ref</span><span class="p">,</span> <span class="n">coor_li48htype2_ref</span><span class="p">,</span> <span class="n">coor_li48htype3_ref</span><span class="p">,</span> <span class="n">coor_li48htype4_ref</span><span class="p">,</span> <span class="n">coor_li48htype5_ref</span><span class="p">,</span> <span class="n">coor_li48htype6_ref</span><span class="p">,</span> <span class="n">coor_li48htype7_ref</span><span class="p">,</span> <span class="n">coor_li48htype8_ref</span><span class="p">]</span>
                <span class="n">labels</span>              <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype7&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype8&quot;</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">atom_mapping_el_w_dist</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_w_dist</span><span class="p">]</span>

                <span class="n">atom_mapping_el_w_dist_label</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">coorreference</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="c1"># Handle the case where the value is a list</span>
                        <span class="n">atom_mapping_el_w_dist_label_val</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;closest24&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;closest24&#39;</span><span class="p">],</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Handle the case where the value is a dictionary</span>
                        <span class="n">atom_mapping_el_w_dist_label_val</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;closest24&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;closest24&#39;</span><span class="p">],</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]}</span>

                    <span class="c1"># # atom_mapping_el_w_dist_label_val = {}</span>
                    <span class="c1"># # atom_mapping_el_w_dist_label[tuple(coorreference)] = []</span>
                    <span class="c1"># atom_mapping_el_w_dist_label_val = {&#39;closest24&#39;: atom_mapping_el_w_dist[tuple(coorreference)][0][&#39;closest24&#39;], &#39;dist&#39;: atom_mapping_el_w_dist[tuple(coorreference)][0][&#39;dist&#39;]}</span>

                    <span class="k">for</span> <span class="n">idx_li24g_temp</span><span class="p">,</span> <span class="n">coor_li24g_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li24g_ref</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">coorreference</span> <span class="o">==</span> <span class="n">coor_li24g_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">atom_mapping_el_w_dist_label_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;24g&quot;</span>

                            <span class="n">atom_mapping_el_w_dist_label</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist_label_val</span>
                            <span class="c1"># atom_mapping_el_w_dist_label[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">litype</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">coor_li48htype_ref</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="sa">f</span><span class="s2">&quot;coor_li48htype</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_ref&quot;</span><span class="p">]</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;48htype</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="k">for</span> <span class="n">idx_temp</span><span class="p">,</span> <span class="n">coor_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li48htype_ref</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">coorreference</span> <span class="o">==</span> <span class="n">coor_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">atom_mapping_el_w_dist_label_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
                                <span class="n">atom_mapping_el_w_dist_label</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coorreference</span><span class="p">)]</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist_label_val</span>
                                <span class="c1"># atom_mapping_el_w_dist_label[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>


                    <span class="c1"># # for idx_li48htype1_temp, coor_li48htype1_ref_temp in enumerate(coor_li48htype1_ref):</span>
                    <span class="c1"># #     if (coorreference == coor_li48htype1_ref_temp).all():</span>
                    <span class="c1"># #         atom_mapping_el_w_dist_label_val[&quot;label&quot;] = &quot;48htype1&quot;</span>

                    <span class="c1"># #         atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>

                    <span class="c1"># # for idx_li48htype2_temp, coor_li48htype2_ref_temp in enumerate(coor_li48htype2_ref):</span>
                    <span class="c1"># #     if (coorreference == coor_li48htype2_ref_temp).all():</span>
                    <span class="c1"># #         atom_mapping_el_w_dist_label_val[&quot;label&quot;] = &quot;48htype2&quot;</span>

                    <span class="c1"># #         atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>

                    <span class="c1"># # for idx_li24g_temp, coor_li24g_ref_temp in enumerate(coor_li24g_ref):</span>
                    <span class="c1"># #     if (coorreference == coor_li24g_ref_temp).all():</span>
                    <span class="c1"># #         atom_mapping_el_w_dist_label_val[&quot;label&quot;] = &quot;24g&quot;</span>

                    <span class="c1"># #         atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>

                    <span class="c1"># # if litype == 3:</span>
                    <span class="c1"># #     for idx_li48htype3_temp, coor_li48htype3_ref_temp in enumerate(coor_li48htype3_ref):</span>
                    <span class="c1"># #         if (coorreference == coor_li48htype3_ref_temp).all():</span>
                    <span class="c1"># #             atom_mapping_el_w_dist_label_val[&quot;label&quot;] = &quot;48htype3&quot;</span>

                    <span class="c1"># #             atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>

                    <span class="c1"># # elif litype == 4:</span>
                    <span class="c1"># #     for idx_li48htype3_temp, coor_li48htype3_ref_temp in enumerate(coor_li48htype3_ref):</span>
                    <span class="c1"># #         if (coorreference == coor_li48htype3_ref_temp).all():</span>
                    <span class="c1"># #             atom_mapping_el_w_dist_label_val[&quot;label&quot;] = &quot;48htype3&quot;</span>

                    <span class="c1"># #             atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>

                    <span class="c1"># #     for idx_li48htype4_temp, coor_li48htype4_ref_temp in enumerate(coor_li48htype4_ref):</span>
                    <span class="c1"># #         if (coorreference == coor_li48htype4_ref_temp).all():</span>
                    <span class="c1"># #             atom_mapping_el_w_dist_label_val[&quot;label&quot;] = &quot;48htype4&quot;</span>

                    <span class="c1"># #             atom_mapping_el_w_dist[tuple(coorreference)].append(atom_mapping_el_w_dist_label_val)</span>
            
                <span class="c1"># # dataframe.at[idx, col_atom_mapping_el_w_dist_label] = atom_mapping_el_w_dist</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_atom_mapping_el_w_dist_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_mapping_el_w_dist_label</span>


        <span class="k">def</span> <span class="nf">get_amount_type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
            <span class="n">col_atom_mapping_el_w_dist_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_label&quot;</span>
            <span class="n">col_amount_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>

            <span class="n">col_amount_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;amount_type_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_amount_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

                <span class="n">atom_mapping_el_w_dist_label</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_atom_mapping_el_w_dist_label</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">amount_weirdo</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_amount_weirdos_el</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

                <span class="n">label_count</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype7&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;48htype1&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype2&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype3&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype4&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype5&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype6&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype7&quot;</span><span class="p">,</span> <span class="s2">&quot;48htype8&quot;</span><span class="p">,</span> <span class="s2">&quot;24g&quot;</span><span class="p">,</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="n">label_count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_label</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                    <span class="n">label_count</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">label_count</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_weirdo</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_amount_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_count</span>
            

    <span class="k">class</span> <span class="nc">OutputCIF</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">create_combine_structure</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">var_savefilename</span><span class="p">):</span>
            <span class="c1">## TO DO: under maintenance for disambled into el</span>
            <span class="c1"># CHANGED FOR INDEXING</span>
            <span class="c1"># # # # # if activate_radius == 2 or activate_radius == 3:</span>
            <span class="c1"># # # # #     col_coor_reducedreference_el = f&quot;coor_reducedreference_48htypesmerged_Li&quot;</span>
            <span class="c1"># # # # # elif activate_radius == 1:</span>
            <span class="c1"># # # # #     col_coor_reducedreference_el = f&quot;coor_reducedreference_Li_closestduplicate&quot;</span>
            <span class="n">col_coor_reducedreference_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_sorted_Li&quot;</span>
                            
            <span class="c1"># col_coor_reducedreference_closestduplicate_Li_closestduplicate = f&quot;coor_reducedreference_closestduplicate_Li_closestduplicate&quot; # !!!!!</span>
            <span class="c1"># col_coor_reducedreference_closestduplicate_Li = f&quot;coor_reducedreference_closestduplicate_Li&quot; # !!!!!</span>
            <span class="n">col_coor_structure_init_dict</span> <span class="o">=</span> <span class="s2">&quot;coor_structure_init_dict&quot;</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_combined</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># new_structure = Structure.from_file(dataframe[&#39;subdir_orientated_positive&#39;][idx])</span>
                <span class="c1"># new_structure = Structure.from_file(dataframe[&#39;subdir_orientated_positive_poscar&#39;][idx])</span>
                <span class="n">new_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;subdir_positive_CONTCAR&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">coor_origin24_init</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_structure_init_dict</span><span class="p">]</span>
                <span class="c1"># coor_reducedreference_Li = dataframe.at[idx, col_coor_reducedreference_closestduplicate_Li]</span>
                <span class="c1"># coor_reducedreference_Li = dataframe.at[idx, col_coor_reducedreference_closestduplicate_Li_closestduplicate]</span>
                <span class="n">coor_reducedreference_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_el</span><span class="p">]</span>

                <span class="n">coor_structure_init_P</span> <span class="o">=</span> <span class="n">coor_origin24_init</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span>
                <span class="n">coor_structure_init_S</span> <span class="o">=</span> <span class="n">coor_origin24_init</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span>
                <span class="n">coor_structure_init_Cl</span> <span class="o">=</span> <span class="n">coor_origin24_init</span><span class="p">[</span><span class="s2">&quot;Cl&quot;</span><span class="p">]</span>

                <span class="n">coor_mapped_Li</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_Li</span><span class="p">)</span>
                <span class="n">coor_origin_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_structure_init_P</span><span class="p">)</span>
                <span class="n">coor_origin_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_structure_init_S</span><span class="p">)</span>
                <span class="n">coor_origin_Cl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_structure_init_Cl</span><span class="p">)</span>
            
                <span class="c1">## get the combined coordinate of the mapped Li with all other original elements</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">coor_mapped_Li</span><span class="p">:</span>
                    <span class="n">coor_combined</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">coor_origin_P</span><span class="p">:</span>
                    <span class="n">coor_combined</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">coor_origin_S</span><span class="p">:</span>
                    <span class="n">coor_combined</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">coor_origin_Cl</span><span class="p">:</span>
                    <span class="n">coor_combined</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
                
                <span class="n">coor_combined_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">coor_combined</span><span class="p">]</span>

                <span class="c1">## getting the index</span>
                <span class="n">amount_Li_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_Li</span><span class="p">)</span>
                <span class="n">amount_P_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_structure_init_P</span><span class="p">)</span>
                <span class="n">amount_S_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_structure_init_S</span><span class="p">)</span>
                <span class="n">amount_Cl_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_structure_init_Cl</span><span class="p">)</span>

                <span class="c1"># TO DO: write manually to change the line with Li{i}, where i = #of index based on the orientated positive</span>
                <span class="n">idx_mapped_Li</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">amount_Li_temp</span><span class="p">)</span>
                <span class="n">idx_origin_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">amount_P_temp</span><span class="p">)</span> <span class="o">+</span> <span class="n">amount_Li</span>
                <span class="n">idx_origin_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">amount_S_temp</span><span class="p">)</span> <span class="o">+</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">amount_P</span>
                <span class="n">idx_origin_Cl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">amount_Cl_temp</span><span class="p">)</span> <span class="o">+</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span>

                <span class="n">idx_species_combined_idx0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">idx_mapped_Li</span><span class="p">,</span> <span class="n">idx_origin_P</span><span class="p">,</span> <span class="n">idx_origin_S</span><span class="p">,</span> <span class="n">idx_origin_Cl</span><span class="p">))</span>
                <span class="n">idx_species_combined_idx0_int</span> <span class="o">=</span> <span class="n">idx_species_combined_idx0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="c1">## creating the structure file of combined elements</span>
                <span class="n">selected_species_combined</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_structure</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_species_combined_idx0_int</span><span class="p">]</span>
                <span class="n">structure_combined</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">new_structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">selected_species_combined</span><span class="p">,</span> <span class="n">coor_combined_array</span><span class="p">)</span>
                <span class="n">cif_combined</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">structure_combined</span><span class="p">)</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>
                <span class="n">cif_combined</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">rewrite_cif_w_correct_Li_idx</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">amount_Cl</span><span class="p">,</span> <span class="n">var_savefilename_init</span><span class="p">,</span> <span class="n">var_savefilename_new</span><span class="p">):</span>
            <span class="n">col_idx0_weirdos_Li</span> <span class="o">=</span> <span class="s2">&quot;idx0_weirdos_Li&quot;</span>
            
            <span class="n">col_idx_without_weirdos</span> <span class="o">=</span> <span class="s2">&quot;idx_without_weirdos&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_without_weirdos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            
            <span class="n">search_string</span> <span class="o">=</span> <span class="s2">&quot;Li  Li0&quot;</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">idx0_weirdos_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx0_weirdos_Li</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_init</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

                <span class="n">source_filename_filtered</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_new</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">destination_path_combined_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename_filtered</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                <span class="c1"># added: check if the search_string is found</span>
                <span class="n">search_string_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">idx_line</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">search_string</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">search_string_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">idx_Li_start</span> <span class="o">=</span> <span class="n">idx_line</span>
                        <span class="k">break</span>

                <span class="n">idx_without_weirdos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_Li</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx0_weirdos_Li</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">search_string_found</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># idx_without_weirdos = [i for i in range(amount_Li) if i not in idx0_weirdos_Li]</span>

                    <span class="n">new_text</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)):</span>
                        <span class="n">idx_line</span> <span class="o">=</span> <span class="n">idx_Li_start</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">):</span>
                            <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Li</span><span class="si">{</span><span class="n">idx_without_weirdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="c1"># file_operations_instance = Operation.File()</span>
                            <span class="c1"># modified_line = lines[idx_line].file_operations_instance.replace(lines[idx_line].split()[1], new_label)     </span>
                            <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                            <span class="n">new_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>
                            
                    <span class="n">lines</span><span class="p">[</span><span class="n">idx_Li_start</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx_Li_start</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_text</span>

                    <span class="c1"># idx_weirdo_line_start   = len(idx_without_weirdos) + idx_Li_start</span>
                    <span class="c1"># idx_weirdo_line_end     = idx_weirdo_line_start + len(idx0_weirdos_Li)</span>
                    <span class="c1"># lines[idx_weirdo_line_start : idx_weirdo_line_end] = weirdos_text</span>

                    <span class="n">idx_P_S_Cl_line_new_start</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx_Li_start</span>
                    <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputCIF</span><span class="o">.</span><span class="n">EditCIF</span><span class="o">.</span><span class="n">reindex_P_S_Cl</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">idx_Li_start</span><span class="p">,</span> <span class="n">idx_without_weirdos</span><span class="p">,</span> <span class="n">idx_P_S_Cl_line_new_start</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">amount_Cl</span><span class="p">)</span>

                    <span class="c1"># dataframe.at[idx, col_idx_without_weirdos] = idx_without_weirdos</span>

                    <span class="c1"># with open(destination_path_combined_new, &quot;w&quot;) as f:</span>
                    <span class="c1">#     f.write(&quot;\n&quot;.join(line.strip() for line in lines))</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_without_weirdos</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_without_weirdos</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path_combined_new</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">))</span>


        <span class="c1"># new needed variables: amount_P, amount_S, amount_Cl</span>
        <span class="k">def</span> <span class="nf">rewrite_cif_w_correct_Li_idx_weirdos_appended</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">amount_Cl</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">var_savefilename_init</span><span class="p">,</span> <span class="n">var_savefilename_new</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype2_Li&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_Li&quot;</span>

            <span class="c1"># col_subdir_cif_w_correct_Li_idx_weirdos_appended = &quot;subdir_cif_w_correct_Li_idx_weirdos_appended&quot;</span>

            <span class="c1"># dataframe[col_subdir_cif_w_correct_Li_idx_weirdos_appended] = None</span>
            
            <span class="n">search_string</span> <span class="o">=</span> <span class="s2">&quot;Li  Li0&quot;</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">idx0_weirdos_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_init</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

                <span class="n">source_filename_filtered</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_new</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">destination_path_combined_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename_filtered</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                <span class="c1"># added: check if the search_string is found</span>
                <span class="n">search_string_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">idx_line</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">search_string</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">search_string_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">idx_Li_start</span> <span class="o">=</span> <span class="n">idx_line</span>
                        <span class="k">break</span>

                <span class="n">idx_without_weirdos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_Li</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx0_weirdos_Li</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">search_string_found</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_text</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)):</span>
                        <span class="n">idx_line</span> <span class="o">=</span> <span class="n">idx_Li_start</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">):</span>
                            <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Li</span><span class="si">{</span><span class="n">idx_without_weirdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="c1"># file_operations_instance = Operation.File()</span>
                            <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line].split()[1], new_label)     </span>
                            <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                            <span class="n">new_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>

                    <span class="n">lines</span><span class="p">[</span><span class="n">idx_Li_start</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx_Li_start</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_text</span>

                    <span class="c1"># now appending weirdos below existing lines of Li</span>
                    <span class="n">coor_weirdos</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_coor_weirdos_el</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="c1"># coor_weirdos = dataframe[&quot;coor_weirdos_Li&quot;][idx]</span>

                    <span class="n">weirdos_text</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)):</span>
                        <span class="n">coor_weirdo_x</span> <span class="o">=</span> <span class="n">coor_weirdos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">coor_weirdo_y</span> <span class="o">=</span> <span class="n">coor_weirdos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">coor_weirdo_z</span> <span class="o">=</span> <span class="n">coor_weirdos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">idx_weirdo</span> <span class="o">=</span> <span class="n">idx0_weirdos_Li</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">new_line_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Li  Li</span><span class="si">{</span><span class="n">idx_weirdo</span><span class="si">}</span><span class="s2">  1  </span><span class="si">{</span><span class="n">coor_weirdo_x</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">coor_weirdo_y</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">coor_weirdo_z</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">  1&quot;</span>  <span class="c1"># manually created</span>
                        <span class="n">weirdos_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line_weirdo</span><span class="p">)</span>
                        <span class="c1"># idx_line_weirdos = idx_Li_start + len(idx_without_weirdos)</span>
                        
                    <span class="n">old_text_P_S_Cl</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx_Li_start</span> <span class="p">:]</span>

                    <span class="n">idx_weirdo_line_start</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx_Li_start</span>
                    <span class="n">idx_weirdo_line_end</span>     <span class="o">=</span> <span class="n">idx_weirdo_line_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">idx_weirdo_line_start</span> <span class="p">:</span> <span class="n">idx_weirdo_line_end</span><span class="p">]</span> <span class="o">=</span> <span class="n">weirdos_text</span>

                    <span class="n">idx_P_S_Cl_line_new_start</span>    <span class="o">=</span> <span class="n">idx_weirdo_line_end</span>

                    <span class="c1"># !!!: for the moment not using the function because P is gone</span>
                    <span class="c1"># Mapping.OutputCIF.EditCIF.reindex_P_S_Cl(lines, idx_Li_start, idx_without_weirdos, idx_P_S_Cl_line_new_start, amount_P, amount_S, amount_Cl)</span>
                    
                    <span class="n">idx_P_S_Cl_line_new_end</span>      <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_text_P_S_Cl</span><span class="p">)</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">idx_P_S_Cl_line_new_start</span> <span class="p">:</span> <span class="n">idx_P_S_Cl_line_new_end</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_text_P_S_Cl</span>
            
                    <span class="c1"># re-write the index of P_S_Cl accordingly</span>
                    <span class="n">new_text_P_S_Cl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_P</span><span class="p">):</span>
                        <span class="n">idx_line_P</span> <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="n">idx_P_new</span> <span class="o">=</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_P</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">):</span>
                            <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;P</span><span class="si">{</span><span class="n">idx_P_new</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="c1"># file_operations_instance = Operation.File()</span>
                            <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line_P].split()[1], new_label)     </span>
                            <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_P</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line_P</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                            <span class="n">new_text_P_S_Cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_S</span><span class="p">):</span>
                        <span class="n">idx_line_S</span> <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="n">idx_S_new</span> <span class="o">=</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_S</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">):</span>
                            <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">idx_S_new</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="c1"># file_operations_instance = Operation.File()</span>
                            <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line_S].split()[1], new_label)     </span>
                            <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_S</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line_S</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                            <span class="n">new_text_P_S_Cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_Cl</span><span class="p">):</span>
                        <span class="n">idx_line_Cl</span> <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="n">idx_Cl_new</span> <span class="o">=</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span> <span class="o">+</span> <span class="n">i</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_Cl</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cl&quot;</span><span class="p">):</span>
                            <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cl</span><span class="si">{</span><span class="n">idx_Cl_new</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="c1"># file_operations_instance = Operation.File()</span>
                            <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line_Cl].split()[1], new_label)     </span>
                            <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_Cl</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line_Cl</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                            <span class="n">new_text_P_S_Cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>

                    <span class="n">lines</span><span class="p">[</span><span class="n">idx_P_S_Cl_line_new_start</span> <span class="p">:</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span> <span class="o">+</span> <span class="n">amount_Cl</span> <span class="o">+</span> <span class="n">idx_P_S_Cl_line_new_start</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_text_P_S_Cl</span>

                    <span class="c1"># dataframe.at[idx, col_subdir_cif_w_correct_Li_idx_weirdos_appended] = destination_path_combined_new</span>

                <span class="c1"># Write the modified lines back to the file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path_combined_new</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">))</span>



        <span class="k">def</span> <span class="nf">format_spacing_cif</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">var_savefilename_init</span><span class="p">,</span> <span class="n">var_savefilename_new</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_init</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

                <span class="n">source_filename_filtered</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_new</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">destination_path_combined_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename_filtered</span><span class="p">)</span>

                <span class="c1"># Read the input file and split it into lines</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                <span class="c1"># Initialize variables to store the indices of loop_ occurrences</span>
                <span class="n">loop_indices</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># Find the indices of the loop_ occurrences</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;loop_&quot;</span><span class="p">:</span>
                        <span class="n">loop_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="c1"># add last index of lines</span>
                <span class="n">loop_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

                <span class="c1"># mostly hardcoded</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop_indices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">i1</span> <span class="o">=</span> <span class="n">loop_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="n">loop_indices</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
                            <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1  &#39;x, y, z&#39;&quot;</span><span class="p">:</span>
                                <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">):</span>
                                <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">):</span>
                                <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">):</span>
                                <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cl&quot;</span><span class="p">):</span>
                                <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="c1"># Write the modified lines back to the file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path_combined_new</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>


        <span class="k">def</span> <span class="nf">ascending_Li</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">var_filename_init</span><span class="p">,</span> <span class="n">var_savefilename_new</span><span class="p">):</span>
            <span class="n">search_string</span> <span class="o">=</span> <span class="s2">&quot;  Li  &quot;</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">source_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename_init</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">source_filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">source_filename</span><span class="p">)</span>

                <span class="n">filename_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_savefilename_new</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="n">filename_path_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_new</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                <span class="c1"># Find the index where the &quot;Li&quot; atom data starts</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">search_string</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">idx_Li_start</span> <span class="o">=</span> <span class="n">idx</span>
                        <span class="k">break</span>

                <span class="c1"># Extract and sort the &quot;  Li  &quot; lines based on their indices</span>
                <span class="n">li_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_Li_start</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">)]</span>
                <span class="n">sorted_li_lines</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">li_lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">:]))</span>

                <span class="c1"># replace the original &quot;Li&quot; lines with the sorted lines</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">idx_Li_start</span> <span class="p">:</span><span class="n">idx_Li_start</span>  <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_li_lines</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sorted_li_lines</span>

                <span class="c1"># Write the modified lines back to the file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_path_new</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">))</span>


        <span class="k">class</span> <span class="nc">EditCIF</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">reindex_P_S_Cl</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">idx_Li_start</span><span class="p">,</span> <span class="n">idx_without_weirdos</span><span class="p">,</span> <span class="n">idx_P_S_Cl_line_new_start</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">amount_Cl</span><span class="p">):</span>
                <span class="n">old_text_P_S_Cl</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx_Li_start</span> <span class="p">:]</span>

                <span class="n">idx_P_S_Cl_line_new_end</span>      <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_text_P_S_Cl</span><span class="p">)</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">idx_P_S_Cl_line_new_start</span> <span class="p">:</span> <span class="n">idx_P_S_Cl_line_new_end</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_text_P_S_Cl</span>

                <span class="c1"># re-write the index of P_S_Cl accordingly</span>
                <span class="n">new_text_P_S_Cl</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_P</span><span class="p">):</span>
                    <span class="n">idx_line_P</span> <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="n">idx_P_new</span> <span class="o">=</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_P</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">):</span>
                        <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;P</span><span class="si">{</span><span class="n">idx_P_new</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="c1"># file_operations_instance = Operation.File()</span>
                        <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line_P].split()[1], new_label)</span>
                        <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_P</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line_P</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                        <span class="n">new_text_P_S_Cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_S</span><span class="p">):</span>
                    <span class="n">idx_line_S</span> <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="n">idx_S_new</span> <span class="o">=</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_S</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">):</span>
                        <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">idx_S_new</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="c1"># file_operations_instance = Operation.File()</span>
                        <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line_S].split()[1], new_label)            </span>
                        <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_S</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line_S</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                        <span class="n">new_text_P_S_Cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_Cl</span><span class="p">):</span>
                    <span class="n">idx_line_Cl</span> <span class="o">=</span> <span class="n">idx_P_S_Cl_line_new_start</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="n">idx_Cl_new</span> <span class="o">=</span> <span class="n">amount_Li</span> <span class="o">+</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_Cl</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cl&quot;</span><span class="p">):</span>
                        <span class="n">new_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cl</span><span class="si">{</span><span class="n">idx_Cl_new</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="c1"># file_operations_instance = Operation.File()</span>
                        <span class="c1"># modified_line = file_operations_instance.replace(lines[idx_line_Cl].split()[1], new_label)     </span>
                        <span class="n">modified_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx_line_Cl</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx_line_Cl</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_label</span><span class="p">)</span>
                        <span class="n">new_text_P_S_Cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_line</span><span class="p">)</span>

                <span class="n">lines</span><span class="p">[</span><span class="n">idx_P_S_Cl_line_new_start</span> <span class="p">:</span> <span class="n">amount_P</span> <span class="o">+</span> <span class="n">amount_S</span> <span class="o">+</span> <span class="n">amount_Cl</span> <span class="o">+</span> <span class="n">idx_P_S_Cl_line_new_start</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_text_P_S_Cl</span>

                <span class="k">return</span> <span class="n">lines</span>


    <span class="k">class</span> <span class="nc">OutputWeirdos</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_coor_weirdos_array</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype2_Li&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_Li&quot;</span>

            <span class="n">coor_weirdos_el_appended</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_weirdos_el</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">single_coor</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span><span class="p">:</span>
                    <span class="n">coor_weirdos_el_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_coor</span><span class="p">)</span>

            <span class="n">coor_weirdos_el_appended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_weirdos_el_appended</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">coor_weirdos_el_appended</span>


        <span class="k">def</span> <span class="nf">create_POSCAR_weirdos</span><span class="p">(</span><span class="n">coor_weirdos</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

            <span class="c1"># Define lattice constants (you might need to adjust these based on your actual system)</span>
            <span class="n">lattice_constants_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">lattice_constant</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="mf">0.0000000000000000</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">]</span>
            <span class="p">])</span>

            <span class="c1"># Define the header and comment lines for the POSCAR file</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;Generated POSCAR&quot;</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

            <span class="c1"># Define filename</span>
            <span class="n">filename_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="c1"># Write the POSCAR file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># Write the header and comment</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comment</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the lattice constants</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lattice_constants_matrix</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the element symbols (in this case, using &#39;Li&#39; for lithium)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Li</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the number of atoms for each element</span>
                <span class="c1"># f.write(&quot; &quot;.join(map(str, np.ones(len(coordinates), dtype=int))) + &quot;\n&quot;)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Number of Li atoms</span>

                <span class="c1"># Write the selective dynamics tag (in this case, &#39;Direct&#39;)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Direct</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Write the atomic coordinates</span>
                <span class="k">for</span> <span class="n">coor</span> <span class="ow">in</span> <span class="n">coor_weirdos</span><span class="p">:</span>
                    <span class="c1"># f.write(&quot; &quot;.join(map(str, coord)) + &quot;\n&quot;)</span>
                    <span class="n">formatted_coords</span> <span class="o">=</span> <span class="p">[</span><span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;.16f&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coor</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_coords</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># print(&quot;POSCAR file created successfully.&quot;)</span>


<span class="k">class</span> <span class="nc">Movement</span><span class="p">:</span>    
    <span class="k">class</span> <span class="nc">Distance</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_distance_litoli</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">idx_file_group</span><span class="p">,</span> <span class="n">idx_ref</span><span class="p">,</span> <span class="n">mean_ref</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                idx_file_group = [idx_init, idx_end]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">df_distance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">coor_Li_ref</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># df_dist_litoli = pd.DataFrame()</span>

            <span class="c1"># df_dist_litoli[&quot;dist&quot;] = None</span>

            <span class="k">if</span> <span class="s1">&#39;CONTCAR&#39;</span> <span class="ow">in</span> <span class="n">var_filename</span><span class="p">:</span>
                <span class="n">file_ref</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx_ref</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx_ref</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_ref</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx_ref</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx_ref</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
            <span class="n">file_path_ref</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">)</span>

            <span class="n">structure_ref</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">file_path_ref</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structure_ref</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">coor</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Li&quot;</span><span class="p">:</span>
                    <span class="n">coor_Li_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coor_Li_ref: </span><span class="si">{</span><span class="n">coor_Li_ref</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># for i in path_geo:</span>
            <span class="n">dataframe_group</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">dataframe_group</span> <span class="o">=</span> <span class="n">dataframe_group</span><span class="p">[</span><span class="n">idx_file_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx_file_group</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">idx_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dataframe_group</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">idx_range</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">idx_ref</span> <span class="o">&gt;</span> <span class="n">idx_file_group</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># dataframe_group = dataframe_group.append(dataframe[idx_ref-1:idx_ref], ignore_index=True)</span>
                <span class="n">dataframe_group</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dataframe</span><span class="p">[</span><span class="n">idx_ref</span><span class="p">:</span><span class="n">idx_ref</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">idx_file_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx_file_group</span><span class="p">[</span><span class="mi">1</span><span class="p">]]],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># idx_range = [idx_ref] + list(range(dataframe_group[&quot;geometry&quot;].size - 1))</span>
                <span class="n">idx_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx_ref</span><span class="p">]</span> <span class="o">+</span> <span class="n">idx_range</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">idx_range</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="c1"># for index in [1]:</span>
                <span class="n">coor_Li</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">dict_distance</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;CONTCAR&#39;</span> <span class="ow">in</span> <span class="n">var_filename</span><span class="p">:</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe_group</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe_group</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe_group</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe_group</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

                <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="c1"># frac_coor = structure.frac_coords</span>

                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">coor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">coor</span><span class="o">.</span><span class="n">species_string</span> <span class="o">==</span> <span class="s2">&quot;Li&quot;</span><span class="p">:</span>
                        <span class="n">coor_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>        

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coor_Li: </span><span class="si">{</span><span class="n">coor_Li</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                <span class="n">coors_Li_dist_structures</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">mean_ref</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor_Li</span><span class="p">)):</span>
                        <span class="n">df_distance</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  

                        <span class="n">coor_Li_ref_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coor_Li_ref</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coor_Li_ref_mean</span><span class="p">,</span> <span class="n">coor_Li</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                        <span class="n">dict_distance</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;dist: </span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s1">, coor_ref: </span><span class="si">{</span><span class="n">coor_Li_ref_mean</span><span class="si">}</span><span class="s1">, coor_Li: </span><span class="si">{</span><span class="n">coor_Li</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
                        <span class="n">df_distance</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>

                        <span class="n">diameter_24g48h</span> <span class="o">=</span> <span class="n">max_mapping_radius</span> <span class="o">*</span> <span class="mi">2</span>
                        <span class="c1"># if distance &lt; diameter_24g48h and index != idx_ref:</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">diameter_24g48h</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">!=</span> <span class="n">idx_ref</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;path: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, Li: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, distance: </span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">mean_ref</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor_Li</span><span class="p">)):</span>
                        <span class="n">df_distance</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  

                        <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coor_Li_ref</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">coor_Li</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                        <span class="n">dict_distance</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;dist: </span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s1">, coor_ref: </span><span class="si">{</span><span class="n">coor_Li_ref</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">, coor_Li: </span><span class="si">{</span><span class="n">coor_Li</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
                        <span class="n">df_distance</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>

                        <span class="n">diameter_24g48h</span> <span class="o">=</span> <span class="n">max_mapping_radius</span> <span class="o">*</span> <span class="mi">2</span>
                        <span class="c1"># if distance &lt; diameter_24g48h and index != idx_ref:</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">diameter_24g48h</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">!=</span> <span class="n">idx_ref</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;path: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, Li: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, distance: </span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1">#         coors_Li_dist_structures_dict = {}</span>
                    
            <span class="c1">#         for k in range(len(coor_Li)):</span>

            <span class="c1">#             distance_litoli = Operation.Distance.mic_eucledian_distance(coor_Li[j], coor_Li[k])</span>

            <span class="c1">#             coors_Li_dist_structures_dict[&#39;coors&#39;] = (coor_Li[j], coor_Li[k])</span>
            <span class="c1">#             coors_Li_dist_structures_dict[&#39;dist&#39;] = distance_litoli</span>
            <span class="c1">#             # coors_Li_dist_structures_dict[&#39;structures&#39;] = (val_temp1[&#39;structure&#39;], val_temp2[&#39;structure&#39;])</span>

            <span class="c1">#             key = (j, k)</span>
            <span class="c1">#             if key in coors_Li_dist_structures:</span>
            <span class="c1">#                 coors_Li_dist_structures[key].append(coors_Li_dist_structures_dict)</span>
            <span class="c1">#             else:</span>
            <span class="c1">#                 coors_Li_dist_structures[key] = coors_Li_dist_structures_dict               </span>

            <span class="c1">#     sorted_coors_Li_dist_structures = dict(sorted(coors_Li_dist_structures.items(), key=lambda item: item[1][&#39;dist&#39;]))</span>
            <span class="c1">#     dist_ascending = list({val[&#39;dist&#39;] for idx, val in sorted_coors_Li_dist_structures.items()})</span>

            <span class="c1">#     df_dist_litoli.at[index, &quot;dist&quot;] = dist_ascending[1:6]</span>

            <span class="c1">#     # df_coor.at[i, col_xyz_coor] = coor_Li</span>

            <span class="c1"># #     # # for j in range(len(coor_Li)):</span>
            <span class="c1"># #     # #     # df_distance.at[i, f&quot;{j}&quot;] = None  </span>

            <span class="c1"># #     # #     distance = Operation.Distance.mic_eucledian_distance(coor_Li_ref[j], coor_Li[j])</span>

            <span class="c1"># #     # #     df_distance.at[i, f&quot;{j}&quot;] = distance</span>

            <span class="c1"># #     # #     diameter_24g48h = max_mapping_radius * 2</span>
            <span class="c1"># #     # #     if distance &lt; diameter_24g48h and i != 0:</span>
            <span class="c1"># #     # #         print(f&quot;path: {i}, Li: {j}, distance: {distance}&quot;)</span>

            <span class="k">return</span> <span class="n">df_distance</span><span class="p">,</span> <span class="n">dataframe_group</span>


    <span class="k">class</span> <span class="nc">Occupancy</span><span class="p">:</span>
        <span class="c1"># # def get_occupancy(dataframe, coor_structure_init_dict_expanded, tuple_metainfo, destination_directory, var_filename, el):</span>
        <span class="c1"># #     col_idx_coor_limapped_weirdos_dict = &quot;idx_coor_limapped_weirdos_dict&quot;</span>
            
        <span class="c1"># #     col_occupancy = &quot;occupancy&quot;</span>
        <span class="c1"># #     col_coor24li_tuple_cage_belongin = &quot;coor24li_tuple_cage_belongin&quot;</span>

        <span class="c1"># #     dataframe[col_occupancy] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># #     dataframe[col_coor24li_tuple_cage_belongin] = [{} for _ in range(len(dataframe.index))]</span>

        <span class="c1"># #     coor_structure_init_dict_expanded_el = coor_structure_init_dict_expanded[el]</span>
        <span class="c1"># #     coor_li48htype1_ref = coor_structure_init_dict_expanded_el[24:72]</span>

        <span class="c1"># #     for idx in range(dataframe[&quot;geometry&quot;].size):</span>
        <span class="c1"># #         coor24li_tuple_cage_belongin = defaultdict(list)</span>

        <span class="c1"># #         file_24Li = f&quot;{int(dataframe[&#39;geometry&#39;][idx])}_{int(dataframe[&#39;path&#39;][idx])}_{var_filename}.cif&quot;</span>
        <span class="c1"># #         file_path_24Li = os.path.join(destination_directory, file_24Li)</span>

        <span class="c1"># #         coor_structure_24Li_dict_el = ReadStructure.Coor.get_coor_structure_init_dict(Structure.from_file(file_path_24Li))[el]</span>
                
        <span class="c1"># #         # Convert lists of arrays to sets for efficient comparison</span>
        <span class="c1"># #         set_coor_structure = set(map(tuple, coor_structure_24Li_dict_el))</span>
        <span class="c1"># #         set_coor_li48htype1_ref = set(map(tuple, coor_li48htype1_ref))</span>

        <span class="c1"># #         # Find the difference between the two sets</span>
        <span class="c1"># #         result_set = set_coor_structure.difference(set_coor_li48htype1_ref)</span>

        <span class="c1"># #         # Convert the result back to a list of arrays</span>
        <span class="c1"># #         result_list = list(map(np.array, result_set))</span>
        <span class="c1"># #         # for idx_triad, val in tuple_metainfo.items():</span>

        <span class="c1"># #         for idx_triad, values_list in tuple_metainfo.items():</span>
        <span class="c1"># #             coor24li_tuple_cage_belongin[idx_triad] = []    # WRONG! should be idx atom</span>
                    
        <span class="c1"># #             for entry in values_list:</span>
        <span class="c1"># #                 for i in result_list:</span>
                    
        <span class="c1"># #                     if (i == entry[&#39;coor&#39;]).all():</span>
        <span class="c1"># #                         # if (tuple(i) == tuple(entry[&#39;coor&#39;])).all():</span>
        <span class="c1"># #                         # coor24li_tuple_belongin_dict = {&#39;coor&#39;: i, &#39;type&#39;:entry[&#39;type&#39;]}</span>
        <span class="c1"># #                         coor24li_tuple_cage_belongin_dict = {&#39;coor&#39;: i, &#39;type&#39;:entry[&#39;type&#39;], &#39;idx_cage&#39;:entry[&#39;idx_cage&#39;]}</span>
        <span class="c1"># #                         coor24li_tuple_cage_belongin[idx_triad].append(coor24li_tuple_cage_belongin_dict)</span>

        <span class="c1"># #         # idx_coor_weirdos_Li_dict = dataframe[&#39;idx_coor_weirdos_Li&#39;][idx]</span>

        <span class="c1"># #         # for idx_weirdo, values_list in idx_coor_weirdos_Li_dict.items():</span>
        <span class="c1"># #         #         coorweirdo_tuple_belongin_dict = {&#39;coor&#39;: values_list, &#39;type&#39;:&#39;weirdo&#39;}</span>
        <span class="c1"># #         #         coor24li_tuple_cage_belongin[&#39;weirdo&#39;].append(coorweirdo_tuple_belongin_dict)</span>
                
        <span class="c1"># #         # for key, val in coor24li_tuple_cage_belongin.items():</span>
        <span class="c1"># #         #     for i</span>

        <span class="c1"># #         len_occupancy = []</span>
        <span class="c1"># #         for key, val in coor24li_tuple_cage_belongin.items():</span>
        <span class="c1"># #             len_occupancy.append(len(val))</span>


        <span class="c1"># #         amount_48htype1 = (len(coor_structure_24Li_dict_el)-len(result_list))</span>
        <span class="c1"># #         amount_weirdo = dataframe[&#39;#weirdos_Li&#39;][idx]</span>
        <span class="c1"># #         occupancy_2 = len_occupancy.count(2)</span>
        <span class="c1"># #         occupancy_1 = len_occupancy.count(1)</span>
        <span class="c1"># #         occupancy_0 = len_occupancy.count(0) - amount_48htype1 - amount_weirdo</span>

        <span class="c1"># #         sanity_check_occupancy = occupancy_2 * 2 + occupancy_1</span>

        <span class="c1"># #         # if sanity_check_occupancy != 24:</span>
        <span class="c1"># #         #     print(f&#39;sum of occupancy not achieved at idx {idx}&#39;)</span>
        <span class="c1"># #         #     sys.exit()</span>

        <span class="c1"># #         # print(f&quot;idx: {idx}&quot;)</span>

        <span class="c1"># #         # if sanity_check_occupancy != 24:</span>
        <span class="c1"># #         #     sys.exit()</span>

        <span class="c1"># #         occupancy = {&#39;2&#39;: occupancy_2, &#39;1&#39;: occupancy_1, &#39;0&#39;: occupancy_0, &#39;48htype1&#39;: amount_48htype1,&#39;weirdo&#39;: amount_weirdo}</span>

        <span class="c1"># #         dataframe.at[idx, col_occupancy] = occupancy</span>
        <span class="c1"># #         dataframe.at[idx, col_coor24li_tuple_cage_belongin] = coor24li_tuple_cage_belongin</span>


        <span class="k">def</span> <span class="nf">get_occupancy</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict_expanded</span><span class="p">,</span> <span class="n">tuple_metainfo</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
            <span class="n">col_idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="s2">&quot;idx_coor_limapped_weirdos_dict&quot;</span>
            <span class="n">col_sum_of_weirdos_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#weirdos_Li&quot;</span>

            <span class="n">col_occupancy</span> <span class="o">=</span> <span class="s2">&quot;occupancy&quot;</span>
            <span class="n">col_idx_coor24li_tuple_cage_belongin_empty</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_empty&quot;</span>

            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_occupancy</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor24li_tuple_cage_belongin_empty</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

            <span class="n">coor_structure_init_dict_expanded_el</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
            <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_structure_init_dict_expanded_el</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">72</span><span class="p">]</span>

            <span class="c1"># for idx in [4]: </span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">idx_coor24li_tuple_cage_belongin_empty</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="n">temp_idxtuple_coor24li_cage_belongin_empty</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

                <span class="n">idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_limapped_weirdos_dict</span><span class="p">]</span>

                <span class="c1"># # # file_24Li = f&quot;{int(dataframe[&#39;geometry&#39;][idx])}_{int(dataframe[&#39;path&#39;][idx])}_{var_filename}.cif&quot;</span>
                <span class="c1"># # # file_path_24Li = os.path.join(destination_directory, file_24Li)</span>

                <span class="c1"># # # coor_structure_24Li_dict_el = ReadStructure.Coor.get_coor_structure_init_dict(Structure.from_file(file_path_24Li))[el]</span>
                
                <span class="c1"># # # # Convert lists of arrays to sets for efficient comparison</span>
                <span class="c1"># # # set_coor_structure = set(map(tuple, coor_structure_24Li_dict_el))</span>
                <span class="c1"># # # set_coor_li48htype1_ref = set(map(tuple, coor_li48htype1_ref))</span>

                <span class="c1"># # # # Find the difference between the two sets</span>
                <span class="c1"># # # result_set = set_coor_structure.difference(set_coor_li48htype1_ref)</span>

                <span class="c1"># # # # Convert the result back to a list of arrays</span>
                <span class="c1"># # # result_list = list(map(np.array, result_set))</span>
                <span class="c1"># for idx_triad, val in tuple_metainfo.items():</span>

                <span class="k">for</span> <span class="n">idx_triad</span><span class="p">,</span> <span class="n">values_list</span> <span class="ow">in</span> <span class="n">tuple_metainfo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">idx_coor24li_tuple_cage_belongin_empty</span><span class="p">[</span><span class="n">idx_triad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># idx_atom as the actual index</span>
                    <span class="n">temp_idxtuple_coor24li_cage_belongin_empty</span><span class="p">[</span><span class="n">idx_triad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values_list</span><span class="p">:</span>

                        <span class="n">coor_metainfo</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                        <span class="n">coor_metainfo_rounded</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coor_metainfo</span><span class="p">)</span>
                        
                        <span class="c1"># for i in result_list:</span>
                        <span class="k">for</span> <span class="n">idx_atom</span><span class="p">,</span> <span class="n">values_list_atom</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                            <span class="n">coor_li_mapped</span> <span class="o">=</span> <span class="n">values_list_atom</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                            <span class="n">coor_li_mapped_rounded</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coor_li_mapped</span><span class="p">)</span>
                    
                            <span class="k">if</span> <span class="p">(</span><span class="n">coor_li_mapped_rounded</span> <span class="o">==</span> <span class="n">coor_metainfo_rounded</span><span class="p">):</span>
                                <span class="c1"># if (tuple(i) == tuple(coor_metainfo_rounded)).all():</span>
                                <span class="c1"># coor24li_tuple_belongin_dict = {&#39;coor&#39;: i, &#39;type&#39;:entry[&#39;type&#39;]}</span>
                                <span class="n">idx_coor24li_tuple_cage_belongin_empty_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_li_mapped_rounded</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="s1">&#39;idx_tuple&#39;</span><span class="p">:</span><span class="n">idx_triad</span><span class="p">,</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]}</span>
                                <span class="n">idx_coor24li_tuple_cage_belongin_empty</span><span class="p">[</span><span class="n">idx_atom</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor24li_tuple_cage_belongin_empty_dict</span><span class="p">)</span>        <span class="c1"># changed into idx_atom</span>

                                <span class="n">temp_idxtuple_coor24li_cage_belongin_empty_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_li_mapped_rounded</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]}</span>
                                <span class="n">temp_idxtuple_coor24li_cage_belongin_empty</span><span class="p">[</span><span class="n">idx_triad</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_idxtuple_coor24li_cage_belongin_empty_dict</span><span class="p">)</span>        <span class="c1"># changed into idx_atom</span>

                <span class="c1"># idx_coor_weirdos_Li_dict = dataframe[&#39;idx_coor_weirdos_Li&#39;][idx]</span>

                <span class="c1"># for idx_weirdo, values_list in idx_coor_weirdos_Li_dict.items():</span>
                <span class="c1">#         coorweirdo_tuple_belongin_dict = {&#39;coor&#39;: values_list, &#39;type&#39;:&#39;weirdo&#39;}</span>
                <span class="c1">#         idx_coor24li_tuple_cage_belongin_empty[&#39;weirdo&#39;].append(coorweirdo_tuple_belongin_dict)</span>
                
                <span class="c1"># for key, val in idx_coor24li_tuple_cage_belongin_empty.items():</span>
                <span class="c1">#     for i</span>

                <span class="n">len_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">temp_idxtuple_coor24li_cage_belongin_empty</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">len_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

                <span class="c1"># Initialize a counter</span>
                <span class="n">amount_48htype1</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># # amount_weirdo = 0</span>

                <span class="c1"># Iterate through each key and list in the dictionary</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_of_dicts</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># Iterate through each dictionary in the list</span>
                    <span class="c1"># # for item in list_of_dicts:</span>
                    <span class="c1"># Check if the &#39;type&#39; is &#39;48htype1&#39;</span>
                    <span class="k">if</span> <span class="n">list_of_dicts</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">:</span>
                        <span class="c1"># Increment the counter</span>
                        <span class="n">amount_48htype1</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="c1"># if amount_48htype1 == 1:</span>
                            <span class="c1">#     print(&#39;true&#39;)</span>
                        <span class="c1"># # if item[&#39;type&#39;] == &#39;weirdo&#39;:</span>
                        <span class="c1"># #     # Increment the counter</span>
                        <span class="c1"># #     amount_weirdo += 1</span>

                <span class="c1"># print(amount_48htype1)</span>
                <span class="c1"># amount_48htype1 = (len(coor_structure_24Li_dict_el)-len(result_list))</span>
                <span class="n">amount_weirdo</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_of_weirdos_Li</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">occupancy_2</span> <span class="o">=</span> <span class="n">len_occupancy</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">occupancy_1</span> <span class="o">=</span> <span class="n">len_occupancy</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">occupancy_0</span> <span class="o">=</span> <span class="n">len_occupancy</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">amount_48htype1</span> <span class="o">-</span> <span class="n">amount_weirdo</span>

                <span class="n">sanity_check_occupancy</span> <span class="o">=</span> <span class="n">occupancy_2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">occupancy_1</span> <span class="o">+</span> <span class="n">amount_48htype1</span> <span class="o">+</span> <span class="n">amount_weirdo</span> <span class="o">+</span> <span class="n">occupancy_0</span>

                <span class="c1"># if sanity_check_occupancy != 24:</span>
                <span class="c1">#     print(f&#39;sum of occupancy not achieved at idx {idx}&#39;)</span>
                <span class="c1">#     sys.exit()</span>

                <span class="c1"># print(f&quot;idx: {idx}&quot;)</span>

                <span class="c1"># if sanity_check_occupancy != 24:</span>
                <span class="c1">#     sys.exit()</span>

                <span class="n">occupancy</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="n">occupancy_2</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="n">occupancy_1</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="n">occupancy_0</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">:</span> <span class="n">amount_48htype1</span><span class="p">,</span><span class="s1">&#39;weirdo&#39;</span><span class="p">:</span> <span class="n">amount_weirdo</span><span class="p">}</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_occupancy</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor24li_tuple_cage_belongin_empty</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_empty</span>


    <span class="k">class</span> <span class="nc">TupleCage</span><span class="p">:</span>
        <span class="c1"># # def get_complete_closest_tuple_cage(dataframe, tuple_metainfo):</span>
        <span class="c1"># #     col_coor24li_tuple_cage_belongin = &quot;coor24li_tuple_cage_belongin&quot;</span>
        <span class="c1"># #     col_idx_coor_limapped_weirdos_dict = &quot;idx_coor_limapped_weirdos_dict&quot;</span>

        <span class="c1"># #     col_idx_coor24li_tuple_cage_belongin = &quot;idx_coor24li_tuple_cage_belongin&quot;</span>
        <span class="c1"># #     col_idx_coor24li_tuple_cage_belongin_complete_closest = &quot;idx_coor24li_tuple_cage_belongin_complete_closest&quot;</span>
        <span class="c1"># #     col_top_n_distance_coors = &quot;top_n_distance_coors&quot;</span>

        <span class="c1"># #     dataframe[col_idx_coor24li_tuple_cage_belongin] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># #     dataframe[col_idx_coor24li_tuple_cage_belongin_complete_closest] = [{} for _ in range(len(dataframe.index))]</span>
        <span class="c1"># #     dataframe[col_top_n_distance_coors] = [{} for _ in range(len(dataframe.index))]</span>
            
        <span class="c1"># #     for idx in range(dataframe[&quot;geometry&quot;].size):</span>
        <span class="c1"># #         idx_coor24li_tuple_cage_belongin = defaultdict(list)</span>

        <span class="c1"># #         coor24li_tuple_cage_belongin = dataframe[col_coor24li_tuple_cage_belongin][idx]</span>
        <span class="c1"># #         idx_coor_limapped_weirdos_dict = dataframe[col_idx_coor_limapped_weirdos_dict][idx]</span>

        <span class="c1"># #         for key_a, val_a in idx_coor_limapped_weirdos_dict.items():</span>
        <span class="c1"># #             idx_li = key_a</span>
        <span class="c1"># #             coor_li_mapped_a = val_a[&#39;coor&#39;]</span>
        <span class="c1"># #             coor_li_mapped_a_rounded = tuple(round(coordinate, 5) for coordinate in coor_li_mapped_a)</span>
        <span class="c1"># #             label_li_a = val_a[&#39;label&#39;]</span>

        <span class="c1"># #             idx_coor24li_tuple_cage_belongin[idx_li] = []</span>
        <span class="c1"># #             for key_b, val_b in coor24li_tuple_cage_belongin.items():</span>
        <span class="c1"># #                 idx_tuple = key_b</span>
        <span class="c1"># #                 for entry_b in val_b:</span>
        <span class="c1"># #                     coor_li_mapped_b = entry_b[&#39;coor&#39;]</span>
        <span class="c1"># #                     coor_li_mapped_b_rounded = tuple(round(coordinate, 5) for coordinate in coor_li_mapped_b)</span>
        <span class="c1"># #                     label_li_b = entry_b[&#39;type&#39;]</span>
        <span class="c1"># #                     idx_cage_b = entry_b[&#39;idx_cage&#39;]</span>

        <span class="c1"># #                     if (coor_li_mapped_a_rounded == coor_li_mapped_b_rounded) and (label_li_a == label_li_b):</span>
        <span class="c1"># #                         # idx_coor24li_tuple_belongin_val = {&#39;coor&#39;: coor_li_mapped_a, &#39;type&#39;:label_li_a, &#39;idx_tuple&#39;:idx_tuple}</span>
        <span class="c1"># #                         idx_coor24li_tuple_cage_belongin_val = {&#39;coor&#39;: coor_li_mapped_a, &#39;type&#39;:label_li_a, &#39;idx_tuple&#39;:idx_tuple, &#39;idx_cage&#39;:idx_cage_b}</span>
        <span class="c1"># #                         idx_coor24li_tuple_cage_belongin[idx_li].append(idx_coor24li_tuple_cage_belongin_val)</span>
                
        <span class="c1"># #         dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin] = idx_coor24li_tuple_cage_belongin</span>
                                
        <span class="c1"># #         distance_coors_all = defaultdict(list)</span>
        <span class="c1"># #         n = 3</span>
        <span class="c1"># #         idx_coor_limapped_weirdos_dict = dataframe[col_idx_coor_limapped_weirdos_dict][idx]</span>
        <span class="c1"># #         idx_coor24li_tuple_cage_belongin = dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin]</span>
        <span class="c1"># #         # idx_coor24li_tuple_cage_belongin_complete_closest = idx_coor24li_tuple_cage_belongin.copy()</span>
        <span class="c1"># #         idx_coor24li_tuple_cage_belongin_complete_closest = defaultdict(list)</span>

        <span class="c1"># #         for key_c, val_c in idx_coor24li_tuple_cage_belongin.items():</span>
        <span class="c1"># #             idx_li = key_c</span>
        <span class="c1"># #             idx_coor24li_tuple_cage_belongin_complete_closest[idx_li] = []</span>

        <span class="c1"># #             if val_c == []:</span>
        <span class="c1"># #                 coor_li_mapped_c = idx_coor_limapped_weirdos_dict[idx_li][&#39;coor&#39;]</span>
        <span class="c1"># #                 label_li_c = idx_coor_limapped_weirdos_dict[idx_li][&#39;label&#39;]</span>

        <span class="c1"># #                 distance_prev = float(&quot;inf&quot;)</span>
        <span class="c1"># #                 closest_idx_tuple = None</span>
        <span class="c1"># #                 closest_idx_cage = None</span>
                        
        <span class="c1"># #                 for key_d, val_d in tuple_metainfo.items():</span>
        <span class="c1"># #                     for entry_d in val_d: </span>
        <span class="c1"># #                         idx_tuple = key_d</span>
        <span class="c1"># #                         coor_tuple_d = entry_d[&#39;coor&#39;]</span>
        <span class="c1"># #                         label_li_d = entry_d[&#39;type&#39;]</span>
        <span class="c1"># #                         idx_cage_d = entry_d[&#39;idx_cage&#39;]</span>

        <span class="c1"># #                         distance = Operation.Distance.mic_eucledian_distance(coor_li_mapped_c, coor_tuple_d)</span>

        <span class="c1"># #                         # distance_coors_all_val = {&#39;coor_li_mapped&#39;: coor_li_mapped_c, &#39;coor_tuple&#39;: coor_tuple_d, &#39;dist&#39;: distance, &#39;label&#39;:label_li_d}</span>

        <span class="c1"># #                         distance_coors_all_val = {&#39;coor_tuple&#39;: coor_tuple_d, &#39;dist&#39;: distance, &#39;label&#39;:label_li_d, &#39;idx_tuple&#39;:idx_tuple, &#39;idx_cage&#39;:idx_cage_d}</span>

        <span class="c1"># #                         distance_coors_all[idx_li].append(distance_coors_all_val)</span>

        <span class="c1"># #                         if distance &lt; distance_prev:</span>
        <span class="c1"># #                             distance_prev = distance</span>
        <span class="c1"># #                             closest_idx_tuple = idx_tuple</span>
        <span class="c1"># #                             closest_idx_cage = idx_cage_d</span>

        <span class="c1"># #                 idx_coor24li_tuple_cage_belongin_complete_closest[idx_li] = {&#39;coor&#39;: coor_li_mapped_c, &#39;type&#39;: label_li_c, &#39;idx_tuple&#39;: closest_idx_tuple, &#39;idx_cage&#39;: closest_idx_cage}</span>

        <span class="c1"># #             elif val_c != []:</span>
        <span class="c1"># #                 for entry_c in val_c: </span>
        <span class="c1"># #                     coor_li_mapped_c = entry_c[&#39;coor&#39;]</span>
        <span class="c1"># #                     label_li_c = entry_c[&#39;type&#39;]</span>
        <span class="c1"># #                     idx_tuple_c = entry_c[&#39;idx_tuple&#39;]</span>
        <span class="c1"># #                     idx_cage_c = entry_c[&#39;idx_cage&#39;]</span>

        <span class="c1"># #                     idx_coor24li_tuple_cage_belongin_complete_closest[idx_li] = {&#39;coor&#39;: coor_li_mapped_c, &#39;type&#39;: label_li_c, &#39;idx_tuple&#39;: idx_tuple_c, &#39;idx_cage&#39;: idx_cage_c}</span>

        <span class="c1"># #         sorted_distance_coors_all = {key: sorted(value, key=lambda x: x[&#39;dist&#39;]) for key, value in distance_coors_all.items()}</span>
        <span class="c1"># #         top_n_distance_coors = {k: v[0:n] for k, v in sorted_distance_coors_all.items()}</span>
        <span class="c1"># #         # !!! assumed there&#39;s NO DUPLICATE with the SECOND distance</span>

        <span class="c1"># #         dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin_complete_closest] = idx_coor24li_tuple_cage_belongin_complete_closest</span>
        <span class="c1"># #         dataframe.at[idx, col_top_n_distance_coors] = top_n_distance_coors</span>


        <span class="k">def</span> <span class="nf">get_complete_closest_tuple_cage</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">tuple_metainfo</span><span class="p">,</span> <span class="n">coor_48htype2_metainfo</span><span class="p">):</span>
            <span class="n">col_idx_coor24li_tuple_cage_belongin_empty</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_empty&quot;</span>
            <span class="n">col_idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="s2">&quot;idx_coor_limapped_weirdos_dict&quot;</span>

            <span class="c1"># col_idx_coor24li_tuple_cage_belongin_empty_xxx = &quot;idx_coor24li_tuple_cage_belongin_empty_xxx&quot;</span>
            <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_complete_closest&quot;</span>
            <span class="n">col_top_n_distance_coors</span> <span class="o">=</span> <span class="s2">&quot;top_n_distance_coors&quot;</span>
            <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_id48htype2</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_complete_id48htype2&quot;</span>

            <span class="c1"># dataframe[col_idx_coor24li_tuple_cage_belongin_empty_xxx] = [{} for _ in range(len(dataframe.index))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_top_n_distance_coors</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor24li_tuple_cage_belongin_complete_id48htype2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
            
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="c1"># idx_coor24li_tuple_cage_belongin_empty_xxx = defaultdict(list)</span>

                <span class="n">idx_coor24li_tuple_cage_belongin_empty</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor24li_tuple_cage_belongin_empty</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor_limapped_weirdos_dict</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

                <span class="c1"># for key_a, val_a in idx_coor_limapped_weirdos_dict.items():</span>
                <span class="c1">#     idx_li = key_a</span>
                <span class="c1">#     coor_li_mapped_a = val_a[&#39;coor&#39;]</span>
                <span class="c1">#     coor_li_mapped_a_rounded = tuple(round(coordinate, 5) for coordinate in coor_li_mapped_a)</span>
                <span class="c1">#     label_li_a = val_a[&#39;label&#39;]</span>

                <span class="c1">#     idx_coor24li_tuple_cage_belongin_empty_xxx[idx_li] = []</span>
                <span class="c1">#     for key_b, val_b in idx_coor24li_tuple_cage_belongin_empty.items():</span>
                <span class="c1">#         idx_b_li = key_b</span>
                <span class="c1">#         for entry_b in val_b:</span>
                <span class="c1">#             coor_li_mapped_b = entry_b[&#39;coor&#39;]</span>
                <span class="c1">#             coor_li_mapped_b_rounded = tuple(round(coordinate, 5) for coordinate in coor_li_mapped_b)</span>
                <span class="c1">#             label_li_b = entry_b[&#39;type&#39;]</span>
                <span class="c1">#             idx_tuple = entry_b[&#39;idx_tuple&#39;]</span>
                <span class="c1">#             idx_cage_b = entry_b[&#39;idx_cage&#39;]</span>

                <span class="c1">#             if (coor_li_mapped_a_rounded == coor_li_mapped_b_rounded) and (label_li_a == label_li_b):</span>
                <span class="c1">#                 # idx_coor24li_tuple_belongin_val = {&#39;coor&#39;: coor_li_mapped_a, &#39;type&#39;:label_li_a, &#39;idx_tuple&#39;:idx_tuple}</span>
                <span class="c1">#                 idx_coor24li_tuple_cage_belongin_empty_xxx_val = {&#39;coor&#39;: coor_li_mapped_a, &#39;type&#39;:label_li_a, &#39;idx_tuple&#39;:idx_tuple, &#39;idx_cage&#39;:idx_cage_b}</span>
                <span class="c1">#                 idx_coor24li_tuple_cage_belongin_empty_xxx[idx_li].append(idx_coor24li_tuple_cage_belongin_empty_xxx_val)</span>
                
                <span class="c1"># dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin_empty_xxx] = idx_coor24li_tuple_cage_belongin_empty_xxx</span>
                                
                <span class="n">distance_coors_all_closest</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="c1"># idx_coor_limapped_weirdos_dict = dataframe[col_idx_coor_limapped_weirdos_dict][idx]</span>
                <span class="c1"># idx_coor24li_tuple_cage_belongin_empty_xxx = dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin_empty_xxx]</span>
                <span class="c1"># idx_coor24li_tuple_cage_belongin_complete_closest = idx_coor24li_tuple_cage_belongin_empty_xxx.copy()</span>
                <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="n">idx_coor24li_tuple_cage_belongin_complete_id48htype2</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">key_c</span><span class="p">,</span> <span class="n">val_c</span> <span class="ow">in</span> <span class="n">idx_coor24li_tuple_cage_belongin_empty</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">idx_li</span> <span class="o">=</span> <span class="n">key_c</span>
                    <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">idx_li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">if</span> <span class="n">val_c</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">coor_li_mapped_c</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="n">idx_li</span><span class="p">][</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                        <span class="n">label_li_c</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="n">idx_li</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>

                        <span class="n">distance_prev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
                        <span class="n">closest_idx_tuple</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">closest_idx_cage</span> <span class="o">=</span> <span class="kc">None</span>
                        
                        <span class="k">for</span> <span class="n">key_d</span><span class="p">,</span> <span class="n">val_d</span> <span class="ow">in</span> <span class="n">tuple_metainfo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">entry_d</span> <span class="ow">in</span> <span class="n">val_d</span><span class="p">:</span> 
                                <span class="n">idx_tuple</span> <span class="o">=</span> <span class="n">key_d</span>
                                <span class="n">coor_tuple_d</span> <span class="o">=</span> <span class="n">entry_d</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                                <span class="n">label_li_d</span> <span class="o">=</span> <span class="n">entry_d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                                <span class="n">idx_cage_d</span> <span class="o">=</span> <span class="n">entry_d</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span>

                                <span class="n">distance</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">mic_eucledian_distance</span><span class="p">(</span><span class="n">coor_li_mapped_c</span><span class="p">,</span> <span class="n">coor_tuple_d</span><span class="p">)</span>

                                <span class="c1"># distance_coors_all_closest_val = {&#39;coor_li_mapped&#39;: coor_li_mapped_c, &#39;coor_tuple&#39;: coor_tuple_d, &#39;dist&#39;: distance, &#39;label&#39;:label_li_d}</span>

                                <span class="n">distance_coors_all_closest_val</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor_tuple&#39;</span><span class="p">:</span> <span class="n">coor_tuple_d</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">label_li_d</span><span class="p">,</span> <span class="s1">&#39;idx_tuple&#39;</span><span class="p">:</span><span class="n">idx_tuple</span><span class="p">,</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span><span class="n">idx_cage_d</span><span class="p">}</span>

                                <span class="n">distance_coors_all_closest</span><span class="p">[</span><span class="n">idx_li</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance_coors_all_closest_val</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_prev</span><span class="p">:</span>
                                    <span class="n">distance_prev</span> <span class="o">=</span> <span class="n">distance</span>
                                    <span class="n">closest_idx_tuple</span> <span class="o">=</span> <span class="n">idx_tuple</span>
                                    <span class="n">closest_idx_cage</span> <span class="o">=</span> <span class="n">idx_cage_d</span>

                        <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">idx_li</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_li_mapped_c</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">label_li_c</span><span class="p">,</span> <span class="s1">&#39;idx_tuple&#39;</span><span class="p">:</span> <span class="n">closest_idx_tuple</span><span class="p">,</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span> <span class="n">closest_idx_cage</span><span class="p">}</span>

                    <span class="k">elif</span> <span class="n">val_c</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">entry_c</span> <span class="ow">in</span> <span class="n">val_c</span><span class="p">:</span> 
                            <span class="n">coor_li_mapped_c</span> <span class="o">=</span> <span class="n">entry_c</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                            <span class="n">label_li_c</span> <span class="o">=</span> <span class="n">entry_c</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                            <span class="n">idx_tuple_c</span> <span class="o">=</span> <span class="n">entry_c</span><span class="p">[</span><span class="s1">&#39;idx_tuple&#39;</span><span class="p">]</span>
                            <span class="n">idx_cage_c</span> <span class="o">=</span> <span class="n">entry_c</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span>

                            <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">idx_li</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_li_mapped_c</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">label_li_c</span><span class="p">,</span> <span class="s1">&#39;idx_tuple&#39;</span><span class="p">:</span> <span class="n">idx_tuple_c</span><span class="p">,</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span> <span class="n">idx_cage_c</span><span class="p">}</span>

                <span class="n">idx_coor24li_tuple_cage_belongin_complete_id48htype2</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># # Renaming keys</span>
                <span class="c1"># for key in idx_coor24li_tuple_cage_belongin_complete_id48htype2:</span>
                <span class="c1">#     idx_coor24li_tuple_cage_belongin_complete_id48htype2[key][&#39;idx_tuple&#39;] = idx_coor24li_tuple_cage_belongin_complete_id48htype2[key].pop(&#39;idx_tuple_closest&#39;)</span>
                <span class="c1">#     idx_coor24li_tuple_cage_belongin_complete_id48htype2[key][&#39;idx_cage&#39;] = idx_coor24li_tuple_cage_belongin_complete_id48htype2[key].pop(&#39;idx_cage_closest&#39;)</span>

                <span class="k">for</span> <span class="n">key_e</span><span class="p">,</span> <span class="n">val_e</span> <span class="ow">in</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">coor_li_mapped_e</span> <span class="o">=</span> <span class="n">val_e</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                    <span class="n">coor_li_mapped_e_rounded</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coor_li_mapped_e</span><span class="p">)</span>
                    <span class="n">label_li_e</span> <span class="o">=</span> <span class="n">val_e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                    <span class="n">idx_tuple_e</span> <span class="o">=</span> <span class="n">val_e</span><span class="p">[</span><span class="s1">&#39;idx_tuple&#39;</span><span class="p">]</span>
                    <span class="n">idx_cage_e</span> <span class="o">=</span> <span class="n">val_e</span><span class="p">[</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">label_li_e</span> <span class="o">==</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">:</span>
                            
                        <span class="k">for</span> <span class="n">id_48htype2</span><span class="p">,</span> <span class="n">val_48htype2_metainfo_temp</span> <span class="ow">in</span> <span class="n">coor_48htype2_metainfo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">coor_48htype2_metainfo_temp</span> <span class="o">=</span> <span class="n">val_48htype2_metainfo_temp</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                            <span class="n">coor_48htype2_metainfo_temp_rounded</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coor_48htype2_metainfo_temp</span><span class="p">)</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">coor_li_mapped_e_rounded</span> <span class="o">==</span> <span class="n">coor_48htype2_metainfo_temp_rounded</span><span class="p">):</span>

                                <span class="n">idx_coor24li_tuple_cage_belongin_complete_id48htype2</span><span class="p">[</span><span class="n">key_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_li_mapped_e</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">label_li_e</span><span class="p">,</span> <span class="s1">&#39;idx_tuple&#39;</span><span class="p">:</span> <span class="n">id_48htype2</span><span class="p">,</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span> <span class="n">idx_cage_e</span><span class="p">}</span>
                    
                    <span class="k">elif</span> <span class="n">label_li_e</span> <span class="o">==</span> <span class="s1">&#39;weirdos&#39;</span><span class="p">:</span>
                        <span class="n">idx_tuple_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;x&#39;</span>
                        <span class="c1"># print(&quot;Value of idx_tuple_weirdo before assignment:&quot;, idx_tuple_weirdo)</span>
                        <span class="n">idx_coor24li_tuple_cage_belongin_complete_id48htype2</span><span class="p">[</span><span class="n">key_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_li_mapped_e</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">label_li_e</span><span class="p">,</span> <span class="s1">&#39;idx_tuple&#39;</span><span class="p">:</span> <span class="n">idx_tuple_weirdo</span><span class="p">,</span> <span class="s1">&#39;idx_cage&#39;</span><span class="p">:</span> <span class="n">idx_cage_e</span><span class="p">}</span>
                        <span class="c1"># print(&quot;Value of idx_tuple_weirdo after assignment:&quot;, idx_tuple_weirdo)</span>
                        
                <span class="n">sorted_distance_coors_all_closest</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">distance_coors_all_closest</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">top_n_distance_coors</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_distance_coors_all_closest</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="c1"># !!! assumed there&#39;s NO DUPLICATE with the SECOND distance</span>

                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top_n_distance_coors</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_n_distance_coors</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_id48htype2</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_id48htype2</span>


        <span class="k">def</span> <span class="nf">get_df_movement</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">to_plot</span><span class="p">,</span> <span class="n">activate_closest_tuple</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            to_plot = idx_tuple, type, idx_cage</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># col_idx_coor24li_tuple_cage_belongin_complete_closest_weight = &quot;idx_coor24li_tuple_cage_belongin_complete_closest_weight&quot;</span>
            <span class="k">if</span> <span class="n">activate_closest_tuple</span><span class="p">:</span> <span class="c1"># small adjustment here</span>
                <span class="n">col_idx_coor24li_tuple_cage_belongin_complete</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_complete_closest&quot;</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># small adjustment here</span>
                <span class="n">col_idx_coor24li_tuple_cage_belongin_complete</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_complete_id48htype2&quot;</span>

            <span class="n">df_to_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

                <span class="c1"># idx_coor24li_tuple_cage_belongin_complete_closest_weight = dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin_complete_closest_weight]</span>
                <span class="n">idx_coor24li_tuple_cage_belongin_complete</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor24li_tuple_cage_belongin_complete</span><span class="p">]</span>

                <span class="c1"># for j in range(len(idx_coor24li_tuple_cage_belongin_complete_closest_weight)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_coor24li_tuple_cage_belongin_complete</span><span class="p">)):</span>
                    <span class="n">df_to_plot</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  

                    <span class="c1"># coor_Li_ref_mean = np.mean(coor_Li_ref, axis=0)</span>
                    <span class="c1"># distance = Operation.Distance.mic_eucledian_distance(coor_Li_ref_mean, coor_Li[j])</span>

                    <span class="c1"># dict_weighted[f&quot;{j}&quot;] = {f&#39;dist: {distance}, coor_ref: {coor_Li_ref_mean}, coor_Li: {coor_Li[j]}&#39;}</span>
                    
                    <span class="c1"># # for key_b, val_b in idx_coor24li_tuple_cage_belongin_complete_closest_weight.items():</span>
                    <span class="k">for</span> <span class="n">key_b</span><span class="p">,</span> <span class="n">val_b</span> <span class="ow">in</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="c1"># for entry_b in val_b: </span>
                        <span class="c1"># if activate_closest_tuple:</span>
                        <span class="c1">#     df_to_plot.at[idx, f&quot;{key_b}&quot;] = val_b[f&#39;{to_plot}_closest&#39;]</span>
                        <span class="c1"># else:</span>
                        <span class="n">df_to_plot</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_b</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">to_plot</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

                    <span class="c1"># diameter_24g48h = max_mapping_radius * 2</span>
                    <span class="c1"># # if distance &lt; diameter_24g48h and index != idx_ref:</span>
                    <span class="c1"># if distance &gt; diameter_24g48h and idx != idx_ref:</span>
                    <span class="c1">#     print(f&quot;path: {idx}, Li: {j}, distance: {distance}&quot;)</span>

            <span class="k">return</span> <span class="n">df_to_plot</span>


        <span class="k">def</span> <span class="nf">get_df_movement_category</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">activate_closest_tuple</span><span class="p">):</span>
            <span class="c1"># col_idx_coor24li_tuple_cage_belongin_complete_closest_weight = &quot;idx_coor24li_tuple_cage_belongin_complete_closest_weight&quot;</span>
            <span class="k">if</span> <span class="n">activate_closest_tuple</span><span class="p">:</span>
                <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_complete_closest&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span> <span class="o">=</span> <span class="s2">&quot;idx_coor24li_tuple_cage_belongin_complete_id48htype2&quot;</span>

            <span class="n">df_to_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># CHANGED HERE</span>

                <span class="c1"># idx_coor24li_tuple_cage_belongin_complete_closest_weight = dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin_complete_closest_weight]</span>
                <span class="c1"># idx_coor24li_tuple_cage_belongin_complete_closest_weight_next = dataframe.at[idx+1, col_idx_coor24li_tuple_cage_belongin_complete_closest_weight]</span>
                <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">]</span>
                <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest_next</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">col_idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">]</span>

                <span class="c1"># for j in range(len(idx_coor24li_tuple_cage_belongin_complete_closest_weight)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">)):</span>
                    <span class="n">df_to_plot</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  

                    <span class="c1"># type = idx_coor24li_tuple_cage_belongin_complete_closest_weight[j][&#39;type&#39;]</span>
                    <span class="c1"># idx_tuple = idx_coor24li_tuple_cage_belongin_complete_closest_weight[j][&#39;idx_tuple&#39;]</span>
                    <span class="c1"># idx_cage = idx_coor24li_tuple_cage_belongin_complete_closest_weight[j][&#39;idx_cage&#39;]</span>

                    <span class="c1"># type_next = idx_coor24li_tuple_cage_belongin_complete_closest_weight_next[j][&#39;type&#39;]</span>
                    <span class="c1"># idx_tuple_next = idx_coor24li_tuple_cage_belongin_complete_closest_weight_next[j][&#39;idx_tuple&#39;]</span>
                    <span class="c1"># idx_cage_next = idx_coor24li_tuple_cage_belongin_complete_closest_weight_next[j][&#39;idx_cage&#39;]</span>

                    <span class="n">coor</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                    <span class="n">coor_rounded</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coor</span><span class="p">)</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                    <span class="n">idx_tuple</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;idx_tuple&#39;</span><span class="p">]</span>
                    <span class="n">idx_cage</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span>

                    <span class="n">coor_next</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest_next</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>
                    <span class="n">coor_next_rounded</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coor_next</span><span class="p">)</span>
                    <span class="n">type_next</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest_next</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                    <span class="n">idx_tuple_next</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest_next</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;idx_tuple&#39;</span><span class="p">]</span>
                    <span class="n">idx_cage_next</span> <span class="o">=</span> <span class="n">idx_coor24li_tuple_cage_belongin_complete_closest_next</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;idx_cage&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">idx_cage</span> <span class="o">!=</span> <span class="n">idx_cage_next</span><span class="p">:</span>
                        <span class="n">type_movement</span> <span class="o">=</span> <span class="s1">&#39;inTERcage&#39;</span>
                    <span class="k">elif</span> <span class="n">idx_cage</span> <span class="o">==</span> <span class="n">idx_cage_next</span> <span class="ow">and</span> <span class="n">idx_tuple</span> <span class="o">!=</span> <span class="n">idx_tuple_next</span><span class="p">:</span>
                        <span class="n">type_movement</span> <span class="o">=</span> <span class="s1">&#39;intracage&#39;</span>
                    <span class="k">elif</span> <span class="n">idx_cage</span> <span class="o">==</span> <span class="n">idx_cage_next</span> <span class="ow">and</span> <span class="n">idx_tuple</span> <span class="o">==</span> <span class="n">idx_tuple_next</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">!=</span> <span class="n">type_next</span><span class="p">:</span>
                        <span class="n">type_movement</span> <span class="o">=</span> <span class="s1">&#39;intratriad&#39;</span>
                    <span class="k">elif</span> <span class="n">idx_cage</span> <span class="o">==</span> <span class="n">idx_cage_next</span> <span class="ow">and</span> <span class="n">idx_tuple</span> <span class="o">==</span> <span class="n">idx_tuple_next</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">type_next</span> <span class="ow">and</span> <span class="n">coor_rounded</span> <span class="o">!=</span> <span class="n">coor_next_rounded</span><span class="p">:</span>
                        <span class="n">type_movement</span> <span class="o">=</span> <span class="s1">&#39;intratriad&#39;</span>
                    <span class="k">elif</span> <span class="n">idx_cage</span> <span class="o">==</span> <span class="n">idx_cage_next</span> <span class="ow">and</span> <span class="n">idx_tuple</span> <span class="o">==</span> <span class="n">idx_tuple_next</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">type_next</span> <span class="ow">and</span> <span class="n">coor_rounded</span> <span class="o">==</span> <span class="n">coor_next_rounded</span><span class="p">:</span>
                        <span class="n">type_movement</span> <span class="o">=</span> <span class="s1">&#39;staying&#39;</span>

                    <span class="n">df_to_plot</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_movement</span>

                    <span class="c1"># coor_Li_ref_mean = np.mean(coor_Li_ref, axis=0)</span>
                    <span class="c1"># distance = Operation.Distance.mic_eucledian_distance(coor_Li_ref_mean, coor_Li[j])</span>

                    <span class="c1"># dict_weighted[f&quot;{j}&quot;] = {f&#39;dist: {distance}, coor_ref: {coor_Li_ref_mean}, coor_Li: {coor_Li[j]}&#39;}</span>
                    
                    <span class="c1"># for key_b, val_b in idx_coor24li_tuple_cage_belongin_complete_closest_weight.items():</span>
                    <span class="c1">#     type = val_b[&#39;type&#39;]</span>
                    <span class="c1">#     idx_tuple = val_b[&#39;idx_tuple&#39;]</span>
                    <span class="c1">#     idx_cage = val_b[&#39;idx_cage&#39;]</span>
                        <span class="c1"># for entry_b in val_b: </span>
                        <span class="c1"># df_to_plot.at[idx, f&quot;{key_b}&quot;] = val_b[f&#39;{to_plot}&#39;]</span>

                    <span class="c1"># diameter_24g48h = max_mapping_radius * 2</span>
                    <span class="c1"># # if distance &lt; diameter_24g48h and index != idx_ref:</span>
                    <span class="c1"># if distance &gt; diameter_24g48h and idx != idx_ref:</span>
                    <span class="c1">#     print(f&quot;path: {idx}, Li: {j}, distance: {distance}&quot;)</span>
            <span class="k">return</span> <span class="n">df_to_plot</span>


        <span class="k">def</span> <span class="nf">get_and_plot_df_movement_category_counted</span><span class="p">(</span><span class="n">df_movement</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;inTERcage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intracage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intratriad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;staying&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_movement</span><span class="p">)):</span>
                <span class="n">counter_inTERcage</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counter_intracage</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counter_intratriad</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counter_staying</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_movement</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="c1"># print(j)</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;inTERcage&#39;</span><span class="p">:</span>
                        <span class="n">counter_inTERcage</span> <span class="o">=</span> <span class="n">counter_inTERcage</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;intracage&#39;</span><span class="p">:</span>
                        <span class="n">counter_intracage</span> <span class="o">=</span> <span class="n">counter_intracage</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;intratriad&#39;</span><span class="p">:</span>
                        <span class="n">counter_intratriad</span> <span class="o">=</span> <span class="n">counter_intratriad</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;staying&#39;</span><span class="p">:</span>
                        <span class="n">counter_staying</span> <span class="o">=</span> <span class="n">counter_staying</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;inTERcage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter_inTERcage</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;intracage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter_intracage</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;intratriad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter_intratriad</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;staying&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter_staying</span>

            <span class="n">wide_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="c1"># Convert wide format to long format</span>
            <span class="c1"># long_df = pd.melt(wide_df, var_name=&#39;Category&#39;, value_name=&#39;Count&#39;)</span>
            <span class="n">long_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">wide_df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

            <span class="n">long_df</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.5</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">long_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;idx_file&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Idx of movement vs Category&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">get_idx_coor_limapped_weirdos_dict</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
    <span class="n">coor_reference_el_init</span> <span class="o">=</span> <span class="n">coor_structure_init_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>

    <span class="n">col_idx_without_weirdos</span> <span class="o">=</span> <span class="s2">&quot;idx_without_weirdos&quot;</span>
    <span class="n">col_idx_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;idx_coor_weirdos_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">col_idx0_weirdos_Li</span> <span class="o">=</span> <span class="s2">&quot;idx0_weirdos_Li&quot;</span>
    <span class="n">col_sum_of_weirdos_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#weirdos_Li&quot;</span>
    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1">#col_coor_reducedreference_Li = &quot;coor_reducedreference_Li&quot;</span>
        <span class="n">col_coor_reducedreference_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_48htypesmerged_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># col_coor_weirdos_48htypesmerged_Li = &quot;coor_weirdos_48htypesmerged_Li&quot;</span>
        <span class="c1"># col_coor_weirdos_el = f&quot;coor_weirdos_48htype2_{el}&quot;</span>
        <span class="n">col_sum_sanitycheck_Li</span> <span class="o">=</span> <span class="s2">&quot;sum_sanitycheck_48htypesmerged_Li&quot;</span>
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">col_coor_reducedreference_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_reducedreference_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>
        <span class="n">col_sum_sanitycheck_Li</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sum_sanitycheck_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_closestduplicate&quot;</span>


    <span class="n">col_idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="s2">&quot;idx_coor_limapped_weirdos_dict&quot;</span>
    <span class="n">col_sum_label_and_weirdo_flag</span> <span class="o">=</span> <span class="s2">&quot;#label_and_#weirdo_flag&quot;</span>
    <span class="n">col_amount_types_and_weirdo</span> <span class="o">=</span> <span class="s2">&quot;amount_types_and_weirdo&quot;</span>
    <span class="n">col_ratio_48htype1_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_48htype1_Li&quot;</span>
    <span class="n">col_ratio_48htype2_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_48htype2_Li&quot;</span>
    <span class="n">col_ratio_24g_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_24g_Li&quot;</span>
    <span class="n">col_ratio_weirdo_Li</span> <span class="o">=</span> <span class="s2">&quot;ratio_weirdo_Li&quot;</span>
    <span class="n">col_sum_amount</span> <span class="o">=</span> <span class="s2">&quot;sum_amount&quot;</span>
    <span class="n">col_idx_coor_limapped_weirdos_dict_init</span> <span class="o">=</span> <span class="s2">&quot;idx_coor_limapped_weirdos_dict_init&quot;</span>
    <span class="n">col_ndim_coor_reducedreference_Li</span> <span class="o">=</span> <span class="s2">&quot;ndim_coor_reducedreference_Li&quot;</span>
    <span class="n">col_ndim_coor_weirdos_el</span> <span class="o">=</span> <span class="s2">&quot;ndim_coor_weirdos_el&quot;</span>
    <span class="n">col_len_coor_weirdos_el</span> <span class="o">=</span> <span class="s2">&quot;len_coor_weirdos_el&quot;</span>
    <span class="n">col_len_coor_reducedreference_Li</span> <span class="o">=</span> <span class="s2">&quot;len_coor_reducedreference_Li&quot;</span>
    <span class="n">col_len_idx0_weirdos_Li</span> <span class="o">=</span> <span class="s2">&quot;len_idx0_weirdos_Li&quot;</span>
    <span class="n">col_len_idx_without_weirdos</span> <span class="o">=</span> <span class="s2">&quot;len_idx_without_weirdos&quot;</span>
    <span class="n">col_ndim_flag_coor</span> <span class="o">=</span> <span class="s2">&quot;ndim_flag_coor&quot;</span>

    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor_limapped_weirdos_dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_label_and_weirdo_flag</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_amount_types_and_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_sum_amount</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_idx_coor_limapped_weirdos_dict_init</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_idx0_weirdos_Li</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_len_idx_without_weirdos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="n">col_ndim_flag_coor</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span>

    <span class="n">coor_li48htype1_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span>
    <span class="n">coor_li48htype2_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">48</span><span class="p">:</span><span class="mi">96</span><span class="p">]</span>
    <span class="n">coor_li24g_ref</span> <span class="o">=</span> <span class="n">coor_reference_el_init</span><span class="p">[</span><span class="mi">96</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idx_coor_limapped_weirdos_dict_init</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idx_coor_limapped_weirdos_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">idx_without_weirdos</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_without_weirdos</span><span class="p">]</span>
        <span class="n">coor_reducedreference_Li</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_reducedreference_Li</span><span class="p">])</span>
        <span class="n">idx_coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_weirdos_el</span><span class="p">]</span>
        <span class="c1"># coor_weirdos_48htype2_el = np.array(dataframe.at[idx, col_coor_weirdos_48htype2_el])</span>
        <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">idx_coor_weirdos_el</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">idx0_weirdos_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx0_weirdos_Li</span><span class="p">]</span>
        <span class="n">nr_of_weirdos_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_of_weirdos_Li</span><span class="p">]</span>
        <span class="n">sum_sanitycheck_48htypesmerged_Li</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_sanitycheck_Li</span><span class="p">]</span>

        <span class="n">ndim_coor_reducedreference_Li</span> <span class="o">=</span> <span class="n">coor_reducedreference_Li</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">ndim_coor_weirdos_el</span> <span class="o">=</span> <span class="n">coor_weirdos_el</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">len_coor_weirdos_el</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">)</span>
        <span class="n">len_coor_reducedreference_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_reducedreference_Li</span><span class="p">)</span>
        <span class="n">len_idx0_weirdos_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span>
        <span class="n">len_idx_without_weirdos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span>

        <span class="c1"># # # # if coor_weirdos_el.ndim == 2:</span>
        <span class="c1"># # # if len(coor_weirdos_el) &gt; 0:</span>
        <span class="c1"># # #     coor_limapped_weirdos = np.concatenate((coor_reducedreference_Li, coor_weirdos_el), axis=0)</span>
        <span class="c1"># # # # elif coor_weirdos_el.ndim == 1:</span>
        <span class="c1"># # # elif len(coor_weirdos_el) == 0:</span>
        <span class="c1"># # #     coor_limapped_weirdos = np.array(coor_reducedreference_Li.copy())</span>
        <span class="c1"># # # else:</span>
        <span class="c1"># # #     print(f&quot;coor_weirdos_el has no correct dimension at idx: {idx}&quot;)</span>
        <span class="c1"># # #     # break</span>

        <span class="c1"># # # if len(idx0_weirdos_Li) &gt; 0:</span>
        <span class="c1"># # #     idx0_limapped_weirdos = np.concatenate((idx_without_weirdos, idx0_weirdos_Li), axis=0)</span>
        <span class="c1"># # # elif len(idx0_weirdos_Li) == 0:</span>
        <span class="c1"># # #     idx0_limapped_weirdos = np.array(idx_without_weirdos.copy())</span>
        <span class="c1"># # # else:</span>
        <span class="c1"># # #     print(f&quot;idx0_weirdos_Li has no correct len at idx: {idx}&quot;)</span>
        <span class="c1"># # #     # break</span>
    
        <span class="c1"># if coor_weirdos_el.ndim == 2:</span>
        <span class="k">if</span> <span class="n">ndim_coor_reducedreference_Li</span> <span class="o">==</span> <span class="n">ndim_coor_weirdos_el</span> <span class="o">&amp;</span> <span class="n">ndim_coor_weirdos_el</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">coor_reducedreference_Li</span><span class="p">,</span> <span class="n">coor_weirdos_el</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_flag_coor</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>
        <span class="c1"># elif coor_weirdos_el.ndim == 1:</span>
        <span class="k">elif</span> <span class="n">ndim_coor_weirdos_el</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_reducedreference_Li</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">ndim_coor_reducedreference_Li</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">coor_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coor_weirdos_el or coor_reducedreference_Li has no correct dimension at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># break</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">idx_without_weirdos</span><span class="p">,</span> <span class="n">idx0_weirdos_Li</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_without_weirdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx0_limapped_weirdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx0_weirdos_Li</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;idx0_weirdos_Li or idx_without_weirdos has no correct len at idx: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># break</span>

        <span class="n">idx_coor_limapped_weirdos_dict_init</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">idx0_limapped_weirdos</span><span class="p">,</span> <span class="n">coor_limapped_weirdos</span><span class="p">))</span>
        <span class="c1"># if idx == 52:</span>
        <span class="c1">#     # print(f&quot;type = {type(idx_coor_limapped_weirdos_dict_init)}&quot;)</span>
        <span class="c1">#     # print(f&quot;idx_coor_limapped_weirdos_dict_init = {idx_coor_limapped_weirdos_dict_init}&quot;)</span>

        <span class="c1">#     coor_48htype1_Li = []; coor_48htype2_Li = []; coor_24g_Li = []; coor_weirdo_Li = []</span>
        <span class="c1">#     for key, value in idx_coor_limapped_weirdos_dict_init.items():</span>
        <span class="c1">#         print(f&quot;key: {key}, value: {value}&quot;)</span>
        <span class="c1">#         if (value == coor_li48htype1_ref).all():</span>

        <span class="n">coor_48htype1_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_48htype2_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_24g_Li</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">coor_weirdo_Li</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict_init</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">idx_coor_limapped_weirdos_dict_val</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx_li48htype1_temp</span><span class="p">,</span> <span class="n">coor_li48htype1_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li48htype1_ref</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_li48htype1_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;48htype1&quot;</span>
                    <span class="n">coor_48htype1_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>
            <span class="k">for</span> <span class="n">idx_li48htype2_temp</span><span class="p">,</span> <span class="n">coor_li48htype2_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li48htype2_ref</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_li48htype2_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;48htype2&quot;</span>
                    <span class="n">coor_48htype2_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>
            <span class="k">for</span> <span class="n">idx_24g_temp</span><span class="p">,</span> <span class="n">coor_li24g_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_li24g_ref</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_li24g_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;24g&quot;</span>
                    <span class="n">coor_24g_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>
            <span class="k">for</span> <span class="n">idx_weirdos_temp</span><span class="p">,</span> <span class="n">coor_weirdos_ref_temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coor_weirdos_el</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">coor_weirdos_ref_temp</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;weirdos&quot;</span>
                    <span class="n">coor_weirdo_Li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx_coor_limapped_weirdos_dict_val</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idx_coor_limapped_weirdos_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_val</span>

            <span class="c1"># if int(key) in idx_coor_limapped_weirdos_dict:</span>
            <span class="c1">#     idx_coor_limapped_weirdos_dict[int(key)].append(idx_coor_limapped_weirdos_dict_val)</span>
            <span class="c1"># else:</span>
            <span class="c1">#     idx_coor_limapped_weirdos_dict[int(key)] = idx_coor_limapped_weirdos_dict_val</span>

        <span class="c1"># amount of each type</span>
        <span class="n">amount_48htype1_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype1_Li</span><span class="p">)</span>
        <span class="n">amount_48htype2_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_48htype2_Li</span><span class="p">)</span>
        <span class="n">amount_24g_Li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_24g_Li</span><span class="p">)</span>
        <span class="n">amount_weirdo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_weirdo_Li</span><span class="p">)</span>
        <span class="n">sum_amount</span> <span class="o">=</span> <span class="n">amount_48htype1_Li</span> <span class="o">+</span> <span class="n">amount_48htype2_Li</span> <span class="o">+</span> <span class="n">amount_24g_Li</span> <span class="o">+</span> <span class="n">amount_weirdo</span>

        <span class="c1"># sanity check for the amount</span>
        <span class="c1"># if amount_weirdo == nr_of_weirdos_Li &amp; sum_amount == sum_sanitycheck_48htypesmerged_Li:</span>
        <span class="c1"># if int(amount_weirdo) == int(nr_of_weirdos_Li) &amp; int(sum_amount) == int(sum_sanitycheck_48htypesmerged_Li):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount_weirdo</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">nr_of_weirdos_Li</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sum_amount</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sum_sanitycheck_48htypesmerged_Li</span><span class="p">):</span>
                <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_label_and_weirdo_flag</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>

        <span class="n">amount_types_and_weirdo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;48htype1: </span><span class="si">{</span><span class="n">amount_48htype1_Li</span><span class="si">}</span><span class="s2">, 48htype2: </span><span class="si">{</span><span class="n">amount_48htype2_Li</span><span class="si">}</span><span class="s2">, 24g: </span><span class="si">{</span><span class="n">amount_24g_Li</span><span class="si">}</span><span class="s2">, weirdo: </span><span class="si">{</span><span class="n">amount_weirdo</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># ratio_48htype1_Li = amount_48htype1_Li / sum_amount</span>
        <span class="c1"># ratio_48htype2_Li = amount_48htype2_Li / sum_amount</span>
        <span class="c1"># ratio_24g_Li = amount_24g_Li / sum_amount</span>
        <span class="c1"># ratio_weirdo_Li = amount_weirdo / sum_amount</span>

        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_limapped_weirdos_dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_amount_types_and_weirdo</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_types_and_weirdo</span>
        <span class="c1"># dataframe.at[idx, col_ratio_48htype1_Li] = ratio_48htype1_Li</span>
        <span class="c1"># dataframe.at[idx, col_ratio_48htype2_Li] = ratio_48htype2_Li</span>
        <span class="c1"># dataframe.at[idx, col_ratio_24g_Li] = ratio_24g_Li</span>
        <span class="c1"># dataframe.at[idx, col_ratio_weirdo_Li] = ratio_weirdo_Li</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_sum_amount</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_amount</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_idx_coor_limapped_weirdos_dict_init</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_coor_limapped_weirdos_dict_init</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_reducedreference_Li</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_ndim_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndim_coor_weirdos_el</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_coor_weirdos_el</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_coor_weirdos_el</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_coor_reducedreference_Li</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_coor_reducedreference_Li</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_idx0_weirdos_Li</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_idx0_weirdos_Li</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_len_idx_without_weirdos</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_idx_without_weirdos</span>


<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>


<span class="k">def</span> <span class="nf">diagonalizing_latticeconstantsmatrix</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">destination_directory</span><span class="p">,</span> <span class="n">latticeconstantsmatrix_line_nr_start</span><span class="p">,</span> <span class="n">var_name_in</span><span class="p">,</span> <span class="n">var_name_out</span><span class="p">,</span> <span class="n">n_decimal</span><span class="p">):</span>
    <span class="c1"># # dataframe[&#39;subdir_orientated_positive_poscar&#39;] = None</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">filename_to_transform</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_POSCAR_</span><span class="si">{</span><span class="n">var_name_in</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">filename_to_transform_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">filename_to_transform</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_to_transform_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">latticeconstantsmatrix_line_nr_start</span><span class="p">:</span><span class="n">latticeconstantsmatrix_line_nr_start</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">df_diagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">max_val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_diagonal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">:</span>
                <span class="n">max_val</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">min_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_diagonal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">j</span>

        <span class="c1"># replace all diagonal of df with the max_val and let off-diagonal as 0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_val</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_val</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                        <span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="s1">&#39;{:.</span><span class="si">{width}</span><span class="s1">f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">n_decimal</span><span class="p">)</span>

        <span class="n">row_list</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># row_list_space = [&#39;  &#39;.join(string.split()) for string in row_list] # 2 spaces of distance</span>
        <span class="n">row_list_w_beginning</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_list</span><span class="p">]</span>       <span class="c1"># 1 space in the beginning</span>
        <span class="n">absolute_correct_list</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row_list_w_beginning</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>        

        <span class="n">line_append_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx_c</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">absolute_correct_list</span><span class="p">):</span>
            <span class="n">line_new_line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">line_append_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_new_line</span><span class="p">)</span>

        <span class="n">file_list</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">latticeconstantsmatrix_line_nr_start</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_append_list</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">latticeconstantsmatrix_line_nr_start</span><span class="o">+</span><span class="mi">3</span><span class="p">:]</span>

        <span class="n">poscar_filename_positive</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="si">}</span><span class="s2">_POSCAR_</span><span class="si">{</span><span class="n">var_name_out</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">poscar_filename_positive</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">poscar_positive_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
                <span class="n">poscar_positive_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># # dataframe[&#39;subdir_orientated_positive_poscar&#39;][idx] = destination_path</span>


<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>


<span class="k">def</span> <span class="nf">format_float</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="c1"># # basically nothing is formatted here</span>
    <span class="c1"># if number &lt; 0:</span>
    <span class="c1">#     # return f&#39;{(number*-1):.5f}0&#39;</span>
    <span class="c1">#     return f&#39;{number:.5f}&#39;</span>
    <span class="c1"># else:</span>
    <span class="c1">#     return f&#39;{number:.5f}&#39;</span>
    <span class="k">return</span> <span class="n">number</span>


<span class="k">def</span> <span class="nf">create_file_name</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">):</span>
    <span class="n">formatted_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">ref_positions_array</span><span class="p">]</span>
    <span class="n">formatted_positions_str</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">formatted_positions</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Li6PS5Cl_</span><span class="si">{</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_positions_str</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_optitype</span><span class="si">}</span><span class="s2">.cif&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">modif_dx_dz_get_filepath</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_path_ori_ref_48n24</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">ref_positions_array_filename</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">,</span> <span class="n">modif_all_litype</span><span class="p">):</span>
    <span class="n">file_path_new</span> <span class="o">=</span> <span class="n">create_file_name</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">ref_positions_array_filename</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">modif_all_litype</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">change_dx_dz_alllitype</span><span class="p">(</span><span class="n">file_path_ori_ref_48n24</span><span class="p">,</span> <span class="n">file_path_new</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">modif_all_litype</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">change_dx_dz_specificlitype</span><span class="p">(</span><span class="n">file_path_ori_ref_48n24</span><span class="p">,</span> <span class="n">file_path_new</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">modif_all_litype</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">change_dx_dz_alllitype</span><span class="p">(</span><span class="n">file_path_ori_ref_48n24</span><span class="p">,</span> <span class="n">file_path_new</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_path_new</span>


<span class="c1"># def modif_dx_dz_cif_alllitype(direc_perfect_poscar, file_path_ori_ref_48n24, ref_positions_array, litype, var_optitype):</span>
<span class="c1">#     file_path_new = create_file_name(direc_perfect_poscar, ref_positions_array, var_optitype)</span>
<span class="c1">#     change_dx_dz_alllitype(file_path_ori_ref_48n24, file_path_new, ref_positions_array, litype)</span>

<span class="c1">#     return file_path_new</span>


<span class="c1"># def modif_dx_dz_cif_specificlitype(direc_perfect_poscar, file_path_ori_ref_48n24, ref_positions_array, litype, var_optitype):</span>
<span class="c1">#     file_path_new = create_file_name(direc_perfect_poscar, ref_positions_array, var_optitype)</span>
<span class="c1">#     change_dx_dz_specificlitype(file_path_ori_ref_48n24, file_path_new, ref_positions_array, litype)</span>

<span class="c1">#     return file_path_new</span>


<span class="k">def</span> <span class="nf">change_dx_dz_alllitype</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_path_new</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">litype</span><span class="p">):</span>
    <span class="c1"># old_name = change_dx_dz</span>
    <span class="c1"># ref_positions_array = ALL values in this array</span>

    <span class="n">formatted_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">ref_positions_array</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;formatted_positions: </span><span class="si">{</span><span class="n">formatted_positions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type3</span><span class="p">,</span> <span class="n">new_dx2_48h_type3</span><span class="p">,</span> <span class="n">new_dz_48h_type3</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type3</span><span class="p">,</span> <span class="n">new_dx2_48h_type3</span><span class="p">,</span> <span class="n">new_dz_48h_type3</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type4</span><span class="p">,</span> <span class="n">new_dx2_48h_type4</span><span class="p">,</span> <span class="n">new_dz_48h_type4</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type3</span><span class="p">,</span> <span class="n">new_dx2_48h_type3</span><span class="p">,</span> <span class="n">new_dz_48h_type3</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type4</span><span class="p">,</span> <span class="n">new_dx2_48h_type4</span><span class="p">,</span> <span class="n">new_dz_48h_type4</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type5</span><span class="p">,</span> <span class="n">new_dx2_48h_type5</span><span class="p">,</span> <span class="n">new_dz_48h_type5</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type3</span><span class="p">,</span> <span class="n">new_dx2_48h_type3</span><span class="p">,</span> <span class="n">new_dz_48h_type3</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type4</span><span class="p">,</span> <span class="n">new_dx2_48h_type4</span><span class="p">,</span> <span class="n">new_dz_48h_type4</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type5</span><span class="p">,</span> <span class="n">new_dx2_48h_type5</span><span class="p">,</span> <span class="n">new_dz_48h_type5</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type6</span><span class="p">,</span> <span class="n">new_dx2_48h_type6</span><span class="p">,</span> <span class="n">new_dz_48h_type6</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li7&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type3</span><span class="p">,</span> <span class="n">new_dx2_48h_type3</span><span class="p">,</span> <span class="n">new_dz_48h_type3</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type4</span><span class="p">,</span> <span class="n">new_dx2_48h_type4</span><span class="p">,</span> <span class="n">new_dz_48h_type4</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type5</span><span class="p">,</span> <span class="n">new_dx2_48h_type5</span><span class="p">,</span> <span class="n">new_dz_48h_type5</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type6</span><span class="p">,</span> <span class="n">new_dx2_48h_type6</span><span class="p">,</span> <span class="n">new_dz_48h_type6</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type7</span><span class="p">,</span> <span class="n">new_dx2_48h_type7</span><span class="p">,</span> <span class="n">new_dz_48h_type7</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li7&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li8&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">new_dx_24g</span><span class="p">,</span> <span class="n">new_dz1_24g</span><span class="p">,</span> <span class="n">new_dz2_24g</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type1</span><span class="p">,</span> <span class="n">new_dx2_48h_type1</span><span class="p">,</span> <span class="n">new_dz_48h_type1</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type2</span><span class="p">,</span> <span class="n">new_dx2_48h_type2</span><span class="p">,</span> <span class="n">new_dz_48h_type2</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type3</span><span class="p">,</span> <span class="n">new_dx2_48h_type3</span><span class="p">,</span> <span class="n">new_dz_48h_type3</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type4</span><span class="p">,</span> <span class="n">new_dx2_48h_type4</span><span class="p">,</span> <span class="n">new_dz_48h_type4</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type5</span><span class="p">,</span> <span class="n">new_dx2_48h_type5</span><span class="p">,</span> <span class="n">new_dz_48h_type5</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type6</span><span class="p">,</span> <span class="n">new_dx2_48h_type6</span><span class="p">,</span> <span class="n">new_dz_48h_type6</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type7</span><span class="p">,</span> <span class="n">new_dx2_48h_type7</span><span class="p">,</span> <span class="n">new_dz_48h_type7</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
        <span class="n">new_dx1_48h_type8</span><span class="p">,</span> <span class="n">new_dx2_48h_type8</span><span class="p">,</span> <span class="n">new_dz_48h_type8</span> <span class="o">=</span> <span class="n">formatted_positions</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li1&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type1:.5f}&quot;,f&quot;{new_dx2_48h_type1:.5f}&quot;,f&quot;{new_dz_48h_type1:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz1_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz2_24g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li2&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx_24g:.5f}&quot;,f&quot;{new_dz1_24g:.5f}&quot;,f&quot;{new_dz2_24g:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li3&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li4&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li5&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li6&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li7&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li8&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type7</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Li9&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_48h_type2:.5f}&quot;,f&quot;{new_dx2_48h_type2:.5f}&quot;,f&quot;{new_dz_48h_type2:.5f}&quot;]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_48h_type8</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_48h_type8</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_48h_type8</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">change_dx_dz_specificlitype</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_path_new</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">litype</span><span class="p">):</span>

    <span class="n">formatted_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">ref_positions_array</span><span class="p">]</span>

    <span class="n">new_dx1_type</span><span class="p">,</span> <span class="n">new_dx2_type</span><span class="p">,</span> <span class="n">new_dz_type</span> <span class="o">=</span> <span class="n">formatted_positions</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_new</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Li</span><span class="si">{</span><span class="n">litype</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c1"># parts[4:6+1] = [f&quot;{new_dx1_type:.5f}&quot;,f&quot;{new_dx2_type:.5f}&quot;,f&quot;{new_dz_type:.5f}&quot;]</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_dz_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


<span class="c1"># # not yet changed from 3665 - 4444</span>
<div class="viewcode-block" id="get_sum_weirdos_Li_var">
<a class="viewcode-back" href="../index.html#get_weirdos_ver3_new_cleaned.get_sum_weirdos_Li_var">[docs]</a>
<span class="k">def</span> <span class="nf">get_sum_weirdos_Li_var</span><span class="p">(</span><span class="n">max_mapping_radius</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">file_perfect_poscar_24_wo_cif</span><span class="p">,</span> <span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">,</span> <span class="n">iter_type</span><span class="p">,</span> <span class="n">foldermapping_namestyle_all</span><span class="p">,</span> <span class="n">cif_namestyle_all</span><span class="p">,</span> <span class="n">modif_all_litype</span><span class="p">,</span> <span class="n">full_calculation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        iter_type: varying_dx_dz, varying_radius, none</span>
<span class="sd">        cif_namestyle_all: True, False, None</span>
<span class="sd">        full_calculation: True, False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="c1"># get current working directory</span>

    <span class="c1"># # user input</span>
    <span class="c1"># max_mapping_radius = 0.043</span>
    <span class="c1"># max_mapping_radius_48htype2 = 0.076</span>
    <span class="c1"># activate_radius = 2</span>
    <span class="n">lattice_constant</span> <span class="o">=</span> <span class="mf">10.2794980000</span>

    <span class="n">folder_name_init_system</span> <span class="o">=</span> <span class="s2">&quot;/Init_System&quot;</span>
    <span class="n">file_new_system</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span>
    <span class="n">file_name_toten</span> <span class="o">=</span> <span class="s2">&quot;toten_final.ods&quot;</span>
    <span class="n">col_excel_geo</span> <span class="o">=</span> <span class="s2">&quot;geometry&quot;</span>
    <span class="n">col_excel_path</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>
    <span class="n">reference_folder</span> <span class="o">=</span> <span class="s2">&quot;_reference_cif&quot;</span>
    <span class="n">results_folder</span> <span class="o">=</span> <span class="s2">&quot;_results&quot;</span>

    <span class="n">file_perfect_poscar_24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_perfect_poscar_24_wo_cif</span><span class="si">}</span><span class="s2">.cif&quot;</span>
    <span class="n">file_perfect_poscar_48n24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="si">}</span><span class="s2">.cif&quot;</span>

    <span class="n">file_path_ori_ref_48n24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">reference_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_perfect_poscar_48n24</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">path_ori_ref_48n24</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path_ori_ref_48n24</span><span class="p">)</span>
    <span class="n">path_reference_folder</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">reference_folder</span><span class="p">)</span>

    <span class="n">ref_positions_array_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ReadStructure</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">get_dx_dz_init</span><span class="p">(</span><span class="n">path_ori_ref_48n24</span><span class="p">,</span> <span class="n">litype</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dz_48h_type3</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dz_48h_type3</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dz_48h_type4</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dz_48h_type3</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dz_48h_type4</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dz_48h_type5</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">]</span>
    
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dz_48h_type3</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dz_48h_type4</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dz_48h_type5</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">dx1_48h_type6</span><span class="p">,</span> <span class="n">dx2_48h_type6</span><span class="p">,</span> <span class="n">dz_48h_type6</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dx1_48h_type6</span><span class="p">,</span> <span class="n">dx2_48h_type6</span><span class="p">]</span>
    
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dz_48h_type3</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dz_48h_type4</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dz_48h_type5</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">dx1_48h_type6</span><span class="p">,</span> <span class="n">dx2_48h_type6</span><span class="p">,</span> <span class="n">dz_48h_type6</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">dx1_48h_type7</span><span class="p">,</span> <span class="n">dx2_48h_type7</span><span class="p">,</span> <span class="n">dz_48h_type7</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dx1_48h_type6</span><span class="p">,</span> <span class="n">dx2_48h_type6</span><span class="p">,</span> <span class="n">dx1_48h_type7</span><span class="p">,</span> <span class="n">dx2_48h_type7</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dz2_24g</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dz_48h_type1</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dz_48h_type2</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dz_48h_type3</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dz_48h_type4</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dz_48h_type5</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">dx1_48h_type6</span><span class="p">,</span> <span class="n">dx2_48h_type6</span><span class="p">,</span> <span class="n">dz_48h_type6</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">dx1_48h_type7</span><span class="p">,</span> <span class="n">dx2_48h_type7</span><span class="p">,</span> <span class="n">dz_48h_type7</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
        <span class="n">dx1_48h_type8</span><span class="p">,</span> <span class="n">dx2_48h_type8</span><span class="p">,</span> <span class="n">dz_48h_type8</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span>

        <span class="n">ref_positions_array_singlelitype</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span>
        <span class="n">ref_positions_array_all_compactform</span> <span class="o">=</span> <span class="p">[</span><span class="n">dx_24g</span><span class="p">,</span> <span class="n">dz1_24g</span><span class="p">,</span> <span class="n">dx1_48h_type1</span><span class="p">,</span> <span class="n">dx2_48h_type1</span><span class="p">,</span> <span class="n">dx1_48h_type2</span><span class="p">,</span> <span class="n">dx2_48h_type2</span><span class="p">,</span> <span class="n">dx1_48h_type3</span><span class="p">,</span> <span class="n">dx2_48h_type3</span><span class="p">,</span> <span class="n">dx1_48h_type4</span><span class="p">,</span> <span class="n">dx2_48h_type4</span><span class="p">,</span> <span class="n">dx1_48h_type5</span><span class="p">,</span> <span class="n">dx2_48h_type5</span><span class="p">,</span> <span class="n">dx1_48h_type6</span><span class="p">,</span> <span class="n">dx2_48h_type6</span><span class="p">,</span> <span class="n">dx1_48h_type7</span><span class="p">,</span> <span class="n">dx2_48h_type7</span><span class="p">,</span> <span class="n">dx1_48h_type8</span><span class="p">,</span> <span class="n">dx2_48h_type8</span><span class="p">]</span>


    <span class="c1"># max_mapping_radius_48htype1_48htype2 = (max_mapping_radius + max_mapping_radius_48htype2) / 2</span>
    <span class="c1"># file_perfect_poscar_48n24 = &quot;Li6PS5Cl_type2.cif&quot;</span>
    <span class="c1"># file_perfect_poscar_24 = &quot;Li6PS5Cl_24_mod_2p27291.cif&quot; # copy this manually to folder_name_perfect_poscar  </span>

    <span class="n">folder_name_iter_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">results_folder</span><span class="si">}</span><span class="s2">/_</span><span class="si">{</span><span class="n">iter_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">path_folder_name_iter_type</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_iter_type</span><span class="p">)</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">check_folder_existance</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">empty_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">foldermapping_namestyle_all</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>            
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>            
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
        
        <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>            
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>            
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">/&quot;</span>
                
        <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name_iter_type</span><span class="si">}{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">/&quot;</span>


    <span class="n">folder_name_perfect_poscar</span> <span class="o">=</span> <span class="s2">&quot;/_reference_cif/cif_matrix/Li1/&quot;</span>
    <span class="n">cif_line_nr_start</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c1"># index from 0</span>
    <span class="n">poscar_line_nr_start</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">poscar_line_nr_end</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">contcar_columns_type2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">]</span>
    <span class="n">amount_Li</span> <span class="o">=</span> <span class="mi">24</span>
    <span class="n">col_excel_toten</span> <span class="o">=</span> <span class="s2">&quot;toten [eV]&quot;</span> 
    <span class="n">amount_P</span> <span class="o">=</span> <span class="mi">4</span> 
    <span class="n">amount_S</span> <span class="o">=</span> <span class="mi">20</span> 
    <span class="n">amount_Cl</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">file_restructure</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span> 
    <span class="n">cif_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="s1">&#39;idx_species&#39;</span><span class="p">,</span> <span class="s1">&#39;unkownvar_1&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">,</span> <span class="s1">&#39;unkownvar_2&#39;</span><span class="p">]</span> 

    <span class="n">direc_restructure_destination</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_destination_restructure</span><span class="p">)</span>
    <span class="c1"># direc_perfect_poscar = direc+str(folder_name_iter_type) ### direc+str(folder_name_perfect_poscar)</span>
    <span class="n">path_perfect_poscar_24</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">file_perfect_poscar_24</span><span class="p">)</span>
    <span class="n">direc_init_system</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_init_system</span><span class="p">)</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="n">col_excel_geo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">col_excel_path</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>

    <span class="n">data_toten</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name_toten</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;odf&quot;</span><span class="p">)</span>
    <span class="n">data_toten_ori</span> <span class="o">=</span> <span class="n">data_toten</span>
    <span class="n">data_toten</span> <span class="o">=</span> <span class="n">data_toten</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">file_loc</span> <span class="o">=</span> <span class="n">create_file_loc</span><span class="p">(</span><span class="n">direc_init_system</span><span class="p">,</span> <span class="n">data_toten</span><span class="p">,</span> <span class="n">file_new_system</span><span class="p">)</span>

    <span class="c1"># just refreshing folder</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">check_folder_existance</span><span class="p">(</span><span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">empty_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># copy ref.cif inside _results/../.. </span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_single_file</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">reference_folder</span><span class="p">,</span> <span class="n">file_perfect_poscar_48n24</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_files</span><span class="p">(</span><span class="n">file_loc</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savedir</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">PreProcessingCONTCAR</span><span class="o">.</span><span class="n">get_positive_lessthan1_poscarorcontcar</span><span class="p">(</span><span class="n">file_loc</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">poscar_line_nr_start</span><span class="p">,</span> <span class="n">poscar_line_nr_end</span><span class="p">,</span> <span class="n">contcar_columns_type2</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">,</span> <span class="n">var_name_in</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name_out</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="n">n_decimal</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">file_loc_important_cols</span> <span class="o">=</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">get_orientation</span><span class="p">(</span><span class="n">file_loc</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">path_perfect_poscar_24</span><span class="p">,</span> <span class="n">col_excel_toten</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;False&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">modif_all_litype</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ref_positions_array</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span>
    <span class="k">elif</span> <span class="n">modif_all_litype</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">ref_positions_array</span> <span class="o">=</span> <span class="n">ref_positions_array_singlelitype</span>
    <span class="k">elif</span> <span class="n">modif_all_litype</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_positions_array</span> <span class="o">=</span> <span class="n">ref_positions_array_all</span>

    <span class="k">if</span> <span class="n">cif_namestyle_all</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ref_positions_array_filename</span> <span class="o">=</span> <span class="n">ref_positions_array_all_compactform</span>
    <span class="k">elif</span> <span class="n">cif_namestyle_all</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">ref_positions_array_filename</span> <span class="o">=</span> <span class="n">ref_positions_array_singlelitype</span>
    <span class="c1"># # DUNNO WHAT TO DO HERE</span>
    <span class="k">elif</span> <span class="n">cif_namestyle_all</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_positions_array_filename</span> <span class="o">=</span> <span class="n">ref_positions_array_all_compactform</span>

    <span class="c1"># path_perfect_poscar_48n24 = modif_dx_dz_cif(direc_perfect_poscar, file_path_ori_ref_48n24, dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, var_optitype) # os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>
    <span class="c1"># path_perfect_poscar_48n24 = modif_dx_dz_get_filepath(direc_perfect_poscar, file_path_ori_ref_48n24, ref_positions_array, ref_positions_array_filename, litype, var_optitype, modif_all_litype)</span>
    <span class="n">path_perfect_poscar_48n24</span> <span class="o">=</span> <span class="n">modif_dx_dz_get_filepath</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">path_ori_ref_48n24</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">ref_positions_array_filename</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">,</span> <span class="n">modif_all_litype</span><span class="p">)</span>

    <span class="c1"># just copy file</span>
    <span class="c1"># Operation.File.copy_rename_single_file(direc_restructure_destination, direc_perfect_poscar, file_perfect_poscar_24, prefix=None)</span>
    <span class="c1"># !!! had to copy file_perfect_poscar_48n24 into Li1</span>
    <span class="c1"># Operation.File.copy_rename_single_file(direc_restructure_destination, direc_perfect_poscar, file_perfect_poscar_48n24, prefix=None)</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_single_file</span><span class="p">(</span><span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">file_perfect_poscar_48n24</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Operation.File.copy_rename_files(file_loc_important_cols, direc_restructure_destination, file_restructure, prefix=None,  savedir = True)</span>

    <span class="c1"># # var_c = &quot;trf_w_linalg_orientated&quot;</span>
    <span class="c1"># # Orientation.get_structure_with_linalg_orientated(file_loc_important_cols, direc_restructure_destination, file_restructure, var_c)</span>


    <span class="c1"># # var_name_in = &quot;trf_w_linalg_orientated&quot;</span>
    <span class="c1"># # var_name_out = &quot;trf_w_linalg_orientated_positive&quot;</span>
    <span class="c1"># # n_decimal = 8</span>
    <span class="c1"># # get_orientated_positive_lessthan1_cif(file_loc_important_cols, direc_restructure_destination, cif_line_nr_start, cif_columns, var_name_in, var_name_out, n_decimal)</span>

    <span class="c1"># max_mapping_radius = 0.05282658993283027</span>
    <span class="c1"># max_mapping_radius = 0.045</span>
    <span class="c1"># max_mapping_radius = 0.055</span>
    <span class="c1"># max_mapping_radius = 0.04197083906</span>
    <span class="n">ref_structure_48n24</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_perfect_poscar_48n24</span><span class="p">)</span>
    <span class="n">cif_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">ref_structure_48n24</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">ref_structure_48n24</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">ref_structure_48n24</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
    <span class="n">cif</span> <span class="o">=</span> <span class="n">CifWriter</span><span class="p">(</span><span class="n">cif_structure</span><span class="p">)</span>
    <span class="n">cif</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">direc_restructure_destination</span><span class="si">}{</span><span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="si">}</span><span class="s2">_expanded.cif&quot;</span><span class="p">)</span>

    <span class="n">coor_structure_init_dict</span> <span class="o">=</span> <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict</span><span class="p">(</span><span class="n">ref_structure_48n24</span><span class="p">)</span>
    <span class="n">coor_structure_init_dict_expanded</span> <span class="o">=</span> <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict</span><span class="p">(</span><span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">direc_restructure_destination</span><span class="si">}{</span><span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="si">}</span><span class="s2">_expanded.cif&quot;</span><span class="p">))</span>

    <span class="c1"># PreProcessingCONTCAR.get_positive_lessthan1_poscarorcontcar(file_loc_important_cols, direc_restructure_destination, poscar_line_nr_start, poscar_line_nr_end, contcar_columns_type2, file_type = &quot;CONTCAR&quot;, var_name_in = None, var_name_out = &quot;positive&quot;, n_decimal=16)</span>
    <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict_wholedataframe</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

    <span class="c1"># if activate_radius == 3:</span>
    <span class="c1">#     get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius)</span>
    <span class="c1">#     get_flag_map_weirdos_48htype1_48htype2_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius_48htype1_48htype2)</span>
    <span class="c1">#     get_flag_map_weirdos_48htypesmerged_level1_el(file_loc_important_cols, &quot;Li&quot;)</span>
    <span class="c1">#     get_flag_map_weirdos_48htype2_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius_48htype2, activate_radius)</span>
    <span class="c1">#     get_flag_map_48htypesmerged_el(file_loc_important_cols, &quot;Li&quot;, activate_radius)</span>
    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">)</span>
        <span class="n">get_flag_map_weirdos_48htype2_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
        <span class="n">get_flag_map_48htypesmerged_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">)</span>

    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;P&quot;, max_mapping_radius)</span>
    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;S&quot;, max_mapping_radius)</span>
    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Cl&quot;, max_mapping_radius)</span>

    <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">get_idx_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>

    <span class="c1"># Mapping.AtomIndexing.idx_correcting_mapped_el(file_loc_important_cols, el=&quot;Li&quot;)</span>
    <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">idx_correcting_mapped_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
    <span class="c1"># # Mapping.OutputCIF.create_combine_structure(file_loc_important_cols, direc_restructure_destination, amount_Li, amount_P, amount_S, var_savefilename = &quot;mapLi&quot;)</span>
    
    <span class="n">Mapping</span><span class="o">.</span><span class="n">Labelling</span><span class="o">.</span><span class="n">get_distance_weirdos_label_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>

    <span class="c1"># file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;coor_weirdos_48htypesmerged_Li&quot;,&quot;top3_dist_weirdos_dict_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;#weirdos_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
    <span class="c1"># file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype2_Li_new&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li_new&quot;,&quot;sum_sanitycheck_48htypesmerged_Li_new&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_Li&quot;,&quot;duplicate_closest24_w_data_Li&quot;,&quot;duplicate_closest24_w_data_48htype2_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>

    <span class="c1"># if activate_radius == 3:</span>
    <span class="c1">#     file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype1_48htype2_Li_closestduplicate&quot;,&quot;sum_weirdos_48htype1_48htype2_Li&quot;,&quot;sum_mapped_48htype2_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li&quot;,&quot;sum_sanitycheck_48htypesmerged_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
    <span class="c1">#     file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype1_48htype2_Li_closestduplicate&quot;,&quot;sum_weirdos_48htype1_48htype2_Li&quot;,&quot;sum_mapped_48htype2_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li&quot;,&quot;sum_sanitycheck_48htypesmerged_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;toten [eV]&quot;]]</span>

    <span class="c1">#     sum_weirdos_Li = float(file_loc_important_cols_sorted_toten[&quot;#weirdos_Li&quot;].sum())</span>

    <span class="c1">#     var_excel_file = f&quot;{int(sum_weirdos_Li)}_{dx1_48h_type1}_{dx2_48h_type1}_{formatted_dz_48h_type1}_{dx1_48h_type2}_{dx2_48h_type2}_{formatted_dz_48h_type2}_{dx_24g}_{dz1_24g}_{formatted_dz2_24g}_{max_mapping_radius}_{max_mapping_radius_48htype2}_{max_mapping_radius_48htype1_48htype2}&quot;</span>
    
    <span class="k">if</span> <span class="n">full_calculation</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">full_calculation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputCIF</span><span class="o">.</span><span class="n">create_combine_structure</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">var_savefilename</span> <span class="o">=</span> <span class="s2">&quot;mapLi&quot;</span><span class="p">)</span>
        <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputCIF</span><span class="o">.</span><span class="n">rewrite_cif_w_correct_Li_idx</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">amount_Cl</span><span class="p">,</span> <span class="n">var_savefilename_init</span> <span class="o">=</span> <span class="s2">&quot;mapLi&quot;</span><span class="p">,</span> <span class="n">var_savefilename_new</span> <span class="o">=</span> <span class="s2">&quot;mapLi_reindexed&quot;</span><span class="p">)</span>
        <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputCIF</span><span class="o">.</span><span class="n">format_spacing_cif</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">var_savefilename_init</span> <span class="o">=</span> <span class="s2">&quot;mapLi_reindexed&quot;</span><span class="p">,</span> <span class="n">var_savefilename_new</span> <span class="o">=</span> <span class="s2">&quot;mapLi_reindexed&quot;</span><span class="p">)</span>
        <span class="c1"># # # # Operation.File.delete_files(file_loc_important_cols, direc_restructure_destination, file_name_w_format = &quot;mapLi_reindexed.cif&quot;)</span>

        <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputCIF</span><span class="o">.</span><span class="n">rewrite_cif_w_correct_Li_idx_weirdos_appended</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">amount_Li</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">,</span> <span class="n">amount_S</span><span class="p">,</span> <span class="n">amount_Cl</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span><span class="n">var_savefilename_init</span> <span class="o">=</span> <span class="s2">&quot;mapLi&quot;</span><span class="p">,</span> <span class="n">var_savefilename_new</span> <span class="o">=</span> <span class="s2">&quot;mapLi_reindexed_weirdos_appended&quot;</span><span class="p">)</span>
        <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputCIF</span><span class="o">.</span><span class="n">format_spacing_cif</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">var_savefilename_init</span> <span class="o">=</span> <span class="s2">&quot;mapLi_reindexed_weirdos_appended&quot;</span><span class="p">,</span> <span class="n">var_savefilename_new</span> <span class="o">=</span> <span class="s2">&quot;mapLi_reindexed_weirdos_appended&quot;</span><span class="p">)</span>
        <span class="c1"># # # Operation.File.delete_files(file_loc_important_cols, direc_restructure_destination, file_name_w_format = &quot;mapLi_reindexed_weirdos_appended.cif&quot;)</span>

        <span class="n">PreProcessingCONTCAR</span><span class="o">.</span><span class="n">create_cif_pymatgen</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR_positive&quot;</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR_positive_pymatgen&quot;</span><span class="p">)</span>

        <span class="c1"># # # Mapping.OutputCIF.ascending_Li(file_loc_important_cols, direc_restructure_destination, var_filename_init = &quot;mapLi_reindexed_weirdos_appended&quot;, var_savefilename_new = &quot;mapLi_reindexed_weirdos_appended_reordered&quot;)</span>
        <span class="c1"># # # Mapping.OutputCIF.format_spacing_cif(file_loc_important_cols, direc_restructure_destination, var_savefilename_init = &quot;mapLi_reindexed_weirdos_appended_reordered&quot;, var_savefilename_new = &quot;mapLi_reindexed_weirdos_appended_reordered&quot;)</span>

        <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">get_idx_coor_limapped_weirdos_dict_litype</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">el</span><span class="o">=</span><span class="s2">&quot;Li&quot;</span><span class="p">)</span>

        <span class="n">PreProcessingCONTCAR</span><span class="o">.</span><span class="n">get_latticeconstant_structure_dict_iterated</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">var_filename</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">)</span>
        <span class="c1"># Plot.StructureAnalysis.energy_vs_latticeconstant(file_loc_important_cols, var_filename = &quot;CONTCAR&quot;)</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">StructureAnalysis</span><span class="o">.</span><span class="n">weirdos_directcoor</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>

        <span class="n">coor_weirdos_Li</span> <span class="o">=</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputWeirdos</span><span class="o">.</span><span class="n">get_coor_weirdos_array</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
        <span class="n">Mapping</span><span class="o">.</span><span class="n">OutputWeirdos</span><span class="o">.</span><span class="n">create_POSCAR_weirdos</span><span class="p">(</span><span class="n">coor_weirdos_Li</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">lattice_constant</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;POSCAR_weirdos&quot;</span><span class="p">)</span>

        <span class="n">Mapping</span><span class="o">.</span><span class="n">Labelling</span><span class="o">.</span><span class="n">get_label_mapping</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>   
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype8_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype8_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>   

        <span class="c1"># var_excel_file = f&quot;{int(sum_weirdos_Li)}_{dx1_48h_type1}_{dx2_48h_type1}_{formatted_dz_48h_type1}_{dx1_48h_type2}_{dx2_48h_type2}_{formatted_dz_48h_type2}_{dx_24g}_{dz1_24g}_{formatted_dz2_24g}_{max_mapping_radius}_{max_mapping_radius_48htype2}&quot;</span>
    
    <span class="n">sum_weirdos_Li</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">file_loc_important_cols_sorted_toten</span><span class="p">[</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>



    <span class="k">if</span> <span class="n">foldermapping_namestyle_all</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
        
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dz1_24g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type2</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type3</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type4</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type5</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type6</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type7</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx1_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dx2_48h_type8</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>


    <span class="c1"># path_excel_file = os.path.join(direc_perfect_poscar, f&#39;04_outputs_{var_excel_file}_{var_optitype}.xlsx&#39;)</span>
    <span class="n">path_excel_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;04_outputs_</span><span class="si">{</span><span class="n">var_excel_file</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">var_optitype</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>
    <span class="n">file_loc_important_cols_sorted_toten</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">path_excel_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">file_loc_important_cols</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder_name_iter_type</span><span class="si">}</span><span class="s1">file_loc_important_cols_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">file_loc_important_cols</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder_name_iter_type</span><span class="si">}</span><span class="s1">file_loc_important_cols_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">file_perfect_poscar_48n24_wo_cif</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">)</span>
    <span class="c1"># elif activate_radius == 3:</span>
    <span class="c1">#     file_loc_important_cols.to_pickle(f&#39;{path_folder_name_iter_type}file_loc_important_cols_{max_mapping_radius}_{max_mapping_radius_48htype2}_{max_mapping_radius_48htype1_48htype2}_{file_perfect_poscar_48n24_wo_cif}.pkl&#39;)</span>

    <span class="k">return</span> <span class="n">sum_weirdos_Li</span></div>



<span class="c1"># def get_sum_weirdos_Li_var_wo_weirdo(dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, max_mapping_radius, max_mapping_radius_48htype2, df_wo_weirdos_selectedcol, activate_radius, file_perfect_poscar_24, file_ori_ref_48n24, litype, var_optitype):</span>

<span class="c1">#     file_loc_important_cols = df_wo_weirdos_selectedcol</span>

<span class="c1">#     formatted_dx1_48h_type1 = format_float(dx1_48h_type1)</span>
<span class="c1">#     formatted_dx2_48h_type1 = format_float(dx2_48h_type1)</span>
<span class="c1">#     formatted_dz_48h_type1 = format_float(dz_48h_type1)</span>
<span class="c1">#     formatted_dx1_48h_type2 = format_float(dx1_48h_type2)</span>
<span class="c1">#     formatted_dx2_48h_type2 = format_float(dx2_48h_type2)</span>
<span class="c1">#     formatted_dz_48h_type2 = format_float(dz_48h_type2)</span>
<span class="c1">#     formatted_dx_24g = format_float(dx_24g)</span>
<span class="c1">#     formatted_dz1_24g = format_float(dz1_24g)</span>
<span class="c1">#     formatted_dz2_24g = format_float(dz2_24g)</span>
<span class="c1">#     direc = os.getcwd() # get current working directory</span>

<span class="c1">#     # # user input</span>
<span class="c1">#     # max_mapping_radius = 0.043</span>
<span class="c1">#     # max_mapping_radius_48htype2 = 0.076</span>
<span class="c1">#     # activate_radius = 2</span>

<span class="c1">#     file_path_ori_ref_48n24 = f&quot;./perfect_poscar/cif_matrix/ori/{file_ori_ref_48n24}&quot;</span>
<span class="c1">#     # max_mapping_radius_48htype1_48htype2 = (max_mapping_radius + max_mapping_radius_48htype2) / 2</span>
<span class="c1">#     # file_ori_ref_48n24 = &quot;Li6PS5Cl_type2.cif&quot;</span>
<span class="c1">#     # file_perfect_poscar_24 = &quot;Li6PS5Cl_24_mod_2p27291.cif&quot; # copy this manually to folder_name_perfect_poscar  </span>

<span class="c1">#     folder_name_init_system = &quot;/Init_System&quot;</span>
<span class="c1">#     file_new_system = &quot;CONTCAR&quot;</span>
<span class="c1">#     file_name_toten = &quot;toten_final.ods&quot;</span>
<span class="c1">#     col_excel_geo = &quot;geometry&quot;</span>
<span class="c1">#     col_excel_path = &quot;path&quot;</span>

<span class="c1">#     if activate_radius == 2:</span>
<span class="c1">#         folder_name_destination_restructure = f&quot;/restructure_{formatted_dx1_48h_type1}_{formatted_dx2_48h_type1}_{formatted_dx1_48h_type2}_{formatted_dx2_48h_type2}_{formatted_dx_24g}_{formatted_dz1_24g}_{max_mapping_radius}_{max_mapping_radius_48htype2}_optimizer/&quot;</span>
<span class="c1">#     elif activate_radius == 1:</span>
<span class="c1">#         folder_name_destination_restructure = f&quot;/restructure_{formatted_dx1_48h_type1}_{formatted_dx2_48h_type1}_{formatted_dx1_48h_type2}_{formatted_dx2_48h_type2}_{formatted_dx_24g}_{formatted_dz1_24g}_{max_mapping_radius}_optimizer/&quot;</span>

<span class="c1">#     folder_name_perfect_poscar = &quot;/perfect_poscar/cif_matrix/Li1/&quot;</span>
<span class="c1">#     cif_line_nr_start = 26  # index from 0</span>
<span class="c1">#     poscar_line_nr_start = 8</span>
<span class="c1">#     poscar_line_nr_end = 60</span>
<span class="c1">#     contcar_columns_type2 = [&#39;coord_x&#39;, &#39;coord_y&#39;, &#39;coord_z&#39;]</span>
<span class="c1">#     amount_Li = 24</span>
<span class="c1">#     col_excel_toten = &quot;toten [eV]&quot; </span>
<span class="c1">#     amount_P = 4 </span>
<span class="c1">#     amount_S = 20 </span>
<span class="c1">#     file_restructure = &quot;CONTCAR&quot; </span>
<span class="c1">#     cif_columns = [&#39;species&#39;, &#39;idx_species&#39;, &#39;unkownvar_1&#39;, &#39;coord_x&#39;, &#39;coord_y&#39;, &#39;coord_z&#39;, &#39;unkownvar_2&#39;] </span>

<span class="c1">#     direc_restructure_destination = direc+str(folder_name_destination_restructure)</span>
<span class="c1">#     direc_perfect_poscar = direc+str(folder_name_perfect_poscar)</span>
<span class="c1">#     path_perfect_poscar_24 = os.path.join(direc_perfect_poscar, file_perfect_poscar_24)</span>
<span class="c1">#     direc_init_system = direc+str(folder_name_init_system)</span>

<span class="c1">#     dtype = {col_excel_geo: float, col_excel_path: float}</span>

<span class="c1">#     data_toten = pd.read_excel(file_name_toten, dtype=dtype, engine=&quot;odf&quot;)</span>
<span class="c1">#     data_toten_ori = data_toten</span>
<span class="c1">#     data_toten = data_toten.sort_values(by=[&quot;geometry&quot;,&quot;path&quot;],ignore_index=True,ascending=False)</span>

<span class="c1">#     # just refreshing folder</span>
<span class="c1">#     Operation.File.check_folder_existance(direc_restructure_destination)</span>

<span class="c1">#     # path_perfect_poscar_48n24 = modif_dx_dz_cif(direc_perfect_poscar, file_path_ori_ref_48n24, dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, var_optitype) # os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>
<span class="c1">#     path_perfect_poscar_48n24 = modif_dx_dz_cif_allvariables(direc_perfect_poscar, file_path_ori_ref_48n24, dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, var_optitype) # os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>

<span class="c1">#     # just copy file</span>
<span class="c1">#     # Operation.File.copy_rename_single_file(direc_restructure_destination, direc_perfect_poscar, file_perfect_poscar_24, prefix=None)</span>
<span class="c1">#     # !!! had to copy file_ori_ref_48n24 into Li1</span>
<span class="c1">#     Operation.File.copy_rename_single_file(direc_restructure_destination, direc_perfect_poscar, file_ori_ref_48n24, prefix=None)</span>

<span class="c1">#     # file_loc_mask_1, file_loc_important_cols = Orientation.get_orientation(file_loc, direc_restructure_destination, file_restructure, path_perfect_poscar_24, col_excel_toten, orientation=&quot;False&quot;)</span>

<span class="c1">#     Operation.File.copy_rename_files(file_loc_important_cols, direc_restructure_destination, file_restructure, prefix=None, savedir = True)</span>


<span class="c1">#     # # var_c = &quot;trf_w_linalg_orientated&quot;</span>
<span class="c1">#     # # Orientation.get_structure_with_linalg_orientated(file_loc_important_cols, direc_restructure_destination, file_restructure, var_c)</span>


<span class="c1">#     # # var_name_in = &quot;trf_w_linalg_orientated&quot;</span>
<span class="c1">#     # # var_name_out = &quot;trf_w_linalg_orientated_positive&quot;</span>
<span class="c1">#     # # n_decimal = 8</span>
<span class="c1">#     # # get_orientated_positive_lessthan1_cif(file_loc_important_cols, direc_restructure_destination, cif_line_nr_start, cif_columns, var_name_in, var_name_out, n_decimal)</span>

<span class="c1">#     # max_mapping_radius = 0.05282658993283027</span>
<span class="c1">#     # max_mapping_radius = 0.045</span>
<span class="c1">#     # max_mapping_radius = 0.055</span>
<span class="c1">#     # max_mapping_radius = 0.04197083906</span>
<span class="c1">#     ref_structure_48n24 = Structure.from_file(path_perfect_poscar_48n24)</span>

<span class="c1">#     coor_structure_init_dict = ReadStructure.Coor.get_coor_structure_init_dict(ref_structure_48n24)</span>
<span class="c1">#     PreProcessingCONTCAR.get_positive_lessthan1_poscarorcontcar(file_loc_important_cols, direc_restructure_destination, poscar_line_nr_start, poscar_line_nr_end, contcar_columns_type2, file_type = &quot;CONTCAR&quot;, var_name_in = None, var_name_out = &quot;positive&quot;, n_decimal=16)</span>
<span class="c1">#     ReadStructure.Coor.get_coor_structure_init_dict_wholedataframe(file_loc_important_cols, mapping = &quot;False&quot;)</span>

<span class="c1">#     # if activate_radius == 3:</span>
<span class="c1">#     #     get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius)</span>
<span class="c1">#     #     get_flag_map_weirdos_48htype1_48htype2_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius_48htype1_48htype2)</span>
<span class="c1">#     #     get_flag_map_weirdos_48htypesmerged_level1_el(file_loc_important_cols, &quot;Li&quot;)</span>
<span class="c1">#     #     get_flag_map_weirdos_48htype2_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius_48htype2, activate_radius)</span>
<span class="c1">#     #     get_flag_map_48htypesmerged_el(file_loc_important_cols, &quot;Li&quot;, activate_radius)</span>
<span class="c1">#     if activate_radius == 2:</span>
<span class="c1">#         get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius)</span>
<span class="c1">#         get_flag_map_weirdos_48htype2_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius_48htype2, activate_radius)</span>
<span class="c1">#         get_flag_map_48htypesmerged_el(file_loc_important_cols, &quot;Li&quot;, activate_radius)</span>
<span class="c1">#     elif activate_radius == 1:</span>
<span class="c1">#         get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, max_mapping_radius)</span>

<span class="c1">#     # get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;P&quot;, max_mapping_radius)</span>
<span class="c1">#     # get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;S&quot;, max_mapping_radius)</span>
<span class="c1">#     # get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Cl&quot;, max_mapping_radius)</span>

<span class="c1">#     Mapping.AtomIndexing.get_idx_weirdos_el(file_loc_important_cols, &quot;Li&quot;, activate_radius)</span>

<span class="c1">#     # Mapping.AtomIndexing.idx_correcting_mapped_el(file_loc_important_cols, el=&quot;Li&quot;)</span>
<span class="c1">#     Mapping.AtomIndexing.idx_correcting_mapped_el(file_loc_important_cols, &quot;Li&quot;, activate_radius)</span>
<span class="c1">#     # # Mapping.OutputCIF.create_combine_structure(file_loc_important_cols, direc_restructure_destination, amount_Li, amount_P, amount_S, var_savefilename = &quot;mapLi&quot;)</span>
    
<span class="c1">#     Mapping.Labelling.get_distance_weirdos_label_el(file_loc_important_cols, coor_structure_init_dict, &quot;Li&quot;, litype)</span>

<span class="c1">#     # file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;coor_weirdos_48htypesmerged_Li&quot;,&quot;top3_dist_weirdos_dict_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;#weirdos_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#     # file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype2_Li_new&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li_new&quot;,&quot;sum_sanitycheck_48htypesmerged_Li_new&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_Li&quot;,&quot;duplicate_closest24_w_data_Li&quot;,&quot;duplicate_closest24_w_data_48htype2_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>

<span class="c1">#     # if activate_radius == 3:</span>
<span class="c1">#     #     file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype1_48htype2_Li_closestduplicate&quot;,&quot;sum_weirdos_48htype1_48htype2_Li&quot;,&quot;sum_mapped_48htype2_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li&quot;,&quot;sum_sanitycheck_48htypesmerged_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#     #     file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype1_48htype2_Li_closestduplicate&quot;,&quot;sum_weirdos_48htype1_48htype2_Li&quot;,&quot;sum_mapped_48htype2_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li&quot;,&quot;sum_sanitycheck_48htypesmerged_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;toten [eV]&quot;]]</span>

<span class="c1">#     #     sum_weirdos_Li = float(file_loc_important_cols_sorted_toten[&quot;#weirdos_Li&quot;].sum())</span>

<span class="c1">#     #     var_excel_file = f&quot;{int(sum_weirdos_Li)}_{formatted_dx1_48h_type1}_{formatted_dx2_48h_type1}_{formatted_dz_48h_type1}_{formatted_dx1_48h_type2}_{formatted_dx2_48h_type2}_{formatted_dz_48h_type2}_{formatted_dx_24g}_{formatted_dz1_24g}_{formatted_dz2_24g}_{max_mapping_radius}_{max_mapping_radius_48htype2}_{max_mapping_radius_48htype1_48htype2}&quot;</span>
    
<span class="c1">#     if activate_radius == 2:</span>
<span class="c1">#         if litype == 0:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 1:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 2:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 3:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 4:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 5:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_48htype5_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_48htype5_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
        
<span class="c1">#         sum_weirdos_Li = float(file_loc_important_cols_sorted_toten[&quot;#weirdos_Li&quot;].sum())</span>

<span class="c1">#         var_excel_file = f&quot;{int(sum_weirdos_Li)}_{formatted_dx1_48h_type1}_{formatted_dx2_48h_type1}_{formatted_dz_48h_type1}_{formatted_dx1_48h_type2}_{formatted_dx2_48h_type2}_{formatted_dz_48h_type2}_{formatted_dx_24g}_{formatted_dz1_24g}_{formatted_dz2_24g}_{max_mapping_radius}_{max_mapping_radius_48htype2}&quot;</span>

<span class="c1">#     elif activate_radius == 1:</span>
<span class="c1">#         if litype == 0:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 1:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 2:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 3:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 4:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>
<span class="c1">#         elif litype == 5:</span>
<span class="c1">#             file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_48htype5_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
<span class="c1">#             file_loc_important_cols_not_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_mapped_Li_closestduplicate&quot;,&quot;#weirdos_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_idxweirdo_dist_Li&quot;,&quot;top3_sorted_idxweirdo_label_Li&quot;,&quot;#closest_48htype1_Li&quot;,&quot;#closest_48htype2_Li&quot;,&quot;#closest_48htype3_Li&quot;,&quot;#closest_48htype4_Li&quot;,&quot;#closest_48htype5_Li&quot;,&quot;#closest_24g_Li&quot;,&quot;toten [eV]&quot;]]</span>

<span class="c1">#         sum_weirdos_Li = float(file_loc_important_cols_sorted_toten[&quot;#weirdos_Li&quot;].sum())</span>

<span class="c1">#         var_excel_file = f&quot;{int(sum_weirdos_Li)}_{formatted_dx1_48h_type1}_{formatted_dx2_48h_type1}_{formatted_dz_48h_type1}_{formatted_dx1_48h_type2}_{formatted_dx2_48h_type2}_{formatted_dz_48h_type2}_{formatted_dx_24g}_{formatted_dz1_24g}_{formatted_dz2_24g}_{max_mapping_radius}&quot;</span>

<span class="c1">#     path_excel_file = os.path.join(direc_perfect_poscar, f&#39;04_outputs_{var_excel_file}_{var_optitype}.xlsx&#39;)</span>
<span class="c1">#     file_loc_important_cols_sorted_toten.to_excel(path_excel_file, index=False)</span>

<span class="c1">#     return sum_weirdos_Li</span>


<span class="k">def</span> <span class="nf">get_sum_weirdos_Li_var_wo_weirdo_litype</span><span class="p">(</span><span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">df_wo_weirdos_selectedcol</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">file_perfect_poscar_24</span><span class="p">,</span> <span class="n">file_ori_ref_48n24</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">,</span> <span class="n">iter_type</span><span class="p">):</span>

    <span class="n">file_loc_important_cols</span> <span class="o">=</span> <span class="n">df_wo_weirdos_selectedcol</span>

    <span class="n">formatted_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">ref_positions_array</span><span class="p">]</span>
    <span class="n">new_dx1_type</span><span class="p">,</span> <span class="n">new_dx2_type</span><span class="p">,</span> <span class="n">new_dz_type</span> <span class="o">=</span> <span class="n">formatted_positions</span>
    
    <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="c1"># get current working directory</span>

    <span class="c1"># # user input</span>
    <span class="c1"># max_mapping_radius = 0.043</span>
    <span class="c1"># max_mapping_radius_48htype2 = 0.076</span>
    <span class="c1"># activate_radius = 2</span>
    <span class="n">results_folder</span> <span class="o">=</span> <span class="s2">&quot;_results&quot;</span>
    <span class="n">reference_folder</span> <span class="o">=</span> <span class="s2">&quot;_reference_cif&quot;</span>

    <span class="n">file_path_ori_ref_48n24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./</span><span class="si">{</span><span class="n">reference_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_ori_ref_48n24</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># max_mapping_radius_48htype1_48htype2 = (max_mapping_radius + max_mapping_radius_48htype2) / 2</span>
    <span class="c1"># file_ori_ref_48n24 = &quot;Li6PS5Cl_type2.cif&quot;</span>
    <span class="c1"># file_perfect_poscar_24 = &quot;Li6PS5Cl_24_mod_2p27291.cif&quot; # copy this manually to folder_name_perfect_poscar  </span>

    <span class="n">folder_name_init_system</span> <span class="o">=</span> <span class="s2">&quot;/Init_System&quot;</span>
    <span class="n">file_new_system</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span>
    <span class="n">file_name_toten</span> <span class="o">=</span> <span class="s2">&quot;toten_final.ods&quot;</span>
    <span class="n">col_excel_geo</span> <span class="o">=</span> <span class="s2">&quot;geometry&quot;</span>
    <span class="n">col_excel_path</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>

    <span class="n">folder_name_iter_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">results_folder</span><span class="si">}</span><span class="s2">/_</span><span class="si">{</span><span class="n">iter_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_ori_ref_48n24</span><span class="si">}</span><span class="s2">/&quot;</span>
    <span class="n">path_folder_name_iter_type</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_iter_type</span><span class="p">)</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">check_folder_existance</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">empty_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># copy ref.cif inside _results/../.. </span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_single_file</span><span class="p">(</span><span class="n">path_folder_name_iter_type</span><span class="p">,</span> <span class="n">reference_folder</span><span class="p">,</span> <span class="n">file_ori_ref_48n24</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_folder_name_iter_type</span><span class="si">}</span><span class="s2">restructure_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">_optimizer/&quot;</span>
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_folder_name_iter_type</span><span class="si">}</span><span class="s2">restructure_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_optimizer/&quot;</span>

    <span class="n">folder_name_perfect_poscar</span> <span class="o">=</span> <span class="n">folder_name_iter_type</span>
    <span class="n">cif_line_nr_start</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c1"># index from 0</span>
    <span class="n">poscar_line_nr_start</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">poscar_line_nr_end</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">contcar_columns_type2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">]</span>
    <span class="n">amount_Li</span> <span class="o">=</span> <span class="mi">24</span>
    <span class="n">col_excel_toten</span> <span class="o">=</span> <span class="s2">&quot;toten [eV]&quot;</span> 
    <span class="n">amount_P</span> <span class="o">=</span> <span class="mi">4</span> 
    <span class="n">amount_S</span> <span class="o">=</span> <span class="mi">20</span> 
    <span class="n">file_restructure</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span> 
    <span class="n">cif_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="s1">&#39;idx_species&#39;</span><span class="p">,</span> <span class="s1">&#39;unkownvar_1&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">,</span> <span class="s1">&#39;unkownvar_2&#39;</span><span class="p">]</span> 

    <span class="n">direc_restructure_destination</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_destination_restructure</span><span class="p">)</span>
    <span class="n">direc_perfect_poscar</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_perfect_poscar</span><span class="p">)</span>
    <span class="n">path_perfect_poscar_24</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_perfect_poscar_24</span><span class="p">)</span>
    <span class="n">direc_init_system</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_init_system</span><span class="p">)</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="n">col_excel_geo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">col_excel_path</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>

    <span class="n">data_toten</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name_toten</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;odf&quot;</span><span class="p">)</span>
    <span class="n">data_toten_ori</span> <span class="o">=</span> <span class="n">data_toten</span>
    <span class="n">data_toten</span> <span class="o">=</span> <span class="n">data_toten</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># just refreshing folder</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">check_folder_existance</span><span class="p">(</span><span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">empty_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># path_perfect_poscar_48n24 = modif_dx_dz_cif(direc_perfect_poscar, file_path_ori_ref_48n24, dx1_48h_type, dx2_48h_type, dz_48h_type, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, var_optitype) # os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>
    <span class="c1"># path_perfect_poscar_48n24 = modif_dx_dz_cif_specificlitype(direc_perfect_poscar, file_path_ori_ref_48n24, ref_positions_array, var_optitype) # os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>
    <span class="n">path_perfect_poscar_48n24</span> <span class="o">=</span> <span class="n">modif_dx_dz_get_filepath</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_path_ori_ref_48n24</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">,</span> <span class="n">modif_all_litype</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># just copy file</span>
    <span class="c1"># Operation.File.copy_rename_single_file(direc_restructure_destination, direc_perfect_poscar, file_perfect_poscar_24, prefix=None)</span>
    <span class="c1"># !!! had to copy file_ori_ref_48n24 into Li1</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_single_file</span><span class="p">(</span><span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_ori_ref_48n24</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># file_loc_mask_1, file_loc_important_cols = Orientation.get_orientation(file_loc, direc_restructure_destination, file_restructure, path_perfect_poscar_24, col_excel_toten, orientation=&quot;False&quot;)</span>

    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_files</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savedir</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


    <span class="c1"># # var_c = &quot;trf_w_linalg_orientated&quot;</span>
    <span class="c1"># # Orientation.get_structure_with_linalg_orientated(file_loc_important_cols, direc_restructure_destination, file_restructure, var_c)</span>


    <span class="c1"># # var_name_in = &quot;trf_w_linalg_orientated&quot;</span>
    <span class="c1"># # var_name_out = &quot;trf_w_linalg_orientated_positive&quot;</span>
    <span class="c1"># # n_decimal = 8</span>
    <span class="c1"># # get_orientated_positive_lessthan1_cif(file_loc_important_cols, direc_restructure_destination, cif_line_nr_start, cif_columns, var_name_in, var_name_out, n_decimal)</span>

    <span class="c1"># max_mapping_radius = 0.05282658993283027</span>
    <span class="c1"># max_mapping_radius = 0.045</span>
    <span class="c1"># max_mapping_radius = 0.055</span>
    <span class="c1"># max_mapping_radius = 0.04197083906</span>
    <span class="n">ref_structure_48n24</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_perfect_poscar_48n24</span><span class="p">)</span>

    <span class="n">coor_structure_init_dict</span> <span class="o">=</span> <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict</span><span class="p">(</span><span class="n">ref_structure_48n24</span><span class="p">)</span>
    <span class="n">PreProcessingCONTCAR</span><span class="o">.</span><span class="n">get_positive_lessthan1_poscarorcontcar</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">poscar_line_nr_start</span><span class="p">,</span> <span class="n">poscar_line_nr_end</span><span class="p">,</span> <span class="n">contcar_columns_type2</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">,</span> <span class="n">var_name_in</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name_out</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="n">n_decimal</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict_wholedataframe</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">)</span>
        <span class="n">get_flag_map_weirdos_48htype2_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
        <span class="n">get_flag_map_48htypesmerged_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">)</span>

    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;P&quot;, max_mapping_radius)</span>
    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;S&quot;, max_mapping_radius)</span>
    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Cl&quot;, max_mapping_radius)</span>

    <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">get_idx_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>

    <span class="c1"># Mapping.AtomIndexing.idx_correcting_mapped_el(file_loc_important_cols, el=&quot;Li&quot;)</span>
    <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">idx_correcting_mapped_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
    <span class="c1"># # Mapping.OutputCIF.create_combine_structure(file_loc_important_cols, direc_restructure_destination, amount_Li, amount_P, amount_S, var_savefilename = &quot;mapLi&quot;)</span>
    
    <span class="n">Mapping</span><span class="o">.</span><span class="n">Labelling</span><span class="o">.</span><span class="n">get_distance_weirdos_label_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>

    <span class="c1"># file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;coor_weirdos_48htypesmerged_Li&quot;,&quot;top3_dist_weirdos_dict_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;#weirdos_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
    <span class="c1"># file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype2_Li_new&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li_new&quot;,&quot;sum_sanitycheck_48htypesmerged_Li_new&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_Li&quot;,&quot;duplicate_closest24_w_data_Li&quot;,&quot;duplicate_closest24_w_data_48htype2_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>

    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype8_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype8_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>   

    <span class="n">sum_weirdos_Li</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">file_loc_important_cols_sorted_toten</span><span class="p">[</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            
    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dz_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dz_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">path_excel_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;04_outputs_</span><span class="si">{</span><span class="n">var_excel_file</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">var_optitype</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>
    <span class="n">file_loc_important_cols_sorted_toten</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">path_excel_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sum_weirdos_Li</span>


<span class="k">def</span> <span class="nf">get_sum_weirdos_Li_var_litype</span><span class="p">(</span><span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">,</span> <span class="n">file_perfect_poscar_24</span><span class="p">,</span> <span class="n">file_ori_ref_48n24</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">):</span>
    
    <span class="n">formatted_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">ref_positions_array</span><span class="p">]</span>
    <span class="n">new_dx1_type</span><span class="p">,</span> <span class="n">new_dx2_type</span><span class="p">,</span> <span class="n">new_dz_type</span> <span class="o">=</span> <span class="n">formatted_positions</span>

    <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="c1"># get current working directory</span>

    <span class="c1"># # user input</span>
    <span class="c1"># max_mapping_radius = 0.043</span>
    <span class="c1"># max_mapping_radius_48htype2 = 0.076</span>
    <span class="c1"># activate_radius = 2</span>

    <span class="n">file_path_ori_ref_48n24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./perfect_poscar/cif_matrix/ori/</span><span class="si">{</span><span class="n">file_ori_ref_48n24</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># max_mapping_radius_48htype1_48htype2 = (max_mapping_radius + max_mapping_radius_48htype2) / 2</span>
    <span class="c1"># file_ori_ref_48n24 = &quot;Li6PS5Cl_type2.cif&quot;</span>
    <span class="c1"># file_perfect_poscar_24 = &quot;Li6PS5Cl_24_mod_2p27291.cif&quot; # copy this manually to folder_name_perfect_poscar  </span>

    <span class="n">folder_name_init_system</span> <span class="o">=</span> <span class="s2">&quot;/Init_System&quot;</span>
    <span class="n">file_new_system</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span>
    <span class="n">file_name_toten</span> <span class="o">=</span> <span class="s2">&quot;toten_final.ods&quot;</span>
    <span class="n">col_excel_geo</span> <span class="o">=</span> <span class="s2">&quot;geometry&quot;</span>
    <span class="n">col_excel_path</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>

    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/restructure_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">_optimizer/&quot;</span>
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">folder_name_destination_restructure</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/restructure_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_optimizer/&quot;</span>

    <span class="n">folder_name_perfect_poscar</span> <span class="o">=</span> <span class="s2">&quot;/perfect_poscar/cif_matrix/Li1/&quot;</span>
    <span class="n">cif_line_nr_start</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c1"># index from 0</span>
    <span class="n">poscar_line_nr_start</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">poscar_line_nr_end</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">contcar_columns_type2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">]</span>
    <span class="n">amount_Li</span> <span class="o">=</span> <span class="mi">24</span>
    <span class="n">col_excel_toten</span> <span class="o">=</span> <span class="s2">&quot;toten [eV]&quot;</span> 
    <span class="n">amount_P</span> <span class="o">=</span> <span class="mi">4</span> 
    <span class="n">amount_S</span> <span class="o">=</span> <span class="mi">20</span> 
    <span class="n">file_restructure</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span> 
    <span class="n">cif_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="s1">&#39;idx_species&#39;</span><span class="p">,</span> <span class="s1">&#39;unkownvar_1&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_x&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_y&#39;</span><span class="p">,</span> <span class="s1">&#39;coord_z&#39;</span><span class="p">,</span> <span class="s1">&#39;unkownvar_2&#39;</span><span class="p">]</span> 

    <span class="n">direc_restructure_destination</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_destination_restructure</span><span class="p">)</span>
    <span class="n">direc_perfect_poscar</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_perfect_poscar</span><span class="p">)</span>
    <span class="n">path_perfect_poscar_24</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_perfect_poscar_24</span><span class="p">)</span>
    <span class="n">direc_init_system</span> <span class="o">=</span> <span class="n">direc</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">folder_name_init_system</span><span class="p">)</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="n">col_excel_geo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">col_excel_path</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>

    <span class="n">data_toten</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name_toten</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;odf&quot;</span><span class="p">)</span>
    <span class="n">data_toten_ori</span> <span class="o">=</span> <span class="n">data_toten</span>
    <span class="n">data_toten</span> <span class="o">=</span> <span class="n">data_toten</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">subdir_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">direc</span><span class="p">,</span><span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># source: https://stackoverflow.com/questions/27805919/how-to-only-read-lines-in-a-text-file-after-a-certain-string</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">subdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="c1"># get directory of CONTCAR</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">==</span> <span class="n">file_new_system</span><span class="p">:</span>
                <span class="n">geometry_nr</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">splitall</span><span class="p">(</span><span class="n">subdir</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">path_nr</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">splitall</span><span class="p">(</span><span class="n">subdir</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">geometry_nr</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="n">geometry_ori</span> <span class="o">=</span> <span class="n">geometry</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">path_nr</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span><span class="c1">#</span>
                <span class="n">path</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">path_sorted</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">subdir_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="n">file_new_system</span><span class="p">)</span>
                <span class="c1"># # create directory of POSCAR of init system</span>
                <span class="n">subdir_init_system</span> <span class="o">=</span> <span class="n">direc_init_system</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">geometry_nr</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path_nr</span>
                <span class="n">subdir_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdir_col</span><span class="p">,</span> <span class="n">subdir_file</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subdir_new_system&quot;</span><span class="p">])</span>
                <span class="n">file_loc</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;subdir_new_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdir_col</span><span class="c1">#</span>
                <span class="n">path_ori</span> <span class="o">=</span> <span class="n">path</span>

    <span class="n">file_loc_ori_notsorted</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">file_loc</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># sort descendingly based on path</span>

    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># replace NaN with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># replace 1st element with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">][(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># replace last element with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">][(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">])]</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">][</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># hardcode the path 0/0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;p_s_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">]]</span>



    <span class="k">if</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_geo</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_path</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">file_loc</span><span class="p">[</span><span class="n">col_excel_toten</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_toten</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check the compatibility of column geometry and path between data_toten file and file_loc&quot;</span><span class="p">)</span>

    <span class="c1"># just refreshing folder</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">check_folder_existance</span><span class="p">(</span><span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">empty_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># path_perfect_poscar_48n24 = modif_dx_dz_cif(direc_perfect_poscar, file_path_ori_ref_48n24, dx1_48h_type, dx2_48h_type, dz_48h_type, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, var_optitype) # os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>
    <span class="n">path_perfect_poscar_48n24</span> <span class="o">=</span> <span class="n">modif_dx_dz_cif_specificlitype</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_path_ori_ref_48n24</span><span class="p">,</span> <span class="n">ref_positions_array</span><span class="p">,</span> <span class="n">var_optitype</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span> <span class="c1"># os.path.join(direc_perfect_poscar, file_perfect_poscar_48n24)</span>

    <span class="c1"># just copy file</span>
    <span class="c1"># Operation.File.copy_rename_single_file(direc_restructure_destination, direc_perfect_poscar, file_perfect_poscar_24, prefix=None)</span>
    <span class="c1"># !!! had to copy file_ori_ref_48n24 into Li1</span>
    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_single_file</span><span class="p">(</span><span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="n">file_ori_ref_48n24</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">file_loc_mask_1</span><span class="p">,</span> <span class="n">file_loc_important_cols</span> <span class="o">=</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">get_orientation</span><span class="p">(</span><span class="n">file_loc</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">path_perfect_poscar_24</span><span class="p">,</span> <span class="n">col_excel_toten</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;False&quot;</span><span class="p">)</span>

    <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">copy_rename_files</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">file_restructure</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savedir</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


    <span class="c1"># # var_c = &quot;trf_w_linalg_orientated&quot;</span>
    <span class="c1"># # Orientation.get_structure_with_linalg_orientated(file_loc_important_cols, direc_restructure_destination, file_restructure, var_c)</span>


    <span class="c1"># # var_name_in = &quot;trf_w_linalg_orientated&quot;</span>
    <span class="c1"># # var_name_out = &quot;trf_w_linalg_orientated_positive&quot;</span>
    <span class="c1"># # n_decimal = 8</span>
    <span class="c1"># # get_orientated_positive_lessthan1_cif(file_loc_important_cols, direc_restructure_destination, cif_line_nr_start, cif_columns, var_name_in, var_name_out, n_decimal)</span>

    <span class="c1"># max_mapping_radius = 0.05282658993283027</span>
    <span class="c1"># max_mapping_radius = 0.045</span>
    <span class="c1"># max_mapping_radius = 0.055</span>
    <span class="c1"># max_mapping_radius = 0.04197083906</span>
    <span class="n">ref_structure_48n24</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_perfect_poscar_48n24</span><span class="p">)</span>

    <span class="n">coor_structure_init_dict</span> <span class="o">=</span> <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict</span><span class="p">(</span><span class="n">ref_structure_48n24</span><span class="p">)</span>
    <span class="n">PreProcessingCONTCAR</span><span class="o">.</span><span class="n">get_positive_lessthan1_poscarorcontcar</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">direc_restructure_destination</span><span class="p">,</span> <span class="n">poscar_line_nr_start</span><span class="p">,</span> <span class="n">poscar_line_nr_end</span><span class="p">,</span> <span class="n">contcar_columns_type2</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">,</span> <span class="n">var_name_in</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name_out</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="n">n_decimal</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ReadStructure</span><span class="o">.</span><span class="n">Coor</span><span class="o">.</span><span class="n">get_coor_structure_init_dict_wholedataframe</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">)</span>
        <span class="n">get_flag_map_weirdos_48htype2_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius_48htype2</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
        <span class="n">get_flag_map_48htypesmerged_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">get_flag_map_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">)</span>

    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;P&quot;, max_mapping_radius)</span>
    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;S&quot;, max_mapping_radius)</span>
    <span class="c1"># get_flag_map_weirdos_el(file_loc_important_cols, coor_structure_init_dict, &quot;Cl&quot;, max_mapping_radius)</span>

    <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">get_idx_weirdos_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>

    <span class="c1"># Mapping.AtomIndexing.idx_correcting_mapped_el(file_loc_important_cols, el=&quot;Li&quot;)</span>
    <span class="n">Mapping</span><span class="o">.</span><span class="n">AtomIndexing</span><span class="o">.</span><span class="n">idx_correcting_mapped_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">)</span>
    <span class="c1"># # Mapping.OutputCIF.create_combine_structure(file_loc_important_cols, direc_restructure_destination, amount_Li, amount_P, amount_S, var_savefilename = &quot;mapLi&quot;)</span>
    
    <span class="n">Mapping</span><span class="o">.</span><span class="n">Labelling</span><span class="o">.</span><span class="n">get_distance_weirdos_label_el</span><span class="p">(</span><span class="n">file_loc_important_cols</span><span class="p">,</span> <span class="n">coor_structure_init_dict</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="n">litype</span><span class="p">)</span>

    <span class="c1"># file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;coor_weirdos_48htypesmerged_Li&quot;,&quot;top3_dist_weirdos_dict_Li&quot;,&quot;idx0_weirdos_Li&quot;,&quot;#weirdos_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>
    <span class="c1"># file_loc_important_cols_sorted_toten = file_loc_important_cols[[&quot;geometry&quot;,&quot;path&quot;,&quot;sum_weirdos_Li&quot;,&quot;sum_mapped_48htype2_Li_new&quot;,&quot;#weirdos_Li&quot;,&quot;sum_mapped_48htypesmerged_Li_new&quot;,&quot;sum_sanitycheck_48htypesmerged_Li_new&quot;,&quot;idx0_weirdos_Li&quot;,&quot;top3_sorted_coorweirdo_dist_label_coorreference_idxweirdo_idxreference_Li&quot;,&quot;duplicate_closest24_w_data_Li&quot;,&quot;duplicate_closest24_w_data_48htype2_Li&quot;,&quot;toten [eV]&quot;]].sort_values(&quot;toten [eV]&quot;, ascending=True)</span>

    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;atom_mapping_Li_w_dist_label&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">file_loc_important_cols_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype8_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_loc_important_cols_not_sorted_toten</span> <span class="o">=</span> <span class="n">file_loc_important_cols</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;sum_mapped_Li_closestduplicate&quot;</span><span class="p">,</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;idx0_weirdos_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_dist_Li&quot;</span><span class="p">,</span><span class="s2">&quot;top3_sorted_idxweirdo_label_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype1_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype2_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype3_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype4_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype5_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype6_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype7_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_48htype8_Li&quot;</span><span class="p">,</span><span class="s2">&quot;#closest_24g_Li&quot;</span><span class="p">,</span><span class="s2">&quot;toten [eV]&quot;</span><span class="p">]]</span>   


    <span class="n">sum_weirdos_Li</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">file_loc_important_cols_sorted_toten</span><span class="p">[</span><span class="s2">&quot;#weirdos_Li&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        
    <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dz_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius_48htype2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">var_excel_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sum_weirdos_Li</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx1_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dx2_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_dz_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_mapping_radius</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">path_excel_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">direc_perfect_poscar</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;04_outputs_</span><span class="si">{</span><span class="n">var_excel_file</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">var_optitype</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>
    <span class="n">file_loc_important_cols_sorted_toten</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">path_excel_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sum_weirdos_Li</span>


<span class="c1"># def varying_radius_vs_sumweirdosLi(dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, max_mapping_radius, max_mapping_radius_48htype2, delta_radius, n_sample, var_optitype):</span>
    
<span class="c1">#     col_radius_type1 = &quot;radius_type1&quot;</span>
<span class="c1">#     col_radius_type2 = &quot;radius_type2&quot;</span>
<span class="c1">#     col_sumweirdosLi = &quot;sumweirdosLi&quot;</span>

<span class="c1">#     radius_sumweirdosLi_df = pd.DataFrame()</span>
<span class="c1">#     radius_sumweirdosLi_df[col_radius_type1] = None</span>
<span class="c1">#     radius_sumweirdosLi_df[col_radius_type2] = None</span>
<span class="c1">#     radius_sumweirdosLi_df[col_sumweirdosLi] = None</span>

<span class="c1">#     idx_sumweirdosLi_df = 0</span>
<span class="c1">#     forward_max_mapping_radius = max_mapping_radius</span>
<span class="c1">#     forward_max_mapping_radius_48htype2 = max_mapping_radius_48htype2</span>
<span class="c1">#     backward_max_mapping_radius = max_mapping_radius</span>
<span class="c1">#     backward_max_mapping_radius_48htype2 = max_mapping_radius_48htype2</span>

<span class="c1">#     for i in range(int(n_sample/2)):</span>
<span class="c1">#         forward_max_mapping_radius += i * delta_radius</span>
<span class="c1">#         forward_max_mapping_radius_48htype2 += i * delta_radius</span>
    
<span class="c1">#         sum_weirdos_Li = get_sum_weirdos_Li_w_radius(dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, forward_max_mapping_radius, forward_max_mapping_radius_48htype2, var_optitype)</span>

<span class="c1">#         radius_sumweirdosLi_df.at[idx_sumweirdosLi_df, col_radius_type1] = forward_max_mapping_radius</span>
<span class="c1">#         radius_sumweirdosLi_df.at[idx_sumweirdosLi_df, col_radius_type2] = forward_max_mapping_radius_48htype2</span>
<span class="c1">#         radius_sumweirdosLi_df.at[idx_sumweirdosLi_df, col_sumweirdosLi] = sum_weirdos_Li</span>
<span class="c1">#         print(idx_sumweirdosLi_df)</span>

<span class="c1">#     # for j in range(int(n_sample/2)):</span>
<span class="c1">#     #     backward_max_mapping_radius -= j * delta_radius</span>
<span class="c1">#     #     backward_max_mapping_radius_48htype2 -= j * delta_radius</span>
    
<span class="c1">#     #     sum_weirdos_Li = get_sum_weirdos_Li_w_radius(dx1_48h_type1, dx2_48h_type1, dz_48h_type1, dx1_48h_type2, dx2_48h_type2, dz_48h_type2, dx_24g, dz1_24g, dz2_24g, backward_max_mapping_radius, backward_max_mapping_radius_48htype2, var_optitype)</span>

<span class="c1">#     #     radius_sumweirdosLi_df.at[idx_sumweirdosLi_df, col_radius_type1] = backward_max_mapping_radius</span>
<span class="c1">#     #     radius_sumweirdosLi_df.at[idx_sumweirdosLi_df, col_radius_type2] = backward_max_mapping_radius_48htype2</span>
<span class="c1">#     #     radius_sumweirdosLi_df.at[idx_sumweirdosLi_df, col_sumweirdosLi] = sum_weirdos_Li</span>
<span class="c1">#     #     print(idx_sumweirdosLi_df)</span>

<span class="c1">#     return radius_sumweirdosLi_df</span>


<span class="k">def</span> <span class="nf">plot_varying_radius_vs_sumweirdosLi</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="n">col_radius_type1</span> <span class="o">=</span> <span class="s2">&quot;radius_type1&quot;</span>
    <span class="n">col_radius_type2</span> <span class="o">=</span> <span class="s2">&quot;radius_type2&quot;</span>
    <span class="n">col_sumweirdosLi</span> <span class="o">=</span> <span class="s2">&quot;sumweirdosLi&quot;</span>

    <span class="c1"># # dataframe_to_float = dataframe.copy()</span>
    <span class="c1"># dataframe_to_float[col_radius_type1] = dataframe_to_float[col_radius_type1].apply(lambda x: float(x[0]))</span>
    <span class="c1"># dataframe_to_float[col_radius_type2] = dataframe_to_float[col_radius_type2].apply(lambda x: float(x[0]))</span>
    <span class="c1"># dataframe_to_float[col_sumweirdosLi] = dataframe_to_float[col_sumweirdosLi].apply(lambda x: float(x[0]))</span>

    <span class="c1"># # %matplotlib inline</span>
    <span class="n">matrix_map</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">col_radius_type2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_radius_type1</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">col_sumweirdosLi</span><span class="p">)</span>  
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">matrix_map</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_distweirdos</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="n">col_top1_sorted_idxweirdo_dist_el</span> <span class="o">=</span> <span class="s2">&quot;top1_sorted_idxweirdo_dist_Li&quot;</span>
    <span class="n">col_top1_sorted_idxweirdo_label_el</span> <span class="o">=</span> <span class="s2">&quot;top1_sorted_idxweirdo_label_Li&quot;</span>
    <span class="n">col_top1_sorted_idxweirdo_coor_el</span> <span class="o">=</span> <span class="s2">&quot;top1_sorted_idxweirdo_coor_Li&quot;</span>
    <span class="n">col_top1_sorted_idxweirdo_file_el</span> <span class="o">=</span> <span class="s2">&quot;top1_sorted_idxweirdo_file_Li&quot;</span>

    <span class="n">val</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">dist_weirdos_el_appendend</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_appended</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">label_weirdos_el_appended</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coor_weirdos_el_appended</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">file_weirdos_el_appended</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">dist_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_dist_el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">label_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_label_el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_coor_el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">file_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_file_el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">single_dist</span> <span class="ow">in</span> <span class="n">dist_weirdos_el</span><span class="p">:</span>
            <span class="n">dist_weirdos_el_appendend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">single_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">single_label</span> <span class="ow">in</span> <span class="n">label_weirdos_el</span><span class="p">:</span>
            <span class="n">label_weirdos_el_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">single_coor</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span><span class="p">:</span>
            <span class="n">coor_weirdos_el_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_coor</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">single_file</span> <span class="ow">in</span> <span class="n">file_weirdos_el</span><span class="p">:</span>
            <span class="n">file_weirdos_el_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">dist_weirdos_el_appendend</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label_weirdos_el_appended</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_appended</span><span class="p">,</span> <span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_weirdos_el_appended</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_weirdos_el_appended</span><span class="p">})</span>

    <span class="c1"># fig = px.scatter(df, x = &#39;dist&#39;, y = &#39;y&#39;, color=&#39;label&#39;, color_discrete_map={&#39;48htype1&#39;: &#39;red&#39;, &#39;48htype2&#39;: &#39;blue&#39;, &#39;24g&#39;: &#39;green&#39;})</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> 
                    <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> 
                    <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> 
                    <span class="n">color</span> <span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                    <span class="n">hover_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;coor&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scrollZoom&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">create_file_loc</span><span class="p">(</span><span class="n">direc_init_system</span><span class="p">,</span> <span class="n">data_toten</span><span class="p">,</span> <span class="n">file_new_system</span><span class="p">):</span>
    <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">col_excel_geo</span> <span class="o">=</span> <span class="s2">&quot;geometry&quot;</span>
    <span class="n">col_excel_path</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>
    <span class="n">col_excel_toten</span> <span class="o">=</span> <span class="s2">&quot;toten [eV]&quot;</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">subdir_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">subdir_col_init_system</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">subdir_col_perfect_poscar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">direc</span><span class="p">,</span><span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># source: https://stackoverflow.com/questions/27805919/how-to-only-read-lines-in-a-text-file-after-a-certain-string</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">subdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="c1"># get directory of CONTCAR</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">==</span> <span class="n">file_new_system</span><span class="p">:</span>
                <span class="n">geometry_nr</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">splitall</span><span class="p">(</span><span class="n">subdir</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">path_nr</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">splitall</span><span class="p">(</span><span class="n">subdir</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">geometry_nr</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="n">geometry_ori</span> <span class="o">=</span> <span class="n">geometry</span>
                <span class="c1"># geometry = geometry.applymap(func=replace)</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">path_nr</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
                <span class="c1"># path = path.applymap(func=replace)</span>
                <span class="n">path</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">path_sorted</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">subdir_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="n">file_new_system</span><span class="p">)</span>
                <span class="c1"># # create directory of POSCAR of init system</span>
                <span class="n">subdir_init_system</span> <span class="o">=</span> <span class="n">direc_init_system</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">geometry_nr</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path_nr</span>
                <span class="c1"># # subdir_file_init_system = os.path.join(subdir_init_system,file_init_system)</span>
                <span class="c1"># subdir_file_perfect_poscar = os.path.join()</span>
                <span class="n">subdir_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdir_col</span><span class="p">,</span> <span class="n">subdir_file</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subdir_new_system&quot;</span><span class="p">])</span>
                <span class="c1"># # subdir_col_init_system = pd.DataFrame(np.append(subdir_col_init_system, subdir_file_init_system), columns=[&quot;subdir_init_system&quot;])</span>
                <span class="c1"># # subdir_col_perfect_poscar = pd.DataFrame(np.append(subdir_col_perfect_poscar, direc_perfect_system), columns=[&quot;subdir_perfect_poscar&quot;])</span>
                <span class="n">file_loc</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;subdir_new_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdir_col</span>
                <span class="c1"># # file_loc[&quot;subdir_init_system&quot;] = subdir_col_init_system</span>
                <span class="c1"># # file_loc[&quot;subdir_perfect_poscar&quot;] = subdir_col_perfect_poscar</span>
                <span class="n">path_ori</span> <span class="o">=</span> <span class="n">path</span>

    <span class="n">file_loc_ori_notsorted</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># file_loc_ori_notsorted = file_loc</span>
    <span class="n">file_loc</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># sort descendingly based on path</span>

    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># replace NaN with 0</span>
    <span class="c1"># file_loc[&quot;g+p&quot;] = file_loc[&quot;geometry&quot;] + file_loc[&quot;path&quot;]</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># replace 1st element with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">][(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># replace last element with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">][(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">])]</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">][</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># hardcode the path 0/0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;p_s_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">]]</span>
    <span class="c1"># # subdir_filtered = file_loc[&quot;subdir&quot;] * file_loc[&quot;p_s_mask&quot;]</span>


    <span class="k">if</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_geo</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_path</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">file_loc</span><span class="p">[</span><span class="n">col_excel_toten</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_toten</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check the compatibility of column geometry and path between data_toten file and file_loc&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_loc</span>


<span class="k">def</span> <span class="nf">create_file_loc_compact_demo</span><span class="p">(</span><span class="n">direc_init_system</span><span class="p">,</span> <span class="n">data_toten</span><span class="p">,</span> <span class="n">file_new_system</span><span class="p">):</span>
    <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">col_excel_geo</span> <span class="o">=</span> <span class="s2">&quot;geometry&quot;</span>
    <span class="n">col_excel_path</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>
    <span class="n">col_excel_toten</span> <span class="o">=</span> <span class="s2">&quot;toten [eV]&quot;</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">subdir_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">direc</span><span class="p">,</span><span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># source: https://stackoverflow.com/questions/27805919/how-to-only-read-lines-in-a-text-file-after-a-certain-string</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">subdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="c1"># get directory of CONTCAR</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">==</span> <span class="n">file_new_system</span><span class="p">:</span>
                <span class="n">geometry_nr</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">splitall</span><span class="p">(</span><span class="n">subdir</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">path_nr</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">splitall</span><span class="p">(</span><span class="n">subdir</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">geometry_nr</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="n">geometry_ori</span> <span class="o">=</span> <span class="n">geometry</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">path_nr</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span><span class="c1">#</span>
                <span class="n">path</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">path_sorted</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">subdir_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="n">file_new_system</span><span class="p">)</span>
                <span class="c1"># # create directory of POSCAR of init system</span>
                <span class="n">subdir_init_system</span> <span class="o">=</span> <span class="n">direc_init_system</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">geometry_nr</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path_nr</span>
                <span class="n">subdir_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdir_col</span><span class="p">,</span> <span class="n">subdir_file</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subdir_new_system&quot;</span><span class="p">])</span>
                <span class="n">file_loc</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;subdir_new_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdir_col</span><span class="c1">#</span>
                <span class="n">path_ori</span> <span class="o">=</span> <span class="n">path</span>

    <span class="n">file_loc_ori_notsorted</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">file_loc</span> <span class="o">=</span> <span class="n">file_loc</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># sort descendingly based on path</span>

    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># replace NaN with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># replace 1st element with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">][(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># replace last element with 0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">][(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p+1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p-1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;g+p&quot;</span><span class="p">])]</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">][</span><span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># hardcode the path 0/0</span>
    <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;p_s_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;perfect_system&quot;</span><span class="p">]]</span>



    <span class="k">if</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_geo</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_path</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">file_loc</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">file_loc</span><span class="p">[</span><span class="n">col_excel_toten</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_toten</span><span class="p">[</span><span class="n">col_excel_toten</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check the compatibility of column geometry and path between data_toten file and file_loc&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_loc</span>



<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>


<span class="k">def</span> <span class="nf">get_triads_movement</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">geo</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">,</span> <span class="n">filename_ref_72</span><span class="p">):</span>
    <span class="c1"># df_coor = pd.DataFrame()</span>
    <span class="n">df_triad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df_ratio</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df_dist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">df_dist</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># coor_Li_ref = []</span>

    <span class="c1"># col_xyz_coor = &quot;xyz_coor&quot;</span>

    <span class="c1"># df_coor[col_xyz_coor] = None</span>

    <span class="k">if</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_0</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_1</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_2</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_3</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_4</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_5</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_6</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_7</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_8</span>

    <span class="n">file_ref_24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geo</span><span class="si">}</span><span class="s2">_0_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
    <span class="n">file_path_ref_24</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_ref_24</span><span class="p">)</span>

    <span class="n">file_ref_72</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_ref_72</span><span class="si">}</span><span class="s2">.cif&quot;</span>
    <span class="n">file_path_ref_72</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_ref_72</span><span class="p">)</span>


    <span class="n">idx_coor_Li_dict_ref_24</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path_ref_24</span><span class="p">)</span>    <span class="c1"># key is the pointer to 24</span>
    <span class="n">idx_coor_Li_dict_ref_72</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path_ref_72</span><span class="p">)</span>    <span class="c1"># key is the pointer to 24</span>

    <span class="n">idx_coor_Li_dict_ref_triad</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict_ref_triad</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_24</span><span class="p">,</span> <span class="n">idx_coor_Li_dict_ref_72</span><span class="p">)</span>
    <span class="c1"># idxs_Li_ref_24 = list(idx_coor_Li_dict_ref_24.keys())</span>
    <span class="c1"># idxs_Li_ref_72 = list(idx_coor_Li_dict_ref_72.keys())</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_geo</span><span class="p">:</span>
        <span class="c1"># coor_Li = []</span>
        <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geo</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="n">idx_coor_Li_dict</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="c1"># idxs_Li = list(idx_coor_Li_dict.keys())</span>

        <span class="c1"># # idx_coor_Li_triad_belonging_initial = defaultdict(list)</span>
        <span class="c1"># # idx_coor_Li_triad_belonging_initial_centroid = defaultdict(list)</span>

        <span class="c1">### does the numeration of Li is important?</span>
        <span class="c1">### 1) check which triad it does belong to initially</span>

        <span class="n">idx_coor_Li_idx_centroid_triad_ref</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_idx_centroid_triad</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_triad</span><span class="p">,</span> <span class="n">idx_coor_Li_dict_ref_24</span><span class="p">)</span>
        <span class="n">idx_coor_Li_idx_centroid_triad</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_idx_centroid_triad</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_triad</span><span class="p">,</span> <span class="n">idx_coor_Li_dict</span><span class="p">)</span>
        <span class="n">idxs_Li_dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_coor_Li_idx_centroid_triad</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="c1">## get ratio of 24:48</span>
        <span class="n">counter_48</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">Li_idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx_coor_Li_idx_centroid_triad</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># print(Operation.Distance.mic_eucledian_distance(val[&#39;coor&#39;], val[&#39;centroid_triad&#39;]))</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;structure&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">48</span><span class="p">:</span>
                <span class="n">counter_48</span> <span class="o">=</span> <span class="n">counter_48</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># print(f&quot;path {i} has ratio of 48 of: {counter_48/len(idx_coor_Li_idx_centroid_triad)}&quot;)</span>
        <span class="n">df_ratio</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;ratio of 48&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter_48</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_coor_Li_idx_centroid_triad</span><span class="p">)</span>

        <span class="c1">## get li-to-li-distance </span>
        <span class="n">dist_ascending</span><span class="p">,</span> <span class="n">sorted_coors_Li_dist_structures</span> <span class="o">=</span> <span class="n">get_dist_ascending</span><span class="p">(</span><span class="n">idx_coor_Li_idx_centroid_triad</span><span class="p">)</span>
        <span class="c1"># print(dist_ascending)</span>
        <span class="n">df_dist</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_ascending</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">idxs_Li_dict</span><span class="p">:</span>
            <span class="c1"># df_triad.at[i, f&quot;{j}&quot;] = None  </span>

            <span class="n">triad</span> <span class="o">=</span> <span class="n">idx_coor_Li_idx_centroid_triad</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;idx_triad&quot;</span><span class="p">]</span>

            <span class="n">df_triad</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">triad</span>

            <span class="k">if</span> <span class="n">triad</span> <span class="o">==</span> <span class="n">df_triad</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;path: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, Li: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, triad: </span><span class="si">{</span><span class="n">triad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_triad</span><span class="p">,</span> <span class="n">df_ratio</span><span class="p">,</span> <span class="n">df_dist</span><span class="p">,</span> <span class="n">sorted_coors_Li_dist_structures</span>



<span class="k">def</span> <span class="nf">get_triads_fullness</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">geo</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">,</span> <span class="n">filename_ref_72</span><span class="p">):</span>
    <span class="c1"># df_idx_triad_counts = pd.DataFrame #(np.zeros((24, 1)))</span>
    <span class="c1"># df_idx_triad_counts[&quot;idx_triad_counts&quot;] = None</span>

    <span class="n">idx_coor_Li_idx_centroid_triad_weirdos_appended_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_0</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_1</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_2</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_3</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_4</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_5</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_6</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_7</span>
    <span class="k">elif</span> <span class="n">geo</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">path_geo</span> <span class="o">=</span> <span class="n">path_geo_8</span>

    <span class="n">df_idx_triad_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_geo</span><span class="p">))))</span>

    <span class="n">file_ref_24</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geo</span><span class="si">}</span><span class="s2">_0_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
    <span class="n">file_path_ref_24</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_ref_24</span><span class="p">)</span>

    <span class="n">file_ref_72</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_ref_72</span><span class="si">}</span><span class="s2">.cif&quot;</span>
    <span class="n">file_path_ref_72</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_ref_72</span><span class="p">)</span>

    <span class="n">idx_coor_Li_dict_ref_24</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path_ref_24</span><span class="p">)</span>    <span class="c1"># key is the pointer to 24</span>
    <span class="n">idx_coor_Li_dict_ref_72</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path_ref_72</span><span class="p">)</span>    <span class="c1"># key is the pointer to 24</span>

    <span class="n">idx_coor_Li_dict_ref_triad</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict_ref_triad</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_24</span><span class="p">,</span> <span class="n">idx_coor_Li_dict_ref_72</span><span class="p">)</span>
    <span class="c1"># idxs_Li_ref_24 = list(idx_coor_Li_dict_ref_24.keys())</span>
    <span class="c1"># idxs_Li_ref_72 = list(idx_coor_Li_dict_ref_72.keys())</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_geo</span><span class="p">:</span>
        <span class="c1"># coor_Li = []</span>
        <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geo</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">.cif&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="n">idx_coor_Li_dict</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="n">file_weirdos_appended</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geo</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">_weirdos_appended.cif&quot;</span>
        <span class="n">file_path_weirdos_appended</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_directory</span><span class="p">,</span> <span class="n">file_weirdos_appended</span><span class="p">)</span>

        <span class="n">idx_coor_Li_dict_weirdos_appended</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_dict</span><span class="p">(</span><span class="n">file_path_weirdos_appended</span><span class="p">)</span>
        <span class="c1"># idx_coor_Li_dict_ref_triad_weirdos_appended = get_idx_coor_Li_dict_ref_triad(idx_coor_Li_dict_weirdos_appended, idx_coor_Li_dict_ref_72)</span>

        <span class="n">idxs_Li</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">idx_coor_Li_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">idxs_Li_not</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idxs_Li</span><span class="p">)</span>
        <span class="c1"># idxs_Li = list(idx_coor_Li_dict.keys())</span>

        <span class="c1"># # idx_coor_Li_triad_belonging_initial = defaultdict(list)</span>
        <span class="c1"># # idx_coor_Li_triad_belonging_initial_centroid = defaultdict(list)</span>

        <span class="c1">### does the numeration of Li is important?</span>
        <span class="c1">### 1) check which triad it does belong to initially</span>

        <span class="n">idx_coor_Li_idx_centroid_triad_ref</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_idx_centroid_triad</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_triad</span><span class="p">,</span> <span class="n">idx_coor_Li_dict_ref_24</span><span class="p">)</span>
        <span class="n">idx_coor_Li_idx_centroid_triad</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_idx_centroid_triad_w_closest_dist</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_triad</span><span class="p">,</span> <span class="n">idx_coor_Li_dict</span><span class="p">)</span>
        <span class="n">idx_coor_Li_idx_centroid_triad_weirdos_appended</span> <span class="o">=</span> <span class="n">get_idx_coor_Li_idx_centroid_triad_w_closest_dist_weirdos_appended</span><span class="p">(</span><span class="n">idx_coor_Li_dict_ref_triad</span><span class="p">,</span> <span class="n">idx_coor_Li_dict_weirdos_appended</span><span class="p">,</span> <span class="n">idxs_Li_not</span><span class="p">)</span>
        <span class="c1"># idx_coor_Li_idx_centroid_triad_weirdos_appended = get_idx_coor_Li_idx_centroid_triad_w_closest_dist(idx_coor_Li_dict_ref_triad, idx_coor_Li_dict_weirdos_appended)</span>
        <span class="n">idxs_Li_dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_coor_Li_idx_centroid_triad</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        
        <span class="n">idx_triad_array</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;idx_triad&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx_coor_Li_idx_centroid_triad</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="n">idx_triad_array_not</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx_triad_array</span><span class="p">)</span>
        <span class="c1"># idxs_Li_triad_dict = [i for i in range(24) if i in idx_coor_Li_idx_centroid_triad()]</span>

        <span class="c1"># idx_triad_series = pd.Series(idx_triad_array)</span>
        <span class="c1"># df_idx_triad_counts[i] = idx_triad_series.value_counts()</span>

        <span class="n">idx_triad_counts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Count the occurrences of each idx_triad</span>
        <span class="c1"># idx_triad_counts = pd.DataFrame(np.zeros((24, 1)))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx_coor_Li_idx_centroid_triad</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">idx_triad</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;idx_triad&#39;</span><span class="p">]</span>
            <span class="n">idx_triad_counts</span><span class="p">[</span><span class="n">idx_triad</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">idx_triad_array_not</span><span class="p">:</span>
            <span class="n">idx_triad_counts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># df_idx_triad_counts.at[i, &quot;idx_triad_counts&quot;] = dict(idx_triad_counts)</span>
        <span class="c1"># df_idx_triad_counts = pd.DataFrame(np.zeros((24, 1)))</span>
        <span class="n">df_idx_triad_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">idx_triad_counts</span><span class="p">)</span>
        <span class="c1"># df_idx_triad_counts[i].fillna(0)</span>

        <span class="n">idx_coor_Li_idx_centroid_triad_weirdos_appended_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">idx_coor_Li_idx_centroid_triad_weirdos_appended</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_idx_triad_counts</span><span class="p">,</span> <span class="n">idx_coor_Li_idx_centroid_triad_weirdos_appended_dict</span>


<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>


<span class="c1"># def weighing_movement(dataframe, litype):</span>
<span class="c1">#     col_idx_coor24li_tuple_cage_belongin_complete_closest = &quot;idx_coor24li_tuple_cage_belongin_complete_closest&quot;</span>
<span class="c1">#     col_idx_coor24li_tuple_cage_belongin_complete_closest_weight = &quot;idx_coor24li_tuple_cage_belongin_complete_closest_weight&quot;</span>

<span class="c1">#     dataframe[col_idx_coor24li_tuple_cage_belongin_complete_closest_weight] = [{} for _ in range(len(dataframe.index))]</span>

<span class="c1">#     multiplicator = litype + 2</span>

<span class="c1">#     # TO DO: to be refined with different litype</span>
<span class="c1">#     if litype == 4:</span>
<span class="c1">#         weight_24g = 0</span>
<span class="c1">#         weight_48htype4 = 1</span>
<span class="c1">#         weight_48htype2 = 2</span>
<span class="c1">#         weight_48htype3 = 3</span>
<span class="c1">#         weight_48htype1 = 4</span>
<span class="c1">#         weight_weirdos = 5 </span>

<span class="c1">#     for idx in range(dataframe[&quot;geometry&quot;].size):</span>
<span class="c1">#         # dict_weighted = defaultdict(list)</span>

<span class="c1">#         idx_coor24li_tuple_cage_belongin_complete_closest = dataframe[col_idx_coor24li_tuple_cage_belongin_complete_closest][idx]</span>

<span class="c1">#         idx_coor24li_tuple_cage_belongin_complete_closest_weight = defaultdict(list)</span>

<span class="c1">#         for key_a, val_a in idx_coor24li_tuple_cage_belongin_complete_closest.items():</span>
<span class="c1">#             idx_li = key_a</span>
<span class="c1">#             coor_li_mapped = val_a[&#39;coor&#39;]</span>
<span class="c1">#             type = val_a[&#39;type&#39;]</span>
<span class="c1">#             idx_tuple = val_a[&#39;idx_tuple&#39;]</span>
<span class="c1">#             idx_cage = val_a[&#39;idx_cage&#39;]</span>

<span class="c1">#             if type == &quot;24g&quot;:</span>
<span class="c1">#                 weighted_type = weight_24g</span>
<span class="c1">#             elif type == &quot;48htype4&quot;:</span>
<span class="c1">#                 weighted_type = weight_48htype4</span>
<span class="c1">#             elif type == &quot;48htype2&quot;:</span>
<span class="c1">#                 weighted_type = weight_48htype2</span>
<span class="c1">#             elif type == &quot;48htype3&quot;:</span>
<span class="c1">#                 weighted_type = weight_48htype3</span>
<span class="c1">#             elif type == &quot;48htype1&quot;:</span>
<span class="c1">#                 weighted_type = weight_48htype1</span>
<span class="c1">#             elif type == &quot;weirdos&quot;:</span>
<span class="c1">#                 weighted_type = weight_weirdos</span>
<span class="c1">#             else:</span>
<span class="c1">#                 print(&quot;wrong type&quot;)</span>
            
<span class="c1">#             weight = idx_tuple * multiplicator + weighted_type</span>
        
<span class="c1">#             idx_coor24li_tuple_cage_belongin_complete_closest_weight[idx_li] = {&#39;coor&#39;: coor_li_mapped, &#39;type&#39;: type, &#39;idx_tuple&#39;: idx_tuple, &#39;weight&#39;:weight, &#39;idx_cage&#39;: idx_cage}</span>

<span class="c1">#         dataframe.at[idx, col_idx_coor24li_tuple_cage_belongin_complete_closest_weight] = idx_coor24li_tuple_cage_belongin_complete_closest_weight</span>


<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>


<span class="c1"># def get_idxs_val(df, val):</span>
<span class="c1">#     idxs = [(row, col) for row in range(df.shape[0]) for col in range(df.shape[1]) if df.iloc[row, col] == val]</span>
<span class="c1">#     return idxs</span>


<span class="c1"># def get_key_Li_idx(dict, path, idx_triad):</span>
<span class="c1">#     idxs_li = [key for key, value in dict[path].items() if value.get(&#39;idx_triad&#39;) == idx_triad]</span>
<span class="c1">#     return idxs_li</span>

<span class="c1"># def get_idx_coor_Li_dict_ref_triad(idx_coor_Li_dict_ref_24, idx_coor_Li_dict_ref_72):</span>
<span class="c1">#     idxs_Li_ref_24 = list(idx_coor_Li_dict_ref_24.keys())</span>
<span class="c1">#     idxs_Li_ref_72 = list(idx_coor_Li_dict_ref_72.keys())</span>

<span class="c1">#     idx_coor_Li_dict_ref_triad = defaultdict(list)</span>

<span class="c1">#     for key_72, coor_72 in idx_coor_Li_dict_ref_72.items():</span>
<span class="c1">#         for key_24, coor_24 in idx_coor_Li_dict_ref_24.items():</span>
<span class="c1">#             distance = Operation.Distance.mic_eucledian_distance(coor_72, coor_24)</span>
<span class="c1">#             if distance == 0:</span>
<span class="c1">#                 idx_coor_Li_dict_ref_triad[key_24].append(coor_72)</span>

<span class="c1">#     for key_72, coor_72 in idx_coor_Li_dict_ref_72.items():</span>
<span class="c1">#         for key_24, coor_24 in idx_coor_Li_dict_ref_24.items():</span>
<span class="c1">#             distance = Operation.Distance.mic_eucledian_distance(coor_72, coor_24)</span>
<span class="c1">#             if distance &lt;= 0.086399 and distance != 0:                      # to edit this number</span>
<span class="c1">#                 idx_coor_Li_dict_ref_triad[key_24].append(coor_72)</span>
<span class="c1">#     return idx_coor_Li_dict_ref_triad</span>


<span class="c1"># def get_idx_coor_Li_idx_centroid_triad_w_closest_dist_weirdos_appended(idx_coor_Li_dict_ref_triad, idx_coor_Li_dict_weirdos_appended, idxs_Li_not):</span>
<span class="c1">#     idx_coor_Li_idx_centroid_triad_weirdos_appended = defaultdict(list)</span>
<span class="c1">#     distance_array = []</span>
<span class="c1">#     for key, coor in idx_coor_Li_dict_weirdos_appended.items():</span>
<span class="c1">#         # if key in idxs_Li_not:</span>
<span class="c1">#         #     idx_coor_Li_idx_centroid_triad_dict = {}    </span>
<span class="c1">#         #     for key_triad, coor_triad in idx_coor_Li_dict_ref_triad.items():</span>
<span class="c1">#         #         for coor_triad_component in coor_triad:</span>
<span class="c1">#         #             distance = Operation.Distance.mic_eucledian_distance(coor_triad_component, coor)</span>
<span class="c1">#         #             distance_array.append(distance)  </span>
<span class="c1">#         #     distance_array_sorted = sorted(set(distance_array))</span>
<span class="c1">#         #     distance_array_sorted_top3 = distance_array_sorted[0:4]</span>
<span class="c1">#         #     idx_coor_Li_idx_centroid_triad_dict[&#39;dist_top3&#39;] = distance_array_sorted_top3  </span>
<span class="c1">#         #     if key in idx_coor_Li_idx_centroid_triad_weirdos_appended:</span>
<span class="c1">#         #         idx_coor_Li_idx_centroid_triad_weirdos_appended[key].append(idx_coor_Li_idx_centroid_triad_dict)</span>
<span class="c1">#         #     else:</span>
<span class="c1">#         #         idx_coor_Li_idx_centroid_triad_weirdos_appended[key] = idx_coor_Li_idx_centroid_triad_dict         </span>
<span class="c1">#         # else:</span>
<span class="c1">#         idx_coor_Li_idx_centroid_triad_dict = {}    </span>
<span class="c1">#         for key_triad, coor_triad in idx_coor_Li_dict_ref_triad.items():</span>
<span class="c1">#             for coor_triad_component in coor_triad:</span>
<span class="c1">#                 distance = Operation.Distance.mic_eucledian_distance(coor_triad_component, coor)</span>
<span class="c1">#                 distance_array.append(distance)</span>
<span class="c1">#                 if distance == 0:</span>
<span class="c1">#                     idx_coor_Li_idx_centroid_triad_dict[&#39;coor&#39;] = coor</span>
<span class="c1">#                     idx_coor_Li_idx_centroid_triad_dict[&#39;idx_triad&#39;] = key_triad</span>
<span class="c1">#                     idx_coor_Li_idx_centroid_triad_dict[&#39;centroid_triad&#39;] = coor_triad[0]</span>
<span class="c1">#                     # check if it&#39;s at 24g or 48h</span>
<span class="c1">#                     if coor == coor_triad[0]:</span>
<span class="c1">#                         idx_coor_Li_idx_centroid_triad_dict[&#39;structure&#39;] = 24</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         idx_coor_Li_idx_centroid_triad_dict[&#39;structure&#39;] = 48           </span>
<span class="c1">#         distance_array_sorted = sorted(set(distance_array))</span>
<span class="c1">#         distance_array_sorted_top3 = distance_array_sorted[0:4]</span>
<span class="c1">#         # idx_coor_Li_idx_centroid_triad_dict[&#39;dist_top3&#39;] = distance_array_sorted_top3</span>
<span class="c1">#         if key in idx_coor_Li_idx_centroid_triad_weirdos_appended:</span>
<span class="c1">#             idx_coor_Li_idx_centroid_triad_weirdos_appended[key].append(idx_coor_Li_idx_centroid_triad_dict)</span>
<span class="c1">#         else:</span>
<span class="c1">#             idx_coor_Li_idx_centroid_triad_weirdos_appended[key] = idx_coor_Li_idx_centroid_triad_dict</span>
<span class="c1">#     return idx_coor_Li_idx_centroid_triad_weirdos_appended</span>


<span class="c1"># def get_idx_coor_Li_idx_centroid_triad_w_closest_dist(idx_coor_Li_dict_ref_triad, idx_coor_Li_dict):</span>
<span class="c1">#     idx_coor_Li_idx_centroid_triad = defaultdict(list)</span>
<span class="c1">#     distance_array = []</span>
<span class="c1">#     for key, coor in idx_coor_Li_dict.items():</span>
<span class="c1">#         idx_coor_Li_idx_centroid_triad_dict = {}    </span>
<span class="c1">#         for key_triad, coor_triad in idx_coor_Li_dict_ref_triad.items():</span>
<span class="c1">#             for coor_triad_component in coor_triad:</span>
<span class="c1">#                 distance = Operation.Distance.mic_eucledian_distance(coor_triad_component, coor)</span>
<span class="c1">#                 distance_array.append(distance)</span>
<span class="c1">#                 if distance == 0:</span>
<span class="c1">#                     idx_coor_Li_idx_centroid_triad_dict[&#39;coor&#39;] = coor</span>
<span class="c1">#                     idx_coor_Li_idx_centroid_triad_dict[&#39;idx_triad&#39;] = key_triad</span>
<span class="c1">#                     idx_coor_Li_idx_centroid_triad_dict[&#39;centroid_triad&#39;] = coor_triad[0]</span>
<span class="c1">#                     # check if it&#39;s at 24g or 48h</span>
<span class="c1">#                     if coor == coor_triad[0]:</span>
<span class="c1">#                         idx_coor_Li_idx_centroid_triad_dict[&#39;structure&#39;] = 24</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         idx_coor_Li_idx_centroid_triad_dict[&#39;structure&#39;] = 48                    </span>
<span class="c1">#         distance_array_sorted = sorted(distance_array)</span>
<span class="c1">#         distance_array_sorted_top3 = distance_array_sorted[1:4]</span>
<span class="c1">#         idx_coor_Li_idx_centroid_triad_dict[&#39;dist_top3&#39;] = distance_array_sorted_top3</span>
<span class="c1">#         # idx_coor_Li_idx_centroid_triad_dict[&#39;dist&#39;] = distance_array_sorted</span>
<span class="c1">#         if key in idx_coor_Li_idx_centroid_triad:</span>
<span class="c1">#             idx_coor_Li_idx_centroid_triad[key].append(idx_coor_Li_idx_centroid_triad_dict)</span>
<span class="c1">#         else:</span>
<span class="c1">#             idx_coor_Li_idx_centroid_triad[key] = idx_coor_Li_idx_centroid_triad_dict</span>
<span class="c1">#     return idx_coor_Li_idx_centroid_triad</span>


<span class="c1"># def get_dist_ascending(idx_coor_Li_idx_centroid_triad):</span>
<span class="c1">#     coors_Li_dist_structures = defaultdict(list)</span>

<span class="c1">#     for Li_idx_temp1, val_temp1 in idx_coor_Li_idx_centroid_triad.items():</span>
<span class="c1">#         coors_Li_dist_structures_dict = {}</span>
<span class="c1">#         for Li_idx_temp2, val_temp2 in idx_coor_Li_idx_centroid_triad.items():</span>
<span class="c1">#             distance = Operation.Distance.mic_eucledian_distance(val_temp1[&#39;coor&#39;], val_temp2[&#39;coor&#39;])</span>
<span class="c1">#             coors_Li_dist_structures_dict[&#39;coors&#39;] = (val_temp1[&#39;coor&#39;], val_temp2[&#39;coor&#39;])</span>
<span class="c1">#             coors_Li_dist_structures_dict[&#39;dist&#39;] = distance</span>
<span class="c1">#             coors_Li_dist_structures_dict[&#39;structures&#39;] = (val_temp1[&#39;structure&#39;], val_temp2[&#39;structure&#39;])</span>

<span class="c1">#             key = (Li_idx_temp1, Li_idx_temp2)</span>
<span class="c1">#             if key in coors_Li_dist_structures:</span>
<span class="c1">#                 coors_Li_dist_structures[key].append(coors_Li_dist_structures_dict)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 coors_Li_dist_structures[key] = coors_Li_dist_structures_dict</span>

<span class="c1">#     sorted_coors_Li_dist_structures = dict(sorted(coors_Li_dist_structures.items(), key=lambda item: item[1][&#39;dist&#39;]))</span>
<span class="c1">#     dist_ascending = list({val[&#39;dist&#39;] for idx, val in sorted_coors_Li_dist_structures.items()})</span>

<span class="c1">#     return dist_ascending, sorted_coors_Li_dist_structures</span>


<span class="c1"># # def get_idx_coor_Li_dict(file_path):</span>
<span class="c1"># #     with open(file_path, &#39;r&#39;) as f:</span>
<span class="c1"># #         content = f.read()</span>

<span class="c1"># #     # Initialize a dictionary to store the data</span>
<span class="c1"># #     Li_idx_coor_dict = {}</span>

<span class="c1"># #     # Use regular expressions to extract Li indices and coordinates</span>
<span class="c1"># #     li_pattern = re.compile(r&#39;Li\s+Li(\d+)\s+1\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)&#39;)</span>
<span class="c1"># #     matches = li_pattern.findall(content)</span>

<span class="c1"># #     # Iterate through the matches and populate the dictionary</span>
<span class="c1"># #     for match in matches:</span>
<span class="c1"># #         index = int(match[0])</span>
<span class="c1"># #         x = float(match[1])</span>
<span class="c1"># #         y = float(match[2])</span>
<span class="c1"># #         z = float(match[3])</span>
<span class="c1"># #         Li_idx_coor_dict[index] = (x, y, z)</span>

<span class="c1"># #     return Li_idx_coor_dict</span>


<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>
<span class="c1">##############################################################################################################################################################</span>


<span class="k">class</span> <span class="nc">Plot</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">StructureAnalysis</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">energy_vs_latticeconstant</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">var_filename</span><span class="p">):</span>
            <span class="n">col_latticeconstant_structure_dict</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;latticeconstant_structure_dict_</span><span class="si">{</span><span class="n">var_filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">col_toten</span> <span class="o">=</span> <span class="s2">&quot;toten [eV]&quot;</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">latticeconstant_structure_dict</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_latticeconstant_structure_dict</span><span class="p">]</span>
                <span class="n">toten</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_toten</span><span class="p">]</span>
                
                <span class="n">a</span> <span class="o">=</span> <span class="n">latticeconstant_structure_dict</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">toten</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lattice constant vs Total energy&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lattice constant [Å]&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total energy [eV]&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


        <span class="k">def</span> <span class="nf">weirdos_directcoor</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">activate_radius</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_48htype2_Li&quot;</span>
            <span class="k">elif</span> <span class="n">activate_radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">col_coor_weirdos_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;coor_weirdos_Li&quot;</span>

            <span class="c1"># Create a figure and a 3D axis</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_coor_weirdos_el</span><span class="p">]</span>

                <span class="c1"># Plot each set of coordinates in the loop</span>
                <span class="k">for</span> <span class="n">coordinates</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

            <span class="c1"># Set labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X-axis&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z-axis&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Weirdos direct coordinate&#39;</span><span class="p">)</span>

            <span class="c1"># Show the plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="k">class</span> <span class="nc">Mapping</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">Labelling</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">plot_amount_type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    style: scatter, bar</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">col_amount_type_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;amount_type_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

                    <span class="n">amount_type</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_amount_type_el</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>

                    <span class="k">if</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype7&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">litype</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype3&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype4&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype5&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype6&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype7&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;48htype8&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;24g&#39;</span><span class="p">];</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_type</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>

                <span class="n">wide_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

                <span class="n">long_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">wide_df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">category_labels</span><span class="p">:</span>
                    <span class="n">long_df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">long_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;idx_file&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Idx file vs Li type&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;scatter&quot;</span><span class="p">:</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">long_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;idx_file&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Idx file vs Li type&quot;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">df</span>


            <span class="k">def</span> <span class="nf">plot_mapped_label_vs_dist_and_histogram</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">category_data</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    category_data: mapping, weirdo</span>
<span class="sd">                    TO DO: correct the map for histogram</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">dist_weirdos_el_appendend</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">label_weirdos_el_appended</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">idx_appended</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;mapping&quot;</span><span class="p">:</span>
                    <span class="n">col_dist_label_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atom_mapping_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">_w_dist_label&quot;</span>
                <span class="k">elif</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">:</span>
                    <span class="n">col_dist_label_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;top1_sorted_idxweirdo_dist_label_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="n">col_top1_sorted_idxweirdo_coor_el</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;top1_sorted_idxweirdo_coor_</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">coor_weirdos_el_appended</span> <span class="o">=</span> <span class="p">[]</span>    

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                    <span class="n">atom_mapping_el_w_dist_label</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_dist_label_el</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">:</span>
                        <span class="n">coor_weirdos_el</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_top1_sorted_idxweirdo_coor_el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">atom_mapping_el_w_dist_label</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;mapping&quot;</span><span class="p">:</span>
                            <span class="n">dist</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">:</span>
                            <span class="n">dist</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>

                        <span class="n">dist_weirdos_el_appendend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
                        <span class="n">label_weirdos_el_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                        <span class="n">idx_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">single_coor</span> <span class="ow">in</span> <span class="n">coor_weirdos_el</span><span class="p">:</span>
                            <span class="n">coor_weirdos_el_appended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_coor</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;mapping&quot;</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">dist_weirdos_el_appendend</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label_weirdos_el_appended</span><span class="p">,</span> <span class="s1">&#39;idx_nr&#39;</span><span class="p">:</span> <span class="n">idx_appended</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">category_data</span> <span class="o">==</span> <span class="s2">&quot;weirdo&quot;</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">dist_weirdos_el_appendend</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label_weirdos_el_appended</span><span class="p">,</span> <span class="s1">&#39;idx_nr&#39;</span><span class="p">:</span> <span class="n">idx_appended</span><span class="p">,</span> <span class="s1">&#39;coor&#39;</span><span class="p">:</span> <span class="n">coor_weirdos_el_appended</span><span class="p">})</span>

                <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> 
                                <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                                <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span>
                                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Mapped atom type vs its distance&#39;</span>
                                <span class="p">)</span>

                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scrollZoom&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

                <span class="c1"># if litype == 0:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                <span class="c1"># elif litype == 1:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>
                <span class="c1"># elif litype == 2:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>
                <span class="c1"># elif litype == 3:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>

                <span class="c1">#     df_48htype3 = df.loc[df[&#39;label&#39;] == &#39;48htype3&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype3[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype3&#39;)</span>
                <span class="c1"># elif litype == 4:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>

                <span class="c1">#     df_48htype3 = df.loc[df[&#39;label&#39;] == &#39;48htype3&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype3[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype3&#39;)</span>

                <span class="c1">#     df_48htype4 = df.loc[df[&#39;label&#39;] == &#39;48htype4&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype4[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype4&#39;)</span>
                <span class="c1"># elif litype == 5:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>

                <span class="c1">#     df_48htype3 = df.loc[df[&#39;label&#39;] == &#39;48htype3&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype3[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype3&#39;)</span>

                <span class="c1">#     df_48htype4 = df.loc[df[&#39;label&#39;] == &#39;48htype4&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype4[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype4&#39;)</span>

                <span class="c1">#     df_48htype5 = df.loc[df[&#39;label&#39;] == &#39;48htype5&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype5[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype5&#39;)</span>
                <span class="c1"># elif litype == 6:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>

                <span class="c1">#     df_48htype3 = df.loc[df[&#39;label&#39;] == &#39;48htype3&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype3[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype3&#39;)</span>

                <span class="c1">#     df_48htype4 = df.loc[df[&#39;label&#39;] == &#39;48htype4&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype4[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype4&#39;)</span>

                <span class="c1">#     df_48htype5 = df.loc[df[&#39;label&#39;] == &#39;48htype5&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype5[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype5&#39;)</span>

                <span class="c1">#     df_48htype6 = df.loc[df[&#39;label&#39;] == &#39;48htype6&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype6[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype6&#39;)</span>
                <span class="c1"># elif litype == 7:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>

                <span class="c1">#     df_48htype3 = df.loc[df[&#39;label&#39;] == &#39;48htype3&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype3[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype3&#39;)</span>

                <span class="c1">#     df_48htype4 = df.loc[df[&#39;label&#39;] == &#39;48htype4&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype4[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype4&#39;)</span>

                <span class="c1">#     df_48htype5 = df.loc[df[&#39;label&#39;] == &#39;48htype5&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype5[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype5&#39;)</span>

                <span class="c1">#     df_48htype6 = df.loc[df[&#39;label&#39;] == &#39;48htype6&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype6[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype6&#39;)</span>

                <span class="c1">#     df_48htype7 = df.loc[df[&#39;label&#39;] == &#39;48htype7&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype7[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype7&#39;)</span>
                <span class="c1"># elif litype == 8:</span>
                <span class="c1">#     df_24g = df.loc[df[&#39;label&#39;] == &#39;24g&#39;]</span>
                <span class="c1">#     plt.hist(df_24g[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 24g&#39;)</span>
                        
                <span class="c1">#     df_48htype1 = df.loc[df[&#39;label&#39;] == &#39;48htype1&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype1[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype1&#39;)</span>

                <span class="c1">#     df_48htype2 = df.loc[df[&#39;label&#39;] == &#39;48htype2&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype2[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype2&#39;)</span>

                <span class="c1">#     df_48htype3 = df.loc[df[&#39;label&#39;] == &#39;48htype3&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype3[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype3&#39;)</span>

                <span class="c1">#     df_48htype4 = df.loc[df[&#39;label&#39;] == &#39;48htype4&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype4[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype4&#39;)</span>

                <span class="c1">#     df_48htype5 = df.loc[df[&#39;label&#39;] == &#39;48htype5&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype5[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype5&#39;)</span>

                <span class="c1">#     df_48htype6 = df.loc[df[&#39;label&#39;] == &#39;48htype6&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype6[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype6&#39;)</span>

                <span class="c1">#     df_48htype7 = df.loc[df[&#39;label&#39;] == &#39;48htype7&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype7[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype7&#39;)</span>

                <span class="c1">#     df_48htype8 = df.loc[df[&#39;label&#39;] == &#39;48htype8&#39;]</span>
                <span class="c1">#     plt.hist(df_48htype8[&#39;dist&#39;], color=&#39;lightgreen&#39;, ec=&#39;black&#39;, bins=15)</span>
                <span class="c1">#     plt.title(&#39;Distribution of Distances for 48htype8&#39;)</span>

                <span class="k">return</span> <span class="n">df</span>


    <span class="k">class</span> <span class="nc">Movement</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">Distance</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">plot_distance</span><span class="p">(</span><span class="n">df_distance</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">,</span> <span class="n">activate_shifting_x</span><span class="p">,</span> <span class="n">activate_diameter_line</span><span class="p">,</span> <span class="n">Li_idxs</span><span class="p">):</span>

                <span class="n">diameter_24g48h</span> <span class="o">=</span> <span class="n">max_mapping_radius</span> <span class="o">*</span> <span class="mi">2</span>

                <span class="c1"># x = df_distance.index</span>
                <span class="k">if</span> <span class="n">activate_shifting_x</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_distance</span><span class="p">))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_distance</span><span class="p">))</span>

                <span class="c1"># # fig = plt.figure()</span>
                <span class="c1"># fig = plt.figure(figsize=(800/96, 600/96))  # 800x600 pixels, assuming 96 DPI</span>
                <span class="c1"># ax = plt.subplot(111)</span>

                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># Set the figure size in inches</span>

                <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="c1">#, &#39;k&#39;]</span>

                <span class="c1"># for i in df_distance.index:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_distance</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>

                    <span class="n">line_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>  <span class="c1"># Cycle through colors list</span>

                    <span class="k">if</span> <span class="n">Li_idxs</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Li_idxs</span><span class="p">:</span>
                        <span class="c1"># # i = i</span>
                        <span class="c1"># # line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;)</span>
                        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_distance</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Set line width to 2 pixels</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="c1"># label = f&quot;{i}&quot; if Li_idxs == &quot;all&quot; else None</span>
                        <span class="c1"># line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=label)</span>
                        <span class="c1"># lines.append(line)</span>

                    <span class="c1"># if type(Li_idxs) == list:</span>
                    <span class="c1">#     for j in Li_idxs:</span>
                    <span class="c1">#         if i == j:</span>
                    <span class="c1">#             line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;)</span>
                    <span class="c1">#             lines.append(line)</span>

                <span class="c1"># # ax.axhline(y=diameter_24g48h, color=&#39;b&#39;, linestyle=&#39;:&#39;, label=f&#39;d_mapping = {diameter_24g48h:.3f}&#39;)</span>
                <span class="k">if</span> <span class="n">activate_diameter_line</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">diameter_24g48h</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;d_mapping = </span><span class="si">{</span><span class="n">diameter_24g48h</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Set line width to 1 pixel</span>

                <span class="c1"># plt.title(f&quot;Geometry {geo} with d={diameter_24g48h}&quot;)</span>
                    
                <span class="c1"># Explicitly set x-ticks</span>
                <span class="c1"># ax.set_xticks(x)</span>
                <span class="k">if</span> <span class="n">activate_shifting_x</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

                <span class="c1"># Optionally, if you want to label each tick with the original index before adjustment:</span>
                <span class="c1"># # # if activate_shifting_x == True:</span>
                <span class="c1"># # #     ax.set_xticklabels([str(int(xi - 0.5)) for xi in x])</span>

                <span class="c1"># Shrink current axis&#39;s height by 10% on the bottom</span>
                    <span class="c1"># source: https://stackoverflow.com/questions/4700614/how-to-put-the-legend-outside-the-plot</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">box</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span>
                                <span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">])</span>

                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
                        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

                <span class="c1"># Enable cursor information</span>
                <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">hover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Enable zooming with cursor</span>
                <span class="n">mpldatacursor</span><span class="o">.</span><span class="n">datacursor</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;multiple&#39;</span><span class="p">,</span> <span class="n">draggable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


        <span class="k">class</span> <span class="nc">Occupancy</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">plot_occupancy</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">col_occupancy</span> <span class="o">=</span> <span class="s2">&quot;occupancy&quot;</span>

                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

                    <span class="n">occupancy</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_occupancy</span><span class="p">]</span>

                    <span class="c1"># for key, val in occupancy.items():</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;idx_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span><span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;weirdo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occupancy</span><span class="p">[</span><span class="s1">&#39;weirdo&#39;</span><span class="p">]</span>

                <span class="n">wide_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

                <span class="c1"># Convert wide format to long format</span>
                <span class="c1"># long_df = pd.melt(wide_df, var_name=&#39;Category&#39;, value_name=&#39;Count&#39;)</span>
                <span class="n">long_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">wide_df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;idx_file&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">category_labels</span><span class="p">:</span>
                    <span class="n">long_df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span>

                <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">long_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;idx_file&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Idx of file vs Occupancy&quot;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">df</span>


        <span class="k">class</span> <span class="nc">TupleCage</span><span class="p">:</span>
            <span class="c1"># # # # def plot_cage_tuple_label(df_distance, df_type, df_idx_tuple, max_mapping_radius, litype, category_labels, activate_diameter_line, activate_relabel_s_i, Li_idxs):</span>

            <span class="c1"># # # #     # df_distance = df_distance.iloc[:,:amount_Li]</span>
            <span class="c1"># # # #     # df_type = df_type.iloc[:,:amount_Li]</span>
            <span class="c1"># # # #     # df_idx_tuple = df_idx_tuple.iloc[:,:amount_Li]</span>

            <span class="c1"># # # #     diameter_24g48h = max_mapping_radius * 2</span>

            <span class="c1"># # # #     x = range(len(df_distance))</span>

            <span class="c1"># # # #     # # fig = plt.figure()</span>
            <span class="c1"># # # #     # fig = plt.figure(figsize=(800/96, 600/96))  # 800x600 pixels, assuming 96 DPI</span>
            <span class="c1"># # # #     # ax = plt.subplot(111)</span>

            <span class="c1"># # # #     fig, ax = plt.subplots(figsize=(10, 6))  # Set the figure size in inches</span>

            <span class="c1"># # # #     lines = []</span>
            <span class="c1"># # # #     texts = []</span>

            <span class="c1"># # # #     # type_marker_mapping = {</span>
            <span class="c1"># # # #     #     &#39;48htype1&#39;: &#39;o&#39;,</span>
            <span class="c1"># # # #     #     &#39;48htype2&#39;: &#39;s&#39;,</span>
            <span class="c1"># # # #     #     &#39;48htype3&#39;: &#39;^&#39;,</span>
            <span class="c1"># # # #     #     &#39;48htype4&#39;: &#39;D&#39;,</span>
            <span class="c1"># # # #     #     &#39;weirdos&#39;: &#39;X&#39;,</span>
            <span class="c1"># # # #     #     &#39;24g&#39;: &#39;v&#39;    </span>
            <span class="c1"># # # #     # }</span>

            <span class="c1"># # # #     # # type_marker_mapping = {</span>
            <span class="c1"># # # #     # #     &#39;48htype1&#39;: (&#39;o&#39;, &#39;r&#39;),  # Example: Circle marker with red color</span>
            <span class="c1"># # # #     # #     &#39;48htype2&#39;: (&#39;s&#39;, &#39;g&#39;),  # Square marker with green color</span>
            <span class="c1"># # # #     # #     &#39;48htype3&#39;: (&#39;^&#39;, &#39;b&#39;),  # Triangle marker with blue color</span>
            <span class="c1"># # # #     # #     &#39;48htype4&#39;: (&#39;D&#39;, &#39;c&#39;),  # Diamond marker with cyan color</span>
            <span class="c1"># # # #     # #     &#39;weirdos&#39;: (&#39;X&#39;, &#39;m&#39;),   # X marker with magenta color</span>
            <span class="c1"># # # #     # #     &#39;24g&#39;: (&#39;v&#39;, &#39;y&#39;)        # Triangle_down marker with yellow color</span>
            <span class="c1"># # # #     # # }</span>

            <span class="c1"># # # #     type_marker_mapping = {</span>
            <span class="c1"># # # #         &#39;48htype1&#39;: (&#39;o&#39;),  # Example: Circle marker with red color</span>
            <span class="c1"># # # #         &#39;48htype2&#39;: (&#39;s&#39;),  # Square marker with green color</span>
            <span class="c1"># # # #         &#39;48htype3&#39;: (&#39;^&#39;),  # Triangle marker with blue color</span>
            <span class="c1"># # # #         &#39;48htype4&#39;: (&#39;D&#39;),  # Diamond marker with cyan color</span>
            <span class="c1"># # # #         &#39;weirdos&#39;: (&#39;X&#39;),   # X marker with magenta color</span>
            <span class="c1"># # # #         &#39;24g&#39;: (&#39;v&#39;)        # Triangle_down marker with yellow color</span>
            <span class="c1"># # # #     }</span>

            <span class="c1"># # # #     colors = [&#39;b&#39;, &#39;g&#39;, &#39;r&#39;, &#39;c&#39;, &#39;m&#39;, &#39;y&#39;] #, &#39;k&#39;]  # Example color list</span>
            <span class="c1"># # # #     # colors = list(mcolors.CSS4_COLORS.values())</span>
            <span class="c1"># # # #     # colors = [color + (0.7,) for color in mcolors.CSS4_COLORS.values()]</span>
            <span class="c1"># # # #     # colors = mcolors</span>
            <span class="c1"># # # #     # names = list(colors)</span>

            <span class="c1"># # # #     # Define offsets for text position</span>
            <span class="c1"># # # #     x_offset = 0.02  # Adjust these values as needed</span>
            <span class="c1"># # # #     y_offset = -0.05  # Adjust these values as needed</span>

            <span class="c1"># # # #     # Track which labels have been added</span>
            <span class="c1"># # # #     added_labels = set()</span>

            <span class="c1"># # # #     # for i in range(24):</span>
            <span class="c1"># # # #     for i in range(len(df_distance.columns)):</span>
            <span class="c1"># # # #         if Li_idxs == &quot;all&quot; or i in Li_idxs:</span>
            <span class="c1"># # # #             column_data = df_distance[f&quot;{i}&quot;]</span>
            <span class="c1"># # # #             column_val = df_type[f&quot;{i}&quot;]</span>
            <span class="c1"># # # #             column_idx_tuple = df_idx_tuple[f&quot;{i}&quot;]</span>
            <span class="c1"># # # #             # type_val = df_type[0, i]</span>
            <span class="c1"># # # #             # print(type_val)</span>

            <span class="c1"># # # #             line_color = colors[i % len(colors)]  # Cycle through colors list</span>
            <span class="c1"># # # #             # # # # # # # line_color = colors[i % len(colors)] if i &lt; len(colors) else &#39;black&#39;  # Use a default color if the index exceeds available colors</span>

            <span class="c1"># # # #             # # # for j in x:</span>
            <span class="c1"># # # #             for j, (y_val, type_val, idx_tuple_val) in enumerate(zip(column_data, column_val, column_idx_tuple)):</span>
            <span class="c1"># # # #                 # type = column_val[j]</span>
            <span class="c1"># # # #                 # idx_tuple = column_idx_tuple[j]</span>

            <span class="c1"># # # #                 # marker_style = type_marker_mapping.get(column_val, &#39;o&#39;)  # Get the marker style for the type</span>
            <span class="c1"># # # #                 # # marker_style = type_marker_mapping.get(type, &#39;o&#39;)  # Get the marker style for the type</span>
            <span class="c1"># # # #                 # # # # # # # marker_style, marker_color = type_marker_mapping.get(type_val, (&#39;o&#39;,&#39;k&#39;))  # Get the marker style for the type</span>
            <span class="c1"># # # #                 marker_style = type_marker_mapping.get(type_val, (&#39;o&#39;))  # Get the marker style for the type</span>
            <span class="c1"># # # #                 # # # # # # ax.scatter(j, df_distance[f&quot;{i}&quot;][j], label=f&quot;Type: {column_val}&quot;, marker=marker_style, s=100)</span>
            <span class="c1"># # # #                 # # # # # label = f&quot;{type_val}&quot; if type_val not in added_labels else None</span>
            <span class="c1"># # # #                 # # # # # # # ax.scatter(j, df_distance.iloc[j, i], label=label, marker=marker_style, s=100)</span>
            <span class="c1"># # # #                 # # # # # # # # # ax.scatter(j, df_distance.iloc[j, i], label=label, marker=marker_style, s=100, color = marker_color, alpha = 0.5)</span>
            <span class="c1"># # # #                 # # # # # ax.scatter(j, y_val, label=label, marker=marker_style, s=100, color = marker_color, alpha = 0.5)</span>
            <span class="c1"># # # #                 # # # # # added_labels.add(type_val)</span>
            <span class="c1"># # # #                 mapped_label = category_labels.get(type_val, type_val)  # Use the original type_val if it&#39;s not found in category_labels</span>
            <span class="c1"># # # #                 # Use mapped_label for the label. Only add it if it&#39;s not already added.</span>
            <span class="c1"># # # #                 label = mapped_label if mapped_label not in added_labels else None</span>
            <span class="c1"># # # #                 ax.scatter(j, y_val, label=label, marker=marker_style, s=100, color=line_color, alpha=0.5)</span>
            <span class="c1"># # # #                 if label:  # If a label was added, record it as added</span>
            <span class="c1"># # # #                     added_labels.add(mapped_label)</span>

            <span class="c1"># # # #                 # # # # ax.text(j, df_distance.iloc[j, i], str(int(idx_tuple_val)), color=line_color, fontsize=20)</span>
            <span class="c1"># # # #                 # # # # # ax.text(j, y_val, str(int(idx_tuple_val)), color=line_color, fontsize=20)</span>
            <span class="c1"># # # #                 # Apply offsets to text position</span>
            <span class="c1"># # # #                 text_x = j + x_offset * ax.get_xlim()[1]  # Adjust text x-position</span>
            <span class="c1"># # # #                 text_y = y_val + y_offset * ax.get_ylim()[1]  # Adjust text y-position</span>

            <span class="c1"># # # #                 # Check if type_val is &#39;weirdos&#39; and change text color to black, else use the line color</span>
            <span class="c1"># # # #                 text_color = &#39;black&#39; if type_val in [&#39;weirdos&#39;, &#39;48htype1&#39;] else line_color</span>

            <span class="c1"># # # #                 print(idx_tuple_val)</span>
            <span class="c1"># # # #                 if idx_tuple_val == &#39;x&#39;:</span>
            <span class="c1"># # # #                     text = ax.text(text_x, text_y, idx_tuple_val, color=text_color, fontsize=18)</span>
            <span class="c1"># # # #                 else:</span>
            <span class="c1"># # # #                     # if activate_relabel_s_i:</span>
            <span class="c1"># # # #                     #     if litype == 4:</span>
            <span class="c1"># # # #                     #         if idx_tuple_val in [&#39;48htype2&#39;, &#39;48htype3&#39;, &#39;48htype4&#39;]:</span>
            <span class="c1"># # # #                     #             text = ax.text(text_x, text_y, str(int(idx_tuple_val))+&quot;s&quot;, color=text_color, fontsize=18)</span>
            <span class="c1"># # # #                     #         elif idx_tuple_val in [&#39;48htype1&#39;]:</span>
            <span class="c1"># # # #                     #             text = ax.text(text_x, text_y, str(int(idx_tuple_val))+&quot;i&quot;, color=text_color, fontsize=18)</span>
            <span class="c1"># # # #                     # else:</span>
            <span class="c1"># # # #                     text = ax.text(text_x, text_y, str(int(idx_tuple_val)), color=text_color, fontsize=18)</span>
            <span class="c1"># # # #                 texts.append(text)</span>

            <span class="c1"># # # #                 # # # # # # # # # # # # # # text = ax.text(j+x_offset, y_val+y_offset, str(int(idx_tuple_val)), color=line_color, fontsize=15)</span>
            <span class="c1"># # # #                 # # # # # # # # if idx_tuple_val == f&#39; &#39;:</span>
            <span class="c1"># # # #                 # # # # # # # #     text = ax.text(text_x, text_y, idx_tuple_val, color=line_color, fontsize=18)</span>
            <span class="c1"># # # #                 # # # # # # # # else:</span>
            <span class="c1"># # # #                 # # # # # # # #     text = ax.text(text_x, text_y, str(int(idx_tuple_val)), color=line_color, fontsize=18)</span>
            <span class="c1"># # # #                 # # # # # # # # texts.append(text)</span>

            <span class="c1"># # # #             # # i = i</span>
            <span class="c1"># # # #             # # line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;)</span>
            <span class="c1"># # # #             # line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;, linewidth=2, marker=marker_style, markersize=10)  # Set line width to 2 pixels</span>

            <span class="c1"># # # #             line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;, color=line_color, linewidth=2)  # Set line width to 2 pixels</span>
            <span class="c1"># # # #             # ax.text(i, value, str(int(idx_value)), color=line_color, fontsize=8)</span>

            <span class="c1"># # # #             lines.append(line)</span>
            <span class="c1"># # # #             # label = f&quot;{i}&quot; if Li_idxs == &quot;all&quot; else None</span>
            <span class="c1"># # # #             # line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=label)</span>
            <span class="c1"># # # #             # lines.append(line)</span>

            <span class="c1"># # # #         # if type(Li_idxs) == list:</span>
            <span class="c1"># # # #         #     for j in Li_idxs:</span>
            <span class="c1"># # # #         #         if i == j:</span>
            <span class="c1"># # # #         #             line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;)</span>
            <span class="c1"># # # #         #             lines.append(line)</span>

            <span class="c1"># # # #     adjust_text(texts, arrowprops=dict(arrowstyle=&#39;-&gt;&#39;, color=&#39;red&#39;))</span>
                
            <span class="c1"># # # #     # # ax.axhline(y=diameter_24g48h, color=&#39;b&#39;, linestyle=&#39;:&#39;, label=f&#39;d_mapping = {diameter_24g48h:.3f}&#39;)</span>
            <span class="c1"># # # #     if activate_diameter_line == True:</span>
            <span class="c1"># # # #         ax.axhline(y=diameter_24g48h, color=&#39;b&#39;, linestyle=&#39;:&#39;, label=f&#39;d_mapping = {diameter_24g48h:.3f}&#39;, linewidth=1)  # Set line width to 1 pixel</span>

            <span class="c1"># # # #     # Set the y-axis to only show ticks at 0, 1, 2, 3</span>
            <span class="c1"># # # #     plt.yticks([0, 1, 2, 3])</span>

            <span class="c1"># # # #     # plt.title(f&quot;Geometry {geo} with d={diameter_24g48h}&quot;)</span>

            <span class="c1"># # # #     # Shrink current axis&#39;s height by 10% on the bottom</span>
            <span class="c1"># # # #         # source: https://stackoverflow.com/questions/4700614/how-to-put-the-legend-outside-the-plot</span>
            <span class="c1"># # # #     box = ax.get_position()</span>
            <span class="c1"># # # #     ax.set_position([box.x0, box.y0 + box.height * 0.1,</span>
            <span class="c1"># # # #                     box.width, box.height * 0.9])</span>

            <span class="c1"># # # #     handles, labels = ax.get_legend_handles_labels()</span>

            <span class="c1"># # # #     # Set marker color in legend box to black</span>
            <span class="c1"># # # #     # # legend_handles = [(h[0], h[1], {&#39;color&#39;: &#39;black&#39;}) for h in handles]</span>
            <span class="c1"># # # #     legend_handles = [(h, {&#39;color&#39;: &#39;black&#39;}) for h in handles]</span>

            <span class="c1"># # # #     ax.legend(handles=handles, labels=labels, loc=&#39;upper center&#39;, bbox_to_anchor=(0.5, -0.05),</span>
            <span class="c1"># # # #             fancybox=True, shadow=True, ncol=5)</span>
                
            <span class="c1"># # # #     # # # ax.legend(handles=legend_handles, labels=labels, loc=&#39;upper center&#39;, bbox_to_anchor=(0.5, -0.05),</span>
            <span class="c1"># # # #     # # #         fancybox=True, shadow=True, ncol=5, handlelength=2, handler_map={tuple: HandlerTuple(ndivide=None)})</span>
            <span class="c1"># # # #     # ax.legend(handles=legend_handles, labels=labels, loc=&#39;upper center&#39;, bbox_to_anchor=(0.5, -0.05),</span>
            <span class="c1"># # # #     #         fancybox=True, shadow=True, ncol=5)</span>

            <span class="c1"># # # #     # Enable cursor information</span>
            <span class="c1"># # # #     mplcursors.cursor(hover=True)</span>

            <span class="c1"># # # #     # Enable zooming with cursor</span>
            <span class="c1"># # # #     mpldatacursor.datacursor(display=&#39;multiple&#39;, draggable=True)</span>

            <span class="c1"># # # #     plt.show()</span>


            <span class="k">def</span> <span class="nf">plot_cage_tuple_label</span><span class="p">(</span><span class="n">df_distance</span><span class="p">,</span> <span class="n">df_type</span><span class="p">,</span> <span class="n">df_idx_tuple</span><span class="p">,</span> <span class="n">max_mapping_radius</span><span class="p">,</span> <span class="n">litype</span><span class="p">,</span> <span class="n">category_labels</span><span class="p">,</span> <span class="n">activate_diameter_line</span><span class="p">,</span> <span class="n">activate_relabel_s_i</span><span class="p">,</span> <span class="n">Li_idxs</span><span class="p">):</span>

                <span class="c1"># df_distance = df_distance.iloc[:,:amount_Li]</span>
                <span class="c1"># df_type = df_type.iloc[:,:amount_Li]</span>
                <span class="c1"># df_idx_tuple = df_idx_tuple.iloc[:,:amount_Li]</span>

                <span class="n">diameter_24g48h</span> <span class="o">=</span> <span class="n">max_mapping_radius</span> <span class="o">*</span> <span class="mi">2</span>

                <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_distance</span><span class="p">))</span>

                <span class="c1"># # fig = plt.figure()</span>
                <span class="c1"># fig = plt.figure(figsize=(800/96, 600/96))  # 800x600 pixels, assuming 96 DPI</span>
                <span class="c1"># ax = plt.subplot(111)</span>

                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># Set the figure size in inches</span>

                <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># type_marker_mapping = {</span>
                <span class="c1">#     &#39;48htype1&#39;: &#39;o&#39;,</span>
                <span class="c1">#     &#39;48htype2&#39;: &#39;s&#39;,</span>
                <span class="c1">#     &#39;48htype3&#39;: &#39;^&#39;,</span>
                <span class="c1">#     &#39;48htype4&#39;: &#39;D&#39;,</span>
                <span class="c1">#     &#39;weirdos&#39;: &#39;X&#39;,</span>
                <span class="c1">#     &#39;24g&#39;: &#39;v&#39;    </span>
                <span class="c1"># }</span>

                <span class="c1"># # type_marker_mapping = {</span>
                <span class="c1"># #     &#39;48htype1&#39;: (&#39;o&#39;, &#39;r&#39;),  # Example: Circle marker with red color</span>
                <span class="c1"># #     &#39;48htype2&#39;: (&#39;s&#39;, &#39;g&#39;),  # Square marker with green color</span>
                <span class="c1"># #     &#39;48htype3&#39;: (&#39;^&#39;, &#39;b&#39;),  # Triangle marker with blue color</span>
                <span class="c1"># #     &#39;48htype4&#39;: (&#39;D&#39;, &#39;c&#39;),  # Diamond marker with cyan color</span>
                <span class="c1"># #     &#39;weirdos&#39;: (&#39;X&#39;, &#39;m&#39;),   # X marker with magenta color</span>
                <span class="c1"># #     &#39;24g&#39;: (&#39;v&#39;, &#39;y&#39;)        # Triangle_down marker with yellow color</span>
                <span class="c1"># # }</span>

                <span class="n">type_marker_mapping</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;48htype1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">),</span>  <span class="c1"># Example: Circle marker with red color</span>
                    <span class="s1">&#39;48htype2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">),</span>  <span class="c1"># Square marker with green color</span>
                    <span class="s1">&#39;48htype3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">),</span>  <span class="c1"># Triangle marker with blue color</span>
                    <span class="s1">&#39;48htype4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">),</span>  <span class="c1"># Diamond marker with cyan color</span>
                    <span class="s1">&#39;weirdos&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>   <span class="c1"># X marker with magenta color</span>
                    <span class="s1">&#39;24g&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>        <span class="c1"># Triangle_down marker with yellow color</span>
                <span class="p">}</span>

                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="c1">#, &#39;k&#39;]  # Example color list</span>
                <span class="c1"># colors = list(mcolors.CSS4_COLORS.values())</span>
                <span class="c1"># colors = [color + (0.7,) for color in mcolors.CSS4_COLORS.values()]</span>
                <span class="c1"># colors = mcolors</span>
                <span class="c1"># names = list(colors)</span>

                <span class="c1"># Define offsets for text position</span>
                <span class="n">x_offset</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># Adjust these values as needed</span>
                <span class="n">y_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="c1"># Adjust these values as needed</span>

                <span class="c1"># Track which labels have been added</span>
                <span class="n">added_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

                <span class="c1"># for i in range(24):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_distance</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">Li_idxs</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Li_idxs</span><span class="p">:</span>
                        <span class="n">column_data</span> <span class="o">=</span> <span class="n">df_distance</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="n">column_val</span> <span class="o">=</span> <span class="n">df_type</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="n">column_idx_tuple</span> <span class="o">=</span> <span class="n">df_idx_tuple</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                        <span class="c1"># type_val = df_type[0, i]</span>
                        <span class="c1"># print(type_val)</span>

                        <span class="n">line_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>  <span class="c1"># Cycle through colors list</span>
                        <span class="c1"># # # # # # # line_color = colors[i % len(colors)] if i &lt; len(colors) else &#39;black&#39;  # Use a default color if the index exceeds available colors</span>

                        <span class="c1"># # # for j in x:</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">type_val</span><span class="p">,</span> <span class="n">idx_tuple_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">column_data</span><span class="p">,</span> <span class="n">column_val</span><span class="p">,</span> <span class="n">column_idx_tuple</span><span class="p">)):</span>
                            <span class="c1"># type = column_val[j]</span>
                            <span class="c1"># idx_tuple = column_idx_tuple[j]</span>

                            <span class="c1"># marker_style = type_marker_mapping.get(column_val, &#39;o&#39;)  # Get the marker style for the type</span>
                            <span class="c1"># # marker_style = type_marker_mapping.get(type, &#39;o&#39;)  # Get the marker style for the type</span>
                            <span class="c1"># # # # # # # marker_style, marker_color = type_marker_mapping.get(type_val, (&#39;o&#39;,&#39;k&#39;))  # Get the marker style for the type</span>
                            <span class="n">marker_style</span> <span class="o">=</span> <span class="n">type_marker_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_val</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">))</span>  <span class="c1"># Get the marker style for the type</span>
                            <span class="c1"># # # # # # ax.scatter(j, df_distance[f&quot;{i}&quot;][j], label=f&quot;Type: {column_val}&quot;, marker=marker_style, s=100)</span>
                            <span class="c1"># # # # # label = f&quot;{type_val}&quot; if type_val not in added_labels else None</span>
                            <span class="c1"># # # # # # # ax.scatter(j, df_distance.iloc[j, i], label=label, marker=marker_style, s=100)</span>
                            <span class="c1"># # # # # # # # # ax.scatter(j, df_distance.iloc[j, i], label=label, marker=marker_style, s=100, color = marker_color, alpha = 0.5)</span>
                            <span class="c1"># # # # # ax.scatter(j, y_val, label=label, marker=marker_style, s=100, color = marker_color, alpha = 0.5)</span>
                            <span class="c1"># # # # # added_labels.add(type_val)</span>
                            <span class="n">mapped_label</span> <span class="o">=</span> <span class="n">category_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_val</span><span class="p">,</span> <span class="n">type_val</span><span class="p">)</span>  <span class="c1"># Use the original type_val if it&#39;s not found in category_labels</span>
                            <span class="c1"># Use mapped_label for the label. Only add it if it&#39;s not already added.</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">mapped_label</span> <span class="k">if</span> <span class="n">mapped_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_labels</span> <span class="k">else</span> <span class="kc">None</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker_style</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">label</span><span class="p">:</span>  <span class="c1"># If a label was added, record it as added</span>
                                <span class="n">added_labels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mapped_label</span><span class="p">)</span>

                            <span class="c1"># # # # ax.text(j, df_distance.iloc[j, i], str(int(idx_tuple_val)), color=line_color, fontsize=20)</span>
                            <span class="c1"># # # # # ax.text(j, y_val, str(int(idx_tuple_val)), color=line_color, fontsize=20)</span>
                            <span class="c1"># Apply offsets to text position</span>
                            <span class="n">text_x</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">x_offset</span> <span class="o">*</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Adjust text x-position</span>
                            <span class="n">text_y</span> <span class="o">=</span> <span class="n">y_val</span> <span class="o">+</span> <span class="n">y_offset</span> <span class="o">*</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Adjust text y-position</span>

                            <span class="c1"># Check if type_val is &#39;weirdos&#39; and change text color to black, else use the line color</span>
                            <span class="n">text_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span> <span class="k">if</span> <span class="n">type_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;weirdos&#39;</span><span class="p">,</span> <span class="s1">&#39;48htype1&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">line_color</span>

                            <span class="k">if</span> <span class="n">activate_relabel_s_i</span><span class="p">:</span>        
                                <span class="c1"># print(idx_tuple_val)</span>
                                <span class="k">if</span> <span class="n">type_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;48htype2&#39;</span><span class="p">,</span> <span class="s1">&#39;48htype3&#39;</span><span class="p">,</span> <span class="s1">&#39;48htype4&#39;</span><span class="p">,</span> <span class="s1">&#39;24g&#39;</span><span class="p">]:</span>
                                    <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx_tuple_val</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">type_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;48htype1&#39;</span><span class="p">]:</span>
                                    <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx_tuple_val</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;weirdos&#39;</span><span class="p">:</span>
                                    <span class="c1"># idx_tuple_val = &#39;x&#39;</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">idx_tuple_val</span><span class="p">)</span>
                                    <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="n">idx_tuple_val</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">idx_tuple_val</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
                                    <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="n">idx_tuple_val</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx_tuple_val</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                            <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

                            <span class="c1"># # # # # # # # # # # # # # text = ax.text(j+x_offset, y_val+y_offset, str(int(idx_tuple_val)), color=line_color, fontsize=15)</span>
                            <span class="c1"># # # # # # # # if idx_tuple_val == f&#39; &#39;:</span>
                            <span class="c1"># # # # # # # #     text = ax.text(text_x, text_y, idx_tuple_val, color=line_color, fontsize=18)</span>
                            <span class="c1"># # # # # # # # else:</span>
                            <span class="c1"># # # # # # # #     text = ax.text(text_x, text_y, str(int(idx_tuple_val)), color=line_color, fontsize=18)</span>
                            <span class="c1"># # # # # # # # texts.append(text)</span>

                        <span class="c1"># # i = i</span>
                        <span class="c1"># # line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;)</span>
                        <span class="c1"># line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;, linewidth=2, marker=marker_style, markersize=10)  # Set line width to 2 pixels</span>

                        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_distance</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Set line width to 2 pixels</span>
                        <span class="c1"># ax.text(i, value, str(int(idx_value)), color=line_color, fontsize=8)</span>

                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="c1"># label = f&quot;{i}&quot; if Li_idxs == &quot;all&quot; else None</span>
                        <span class="c1"># line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=label)</span>
                        <span class="c1"># lines.append(line)</span>

                    <span class="c1"># if type(Li_idxs) == list:</span>
                    <span class="c1">#     for j in Li_idxs:</span>
                    <span class="c1">#         if i == j:</span>
                    <span class="c1">#             line, = ax.plot(x, df_distance[f&quot;{i}&quot;], label=f&quot;{i}&quot;)</span>
                    <span class="c1">#             lines.append(line)</span>

                <span class="n">adjust_text</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
                
                <span class="c1"># # ax.axhline(y=diameter_24g48h, color=&#39;b&#39;, linestyle=&#39;:&#39;, label=f&#39;d_mapping = {diameter_24g48h:.3f}&#39;)</span>
                <span class="k">if</span> <span class="n">activate_diameter_line</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">diameter_24g48h</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;d_mapping = </span><span class="si">{</span><span class="n">diameter_24g48h</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Set line width to 1 pixel</span>

                <span class="c1"># ax.set_ylim(-0.5, 3.5)</span>

                <span class="c1"># Set the y-axis to only show ticks at 0, 1, 2, 3</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

                <span class="c1"># plt.title(f&quot;Geometry {geo} with d={diameter_24g48h}&quot;)</span>

                <span class="c1"># Shrink current axis&#39;s height by 10% on the bottom</span>
                    <span class="c1"># source: https://stackoverflow.com/questions/4700614/how-to-put-the-legend-outside-the-plot</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">box</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span>
                                <span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">])</span>

                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

                <span class="c1"># Set marker color in legend box to black</span>
                <span class="c1"># # legend_handles = [(h[0], h[1], {&#39;color&#39;: &#39;black&#39;}) for h in handles]</span>
                <span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[(</span><span class="n">h</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">})</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">]</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
                        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                
                <span class="c1"># # # ax.legend(handles=legend_handles, labels=labels, loc=&#39;upper center&#39;, bbox_to_anchor=(0.5, -0.05),</span>
                <span class="c1"># # #         fancybox=True, shadow=True, ncol=5, handlelength=2, handler_map={tuple: HandlerTuple(ndivide=None)})</span>
                <span class="c1"># ax.legend(handles=legend_handles, labels=labels, loc=&#39;upper center&#39;, bbox_to_anchor=(0.5, -0.05),</span>
                <span class="c1">#         fancybox=True, shadow=True, ncol=5)</span>

                <span class="c1"># Enable cursor information</span>
                <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">hover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Enable zooming with cursor</span>
                <span class="n">mpldatacursor</span><span class="o">.</span><span class="n">datacursor</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;multiple&#39;</span><span class="p">,</span> <span class="n">draggable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, AF.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>